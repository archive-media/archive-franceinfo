"use strict";(self.webpackChunkfranceinfo_package=self.webpackChunkfranceinfo_package||[]).push([[4042,8165],{455:function(t,e,n){function i(t,e,n){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{A:function(){return o}});class o{constructor(t,e,n){this.auth=t,this.utils=e,this.config=n,i(this,"gcTokenCallback",void 0),i(this,"gcToken",void 0),i(this,"GRAPHCOMMENT_CONTAINER_ID","graphcomment")}getCanonicalUrl(){const t=document.head.querySelector('link[rel="canonical"]');return t?t.href:window.location.href}getPublicationDate(){let t="";const e=document.querySelector(".publication-date__published time[datetime]");return null!=e&&e.dateTime&&(t=e.dateTime),t}async getGraphCommentContext(){const t=await this.config.getConfig();return{appConfig:t,rootUrl:t.comments.graphcommentUrl,commentToken:await this.auth.generateGraphCommentToken()}}async createGraphCommentStream(){var t;const{appConfig:e,rootUrl:n,commentToken:i}=await this.getGraphCommentContext(),o=this.getCanonicalUrl(),a={graphcommentId:e.comments.graphcommentId,behaviour:{url:o,uid:this.utils.getContentId(),readonly:!1,innap:"true"===window.isWebview,lifetime:30,publication_date:this.getPublicationDate(),telemetricTroughCmp:!1},statistics:{pageTitle:(null===(t=document.querySelector('meta[property="og:title"]'))||void 0===t?void 0:t.getAttribute("content"))||""},auth:{subscribeToToken:t=>{"function"==typeof t&&(this.gcToken?t(this.gcToken):this.gcTokenCallback=t)},signup:()=>{this.auth.subscribe()},login:()=>{this.auth.login()},logout:()=>{this.auth.logout()}}};return await this.utils.loadScript(`${n}/gc.js?${Date.now()}`),new Promise(t=>{i&&this.utils.loadScript(`${n}/helpers_sso.js`).then(()=>{window.__semio__helpers_sso({graphcommentId:e.comments.graphcommentId,publicKey:i.publicKey,data:i.token,onSuccess:t=>{this.gcToken=t,this.gcTokenCallback&&this.gcTokenCallback(t)},onConflict:()=>{console.warn("Conflit d’authentification SSO détecté.")},onFailure:()=>{console.error("Échec de l’authentification SSO GraphComment.")}})}),window.__semio__gc(a),t("ready")})}}},2710:function(t,e,n){var i=n(455);function o(t,e,n){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class a extends i.A{constructor(t,e,n,i){super(t,e,n),this.piano=i,o(this,"alreadyShown",!1),o(this,"appConfig",void 0),o(this,"commentBtns",document.querySelectorAll(".comments-embed__button")),o(this,"drawerElement",void 0),o(this,"drawerInstance",void 0),this.utils.onReadyStateChange("complete",()=>this.init())}async init(){this.drawerElement=document.querySelector(".drawer");const t=(await n.e(6806).then(n.bind(n,6911))).default;this.drawerInstance=new t(this.drawerElement,this.utils,this.piano),new URLSearchParams(window.location.search).has("drawer")&&(this.drawerInstance.show(this.commentBtns.item(0)),this.show());for(const t of this.commentBtns)t.addEventListener("click",()=>{this.drawerInstance.show(t),this.show()});const e=await this.utils.getGraphCommentCount();this.setLabels(e)}show(){!0!==this.alreadyShown&&(this.alreadyShown=!0,this.loadGraphCommentEmbed())}async loadGraphCommentEmbed(){return this.appConfig=await this.config.getConfig(),this.appConfig.comments.enable?this.createGraphCommentStream():Promise.resolve("")}setLabels(t){const e=this.utils.setGraphCommentLabel(t),n=this.utils.setGraphCommentShortLabel(t);document.querySelectorAll(".comments-embed__button").forEach(t=>{if(t instanceof HTMLElement){const i=t.querySelector(".fi-button__text");i instanceof HTMLElement&&(i.innerText=t.classList.contains("fi-button--vertical")?n:e)}})}}new Promise(t=>{Promise.all([n.e(4895).then(n.bind(n,4284)),n.e(9980).then(n.bind(n,5321)),n.e(3355).then(n.bind(n,6672)),n.e(9292).then(n.bind(n,3703))]).then(async([e,n,i,o])=>{const r=await e.default,s=n,c=await i.default,l=await o.default,h=new a(r,s,c,l);t(h)})})}},function(t){t(t.s=2710)}]);