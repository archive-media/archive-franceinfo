"use strict";(self.webpackChunkfranceinfo_package=self.webpackChunkfranceinfo_package||[]).push([[1063,8543],{4507:function(t,e,o){o.a(t,async function(t,e){try{var i=o(5613);function a(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,i)}return o}function n(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?a(Object(o),!0).forEach(function(e){s(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function s(t,e,o){return(e=r(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t){var e=c(t,"string");return"symbol"==typeof e?e:e+""}function c(t,e){if("object"!=typeof t||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}const l=await o.e(8760).then(o.bind(o,1941));class d{constructor(t,e,o,i,a,n){this.btnBookmark=t,this.auth=e,this.config=o,this.piano=i,this.utils=a,this.stickyOrchestrator=n,s(this,"COOKIE_BOOKMARK_INTENT","fi_bookmark_intent"),s(this,"COOKIE_BOOKMARK_INTENT_POPOVER","fi_bookmark_intent_popover"),s(this,"COOKIE_BOOKMARK_FIRST_USAGE","fi_bookmark_first_bookmark"),s(this,"COOKIE_BOOKMARK_SECOND_USAGE","fi_bookmark_second_bookmark"),s(this,"COOKIE_BOOKMARK_STOP_POPOVER","fi_bookmark_stop_popover"),s(this,"COOKIE_BOOKMARK_PROMO","fi_bookmark_promo"),s(this,"LS_BOOKMARK_LAST_VISIT","fi_bookmark_last_visit"),s(this,"BOOKMARKS_URL","/mon-compte/lire-plus-tard"),s(this,"DELAY_POPOVER_PROMOTION",5e3),s(this,"BTN_LOADING_CLASS","fi-button--loading"),s(this,"EVENT_UPDATED","Bookmark::updated"),s(this,"DIALOG_INITIALIZED_CLASS","bookmark-button-dialog--initialized"),s(this,"dialogEl",void 0),s(this,"isBookmarked",void 0),s(this,"bookmark",void 0),s(this,"snackbar",void 0),s(this,"contentId",void 0),this.dialogEl=document.querySelector(".bookmark-button-dialog"),this.contentId=Number(this.btnBookmark.dataset.contentId),this.init()}async init(){const t=(await this.auth.getUserInfo()).connected;if("true"===this.utils.readCookie(this.COOKIE_BOOKMARK_PROMO)||t||this.initPopoverPromo(),!t)return l.updateLoadingState(d.name),void this.addModalEvents();const e=(await o.e(6389).then(o.bind(o,5790))).default;this.bookmark=new e(this.auth,this.config);const i=(await o.e(2229).then(o.bind(o,2548))).default;this.snackbar=new i(this.utils,this.stickyOrchestrator),this.isBookmarked=await this.bookmark.isBookmarked(this.contentId),this.isBookmarked&&this.updateBookmarkBtnIcon("add"),this.initPopoverIntent(),this.btnBookmark.addEventListener("click",()=>{this.handleBookmarkAction()}),document.addEventListener(this.EVENT_UPDATED,t=>{const{contentId:e,action:o}=t.detail;Number(e)===this.contentId&&(this.isBookmarked="add"===o,this.updateBookmarkBtnIcon(o))})}async addModalEvents(){const t=new(0,(await o.e(7051).then(o.bind(o,8324))).default)(this.dialogEl,this.utils,this.stickyOrchestrator),e={feature:"popin_connexion",zone:"bookmarks"};this.btnBookmark.addEventListener("click",()=>{var o,i;this.piano.sendClick({feature:"bookmarks",click:"ajout_bookmark",zone:null!==(o=null===(i=this.btnBookmark.dataset)||void 0===i?void 0:i.zone)&&void 0!==o?o:""}),t.show(),this.piano.sendPrint(e)}),this.dialogEl.classList.contains(this.DIALOG_INITIALIZED_CLASS)||(this.dialogEl.classList.add(this.DIALOG_INITIALIZED_CLASS),t.onClose(()=>{this.piano.sendClick(n(n({},e),{},{click:"fermer"}))}),t.onPrimary(()=>{this.piano.sendClick(n(n({},e),{},{click:"se_connecter"})),this.setBookmarkIntentCookies(),this.auth.login()}),t.onSecondary(()=>{this.piano.sendClick(n(n({},e),{},{click:"creer_un_compte"})),this.setBookmarkIntentCookies(),this.auth.subscribe()}))}async setBookmarkIntentCookies(){this.setYearCookie(this.COOKIE_BOOKMARK_INTENT),this.setYearCookie(this.COOKIE_BOOKMARK_INTENT_POPOVER,!1)}async handleBookmarkAction(t=!0){var e,o;this.piano.sendClick({feature:"bookmarks",click:this.isBookmarked?"retrait_bookmark":"ajout_bookmark",zone:null!==(e=null===(o=this.btnBookmark.dataset)||void 0===o?void 0:o.zone)&&void 0!==e?e:""});try{this.setButtonAsLoading(this.btnBookmark),this.isBookmarked?await this.deleteBookmark(t):await this.addBookmark(t)}catch(t){throw this.setButtonAsReady(this.btnBookmark),console.error(t),this.snackbar.show("Une erreur est survenue, veuillez réessayer ultérieurement.","warning"),new Error(`handleBookmarkAction: ${t}`)}}updateBookmarkBtnIcon(t){const e=this.btnBookmark.classList.contains("fi-button--icon-only")?"fi-button--secondary-icon-visible":"fi-button--secondary-start-icon-visible";this.btnBookmark.classList[t](e)}async addBookmark(t=!0){const e={contentId:this.contentId,imagePath:this.btnBookmark.dataset.contentImgPath,link:this.btnBookmark.dataset.contentLink,title:decodeURIComponent(this.btnBookmark.dataset.contentTitle),readTime:Number(this.btnBookmark.dataset.contentReadtime)};await this.bookmark.add(e,()=>{this.setButtonAsReady(this.btnBookmark),document.dispatchEvent(new CustomEvent(this.EVENT_UPDATED,{detail:{contentId:this.contentId,action:"add"}})),t?this.snackbar.show("L'article a bien été sauvegardé dans votre espace.","success",()=>this.bookmarkGuide()):this.bookmarkGuide()})}async deleteBookmark(t=!0){await this.bookmark.delete(this.contentId,()=>{this.setButtonAsReady(this.btnBookmark),document.dispatchEvent(new CustomEvent(this.EVENT_UPDATED,{detail:{contentId:this.contentId,action:"remove"}})),t&&this.snackbar.show("L'article a bien été supprimé de votre espace.","success")})}determineBookmarkGuideScenario(){var t;const e=new Date,o=Number(null!==(t=localStorage.getItem(this.LS_BOOKMARK_LAST_VISIT))&&void 0!==t?t:e.getTime()),i=new Date(o);i.setDate(i.getDate()+14);const a="true"===this.utils.readCookie(this.COOKIE_BOOKMARK_FIRST_USAGE),n="true"===this.utils.readCookie(this.COOKIE_BOOKMARK_SECOND_USAGE),s="true"===this.utils.readCookie(this.COOKIE_BOOKMARK_STOP_POPOVER);return a&&!n?"one":a&&n&&e>i&&!s?"two":null}async bookmarkGuide(){const t=this.determineBookmarkGuideScenario();if(t){const{default:e}=await o.e(5694).then(o.bind(o,7121)),i=new e(this.utils,[{title:"Retrouvez tous vos articles sauvegardés ici",subtitle:"Rendez-vous dans la rubrique “À lire plus tard” pour les consulter.",target:".header-main__account-entry .navigation-item__link",placement:"bottom-end",spotlight:"full",primaryActionLabel:"j'ai compris"}]),a={feature:"bookmarks",zone:"retrouvez_tous_vos_articles_sauvegardes_ici"};setTimeout(()=>{document.querySelector("header.header").dispatchEvent(new CustomEvent("Header::display")),i.show(),this.actionsBeforeScenarioStart(t),this.piano.sendPrint(a)},this.DELAY_POPOVER_PROMOTION);const s=t=>{this.piano.sendClick(n(n({},a),{},{click:t}))};i.onComplete(()=>s("j_ai_compris")),i.onClose(()=>s("fermer"))}}actionsBeforeScenarioStart(t){switch(t){case"one":this.setYearCookie(this.COOKIE_BOOKMARK_SECOND_USAGE),null===localStorage.getItem(this.LS_BOOKMARK_LAST_VISIT)&&localStorage.setItem(this.LS_BOOKMARK_LAST_VISIT,Date.now().toString());break;case"two":this.setYearCookie(this.COOKIE_BOOKMARK_STOP_POPOVER),localStorage.setItem(this.LS_BOOKMARK_LAST_VISIT,Date.now().toString())}}async initPopoverIntent(){var t=this;if(!0===d.globalIntentAutoBookmarking)return;if(d.globalIntentAutoBookmarking=!0,this.isBookmarked)return this.setYearCookie(this.COOKIE_BOOKMARK_INTENT_POPOVER),void this.setYearCookie(this.COOKIE_BOOKMARK_FIRST_USAGE);const e="true"===this.utils.readCookie(this.COOKIE_BOOKMARK_INTENT),a="true"===this.utils.readCookie(this.COOKIE_BOOKMARK_INTENT_POPOVER);l.displayBanner({priority:i.f.BOOKMARK_BUTTON,displayPromise:Promise.resolve(e&&!a),callback:async function(){try{const{default:e}=await o.e(5694).then(o.bind(o,7121)),i=new e(t.utils,[{title:"L'article a bien été sauvegardé",subtitle:'Rendez-vous dans la rubrique "À lire plus tard" pour les consulter.',target:".c-top-actions .bookmark-button",placement:"bottom-start",spotlight:"full"},{title:"Retrouvez tous vos articles sauvegardés ici",subtitle:"Ils sont disponibles à tout moment dans votre espace.",target:".header-main__account-entry .navigation-item__link",placement:"bottom-end",spotlight:"full",primaryActionLabel:"voir mes articles",beforeCallback:()=>{document.querySelector("header.header").dispatchEvent(new CustomEvent("Header::display"))}}]),a={feature:"bookmarks",zone:"sauvegardez_cet_article"};await t.handleBookmarkAction(!1),i.show(),t.piano.sendPrint(a);const s=e=>{t.piano.sendClick(n(n({},a),{},{click:e})),t.setYearCookie(t.COOKIE_BOOKMARK_INTENT_POPOVER),t.setYearCookie(t.COOKIE_BOOKMARK_FIRST_USAGE),"fermer"!==e&&window.location.assign(new URL(`${window.location.origin}${t.BOOKMARKS_URL}`).href)};i.onComplete(()=>s("voir_mes_articles")),i.onClose(()=>s("fermer"))}catch(t){console.error('initPopoverIntent: error during "auto bookmark" after login')}}}),l.updateLoadingState(d.name)}async initPopoverPromo(){const{default:t}=await o.e(5694).then(o.bind(o,7121)),e=t=>{this.piano.sendClick({feature:"bookmarks",content_title:"popin_bookmark",click:t}),this.utils.createCookie(this.COOKIE_BOOKMARK_PROMO,"true",1,"months")},i=new t(this.utils,[{title:"Un article à lire plus tard ? Sauvegardez-le maintenant",subtitle:"Créez votre compte franceinfo pour retrouver vos articles quand vous voulez.",target:".c-top-actions .bookmark-button",placement:"bottom-start",primaryActionLabel:"se connecter",secondaryActionLabel:"créer un compte",beforeCallback:()=>{this.setBookmarkIntentCookies(),e("creer_un_compte"),this.auth.subscribe()}}],{badgeLabel:"nouveau",modal:!1});l.displayBanner({priority:80,displayPromise:Promise.resolve(!0),callback:()=>{i.show(),this.piano.sendPrint({feature:"bookmarks",content_title:"popin_bookmark"}),i.onComplete(()=>{this.setBookmarkIntentCookies(),e("se_connecter"),this.auth.login()}),i.onClose(()=>e("fermer"))}}),l.updateLoadingState(d.name)}setYearCookie(t,e=!0){this.utils.createCookie(t,e.toString(),12,"months")}setButtonAsLoading(t){t.classList.add(this.BTN_LOADING_CLASS),t.setAttribute("disabled","true")}setButtonAsReady(t){t.classList.remove(this.BTN_LOADING_CLASS),t.removeAttribute("disabled")}}s(d,"globalIntentAutoBookmarking",!1),new Promise(t=>{(async()=>{l.addBannersLoading(d.name);const e=await(await o.e(4895).then(o.bind(o,4284))).default,i=await(await o.e(3355).then(o.bind(o,6672))).default,a=await(await o.e(9292).then(o.bind(o,3703))).default,n=await o.e(9980).then(o.bind(o,5321)),s=await(await o.e(3708).then(o.bind(o,3157))).default,r=(t=document)=>{const o=t.querySelectorAll(".bookmark-button:not(.bookmark-button--activated)"),r=[];for(const t of o)t.classList.add("bookmark-button--activated"),r.push(new d(t,e,i,a,n,s));return r};document.addEventListener("EsiBlock::replaceBlockByEsiContent",t=>{const e=t.detail.newElements;for(const t of e)r(t)}),t(r())})()}),e()}catch(k){e(k)}},1)},5613:function(t,e,o){o.d(e,{f:function(){return i}});const i={NL_EVENT_GROUP:90,WEB_PUSH:95,NOTIFICATION_APP:100,MATCH_PANEL:150,EVENT_BANNER:200,ALERT_INFO:300,BOOKMARK_BUTTON:350}}},function(t){t(t.s=4507)}]);