"use strict";(self.webpackChunkfranceinfo_package=self.webpackChunkfranceinfo_package||[]).push([[9640,9648],{9640:function(t,e,n){function i(t,e,n){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e);class s{constructor(t,e){this.utils=t,this.nlCoreForm=e,i(this,"HIDDEN_CLASS","newsletter__form--hidden"),i(this,"ERROR_CLASS","newsletter__form--error"),i(this,"nlEmail",void 0),i(this,"nlBtn",void 0),i(this,"nlActionUrl",void 0),i(this,"nlDetailSource",void 0),i(this,"nlInfo",void 0),this.nlEmail=this.nlCoreForm.querySelector(".newsletter__email"),this.nlBtn=this.nlCoreForm.querySelector(".newsletter__button"),this.nlActionUrl=this.nlCoreForm.getAttribute("action-xhr"),this.nlDetailSource=this.nlCoreForm.querySelector("input[name='detailSource']"),this.nlInfo=this.nlCoreForm.querySelector(".newsletter__form-msg"),this.init()}init(){let t=this.nlDetailSource.dataset.source;if(!t){t="encartsite-franceinfo",t+=window.location.pathname.includes(".html")?"-content":"-taxonomy";const e=window.location.pathname.split("/");e.pop(),t+=`-${e.pop()}`}t+=this.utils.isMobileDevice()?"-mobile ":"-desktop",this.nlDetailSource.value=t,this.nlCoreForm.addEventListener("submit",t=>{t.preventDefault(),this.onSubmit(t)})}onSubmit(t){this.nlEmail.checkValidity()?this.sendNLData():this.nlEmail.focus(),t.preventDefault()}sendNLData(){this.nlInfo.innerHTML="",this.nlBtn.classList.add("fi-button--disabled");const t=new FormData;t.append("email",this.nlEmail.value);const e=this.nlDetailSource.value;t.append("detailSource",e),fetch(this.nlActionUrl,{method:"POST",body:t}).then(t=>{if(t.ok){t.json().then(()=>{this.nlCoreForm.classList.add("newsletter__form--success")}),this.nlEmail.blur();const e=new Event("nl-core-success");this.nlCoreForm.dispatchEvent(e),this.nlInfo.classList.add("newsletter__form-msg--visible")}else t.json().then(t=>{const e=new CustomEvent("input-error",{detail:t.message});this.nlEmail.dispatchEvent(e),this.nlEmail.focus()})}).catch(()=>{const t=new CustomEvent("input-error",{detail:"Un problème réseau est survenu."});this.nlEmail.dispatchEvent(t),this.nlEmail.focus()}).finally(()=>{this.nlBtn.classList.remove("fi-button--disabled")})}show(){this.nlCoreForm.classList.remove(this.HIDDEN_CLASS)}}e.default=new Promise(async t=>{const e=await n.e(9980).then(n.bind(n,5321)),i={},o=()=>{document.querySelectorAll(".newsletter__form:not(.newsletter__form--activated)").forEach(t=>{t.classList.add("newsletter__form--activated");const n=new s(e,t);t.getAttribute("id")&&(i[t.getAttribute("id")]=n)})};o(),document.addEventListener("EsiBlock::replaceBlockByEsiContent",()=>{o()}),t(i)})}},function(t){t(t.s=9640)}]);