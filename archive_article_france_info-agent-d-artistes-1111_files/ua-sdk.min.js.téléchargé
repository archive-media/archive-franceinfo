/*! UA-Web-Push: 694b51b:1766103956418 */!function(){var t,e,n,i,r={8335:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.IvyVersionMatcher=void 0;const r=i(n(6238));e.default=r.default;var o=n(2791);Object.defineProperty(e,"IvyVersionMatcher",{enumerable:!0,get:function(){return i(o).default}})},6238:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n(2842),o=i(n(2791));function s(t,e){if(function(t){return Boolean(t?.not)}(t)){if(Array.isArray(t.not)){if(1!==t.not.length)throw new Error("invalid not predicate; must contain exactly one predicate");return!s(t.not[0],e)}return!s(t.not,e)}if(function(t){return Boolean(t?.and)}(t))return t.and.every((t=>s(t,e)));if(function(t){return Boolean(t?.or)}(t))return t.or.some((t=>s(t,e)));if(function(t){return Boolean(t?.value)}(t))return function(t,e){let{value:n,scope:i,key:c,ignore_case:u}=t;const d=Array.from((0,r.arrayify)(i??[]));c&&d.push(c);const l=a(d,e);if(function(t){return Boolean(void 0!==t?.equals)}(n))return function(t,e,n){let{equals:i}=t;return(0,r.deepEqual)(i,e,n)}(n,l,u);if(function(t){return Boolean(void 0!==t?.at_least)||Boolean(void 0!==t?.at_most)}(n))return function(t,e){let{at_least:n=0,at_most:i=1/0}=t;if(function(t){return"number"==typeof t}(e))return e>=n&&e<=i;if(function(t){return"bigint"==typeof t}(e))return e>=BigInt(n)&&e<=BigInt(i);return!1}(n,l);if(function(t){return Boolean(void 0!==t?.version_matches)}(n))return function(t,e){if("string"!=typeof e)return!1;const n=o.default.newMatcher(t.version_matches);return n.apply(e)}(n,l);if(function(t){return Boolean(void 0!==t?.is_present)}(n))return function(t,e){const n=null!=e;return t.is_present?n:!n}(n,l);if(function(t){return Boolean(t?.array_length)}(n))return function(t,e){let{array_length:n}=t;if(!Array.isArray(e))return!1;return s(n,e.length)}(n,l);if(function(t){return Boolean(t?.array_contains)}(n))return function(t,e){let{array_contains:n,index:i}=t;if(!Array.isArray(e))return!1;if(void 0!==i)return!(i>e.length-1)&&s(n,e[i]);return e.some((t=>s(n,t)))}(n,l);if(function(t){return Object.prototype.hasOwnProperty.call(t,"string_begins")}(n))return function(t,e,n){let{string_begins:i}=t;if("string"!=typeof e)return!1;if(n){const t=new Intl.Collator(void 0,{sensitivity:"base"}),n=e.slice(0,i.length);return 0===t.compare(n,i)}return e.startsWith(i)}(n,l,u);if(function(t){return Object.prototype.hasOwnProperty.call(t,"string_ends")}(n))return function(t,e,n){let{string_ends:i}=t;if("string"!=typeof e)return!1;if(n){const t=new Intl.Collator(void 0,{sensitivity:"base"}),n=e.slice(-1*i.length);return 0===t.compare(n,i)}return e.endsWith(i)}(n,l,u);if(function(t){return Object.prototype.hasOwnProperty.call(t,"string_contains")}(n))return function(t,e,n){let{string_contains:i}=t;if("string"!=typeof e)return!1;if(n){for(let t=0;t<=e.length-i.length;t++){const n=e.substring(t,t+i.length);if((0,r.stringsEqual)(n,i,!0))return!0}return!1}return e.includes(i)}(n,l,u);const h=n;throw new Error(`invalid value matcher ${h}`)}(t,e);throw new Error(`invalid predicate: ${t}`)}function a(t,e){if(Array.isArray(t))for(const n of t)e=a(n,e);else e=e?.[t];return e}e.default=s},2842:function(t,e){"use strict";function n(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return 0===new Intl.Collator(void 0,{sensitivity:n?"base":"variant"}).compare(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=e.stringsEqual=e.arrayify=void 0,e.arrayify=function(t){return Array.isArray(t)?t:[t]},e.stringsEqual=n,e.deepEqual=function t(e,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Object.is(e,i))return!0;if("string"==typeof e&&"string"==typeof i)return n(e,i,r);if("object"!=typeof e||"object"!=typeof i||null===e||null===i)return!1;if(Array.isArray(e)&&Array.isArray(i))return e.length===i.length&&e.every(((e,n)=>t(e,i[n],r)));const o=Object.keys(e),s=Object.keys(i);if(o.length!==s.length)return!1;for(const n of o){if(!(n in i))return!1;if(!t(e[n],i[n],r))return!1}return!0}},2791:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeVersion=void 0;const n="([0-9]+)(\\.[0-9]+)?(\\.[0-9]+)?(?:-[a-zA-Z0-9]+)?",i=`^${n}$`,r=new RegExp(`^(([\\[\\]\\(])(${n})?),((${n})?([\\]\\[\\)]))`),o=new RegExp(i),s=new RegExp("^(.*)\\+$");class a{constructor(t){this.predicate=t}static newMatcher(t){t=t.replace(/\s/g,"");let e=a.parseExactVersionConstraint(t);if(null!==e)return new a(e);if(e=a.parseSubVersionConstraint(t),null!==e)return new a(e);if(e=a.parseVersionRangeConstraint(t),null!==e)return new a(e);throw new Error(`Invalid constraint: ${t}`)}apply(t){return null!==t&&this.predicate.apply(u(t))}static parseSubVersionConstraint(t){const e=t.match(s);if(!e)return null;if("+"===t)return{apply:()=>!0};const n=u(e.length>=2?e[1]:null);return{apply:t=>null!==n&&null!==t&&t.startsWith(n)}}static parseVersionRangeConstraint(t){const e=t.match(r);if(!e)return null;let n,i,o,s;const a=e.length>=8?e[7]:null;d(a)?(n=a.substring(a.length-1),i=a.length>1?new c(a.substring(0,a.length-1)):null):(n=null,i=null);const u=e.length>=2?e[1]:null;return d(u)?(o=u.substring(0,1),s=u.length>1?new c(u.substring(1)):null):(o=null,s=null),")"===n&&null!==i||"("===o&&null!==s?null:{apply:t=>{if(null===t)return!1;const e=new c(t);if(null!==n&&null!==i)switch(n){case"]":if(e.compareTo(i)>0)return!1;break;case"[":if(e.compareTo(i)>=0)return!1}if(null!==o&&null!==s)switch(o){case"[":if(e.compareTo(s)<0)return!1;break;case"]":if(e.compareTo(s)<=0)return!1}return!0}}}static parseExactVersionConstraint(t){const e=u(t);return e?.match(o)?{apply:t=>e===u(t)}:null}}e.default=a;class c{constructor(t){if(this.versionComponent=[0,0,0],this.version=u(t),!this.version)return;const e=this.version.split(".");for(let t=0;t<3&&!(e.length<=t);t++)this.versionComponent[t]=Number.parseInt(e[t])}compareTo(t){for(let e=0;e<3;e++){const n=this.versionComponent[e]-t.versionComponent[e];if(0!==n)return n>0?1:-1}return 0}}function u(t){if(null===t)return null;const e=t.trim(),n=e.indexOf("-");return n>0?e.substring(0,n)+(e.endsWith("+")?"+":""):e}function d(t){return null!==t&&""!==t.trim()}e.normalizeVersion=u},1656:function(t,e){"use strict";e.Z=class{constructor(){this._acquired=!1,this._waitingResolvers=[]}get acquired(){return this._acquired}acquireAsync(){return this._acquired?new Promise((t=>{this._waitingResolvers.push(t)})):(this._acquired=!0,Promise.resolve())}tryAcquire(){return!this._acquired&&(this._acquired=!0,!0)}release(){if(!this._acquired)throw new Error("Cannot release an unacquired lock");if(this._waitingResolvers.length>0){this._waitingResolvers.shift()()}else this._acquired=!1}}},4314:function(t){t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=90)}({17:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var i=n(18),r=function(){function t(){}return t.getFirstMatch=function(t,e){var n=e.match(t);return n&&n.length>0&&n[1]||""},t.getSecondMatch=function(t,e){var n=e.match(t);return n&&n.length>1&&n[2]||""},t.matchAndReturnConst=function(t,e,n){if(t.test(e))return n},t.getWindowsVersionName=function(t){switch(t){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},t.getMacOSVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},t.getAndroidVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&e[1]>=6?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&e[1]>2?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&e[1]>=4?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},t.getVersionPrecision=function(t){return t.split(".").length},t.compareVersions=function(e,n,i){void 0===i&&(i=!1);var r=t.getVersionPrecision(e),o=t.getVersionPrecision(n),s=Math.max(r,o),a=0,c=t.map([e,n],(function(e){var n=s-t.getVersionPrecision(e),i=e+new Array(n+1).join(".0");return t.map(i.split("."),(function(t){return new Array(20-t.length).join("0")+t})).reverse()}));for(i&&(a=s-Math.min(r,o)),s-=1;s>=a;){if(c[0][s]>c[1][s])return 1;if(c[0][s]===c[1][s]){if(s===a)return 0;s-=1}else if(c[0][s]<c[1][s])return-1}},t.map=function(t,e){var n,i=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(n=0;n<t.length;n+=1)i.push(e(t[n]));return i},t.find=function(t,e){var n,i;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(n=0,i=t.length;n<i;n+=1){var r=t[n];if(e(r,n))return r}},t.assign=function(t){for(var e,n,i=t,r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[t].concat(o));var a=function(){var t=o[e];"object"==typeof t&&null!==t&&Object.keys(t).forEach((function(e){i[e]=t[e]}))};for(e=0,n=o.length;e<n;e+=1)a();return t},t.getBrowserAlias=function(t){return i.BROWSER_ALIASES_MAP[t]},t.getBrowserTypeByAlias=function(t){return i.BROWSER_MAP[t]||""},t}();e.default=r,t.exports=e.default},18:function(t,e,n){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=n(91))&&i.__esModule?i:{default:i},o=n(18);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=function(){function t(){}var e,n,i;return t.getParser=function(t,e){if(void 0===e&&(e=!1),"string"!=typeof t)throw new Error("UserAgent should be a string");return new r.default(t,e)},t.parse=function(t){return new r.default(t).getResult()},e=t,i=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(n=null)&&s(e.prototype,n),i&&s(e,i),t}();e.default=a,t.exports=e.default},91:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var i=c(n(92)),r=c(n(93)),o=c(n(94)),s=c(n(95)),a=c(n(17));function c(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(t,e){if(void 0===e&&(e=!1),null==t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==e&&this.parse()}var e=t.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=a.default.find(i.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var t=this;this.parsedResult.os={};var e=a.default.find(r.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(t){var e=this.getOS().name;return t?String(e).toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(t){void 0===t&&(t=!1);var e=this.getPlatform().type;return t?String(e).toLowerCase()||"":e||""},e.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=a.default.find(o.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=a.default.find(s.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return a.default.assign({},this.parsedResult)},e.satisfies=function(t){var e=this,n={},i=0,r={},o=0;if(Object.keys(t).forEach((function(e){var s=t[e];"string"==typeof s?(r[e]=s,o+=1):"object"==typeof s&&(n[e]=s,i+=1)})),i>0){var s=Object.keys(n),c=a.default.find(s,(function(t){return e.isOS(t)}));if(c){var u=this.satisfies(n[c]);if(void 0!==u)return u}var d=a.default.find(s,(function(t){return e.isPlatform(t)}));if(d){var l=this.satisfies(n[d]);if(void 0!==l)return l}}if(o>0){var h=Object.keys(r),f=a.default.find(h,(function(t){return e.isBrowser(t,!0)}));if(void 0!==f)return this.compareVersion(r[f])}},e.isBrowser=function(t,e){void 0===e&&(e=!1);var n=this.getBrowserName().toLowerCase(),i=t.toLowerCase(),r=a.default.getBrowserTypeByAlias(i);return e&&r&&(i=r.toLowerCase()),i===n},e.compareVersion=function(t){var e=[0],n=t,i=!1,r=this.getBrowserVersion();if("string"==typeof r)return">"===t[0]||"<"===t[0]?(n=t.substr(1),"="===t[1]?(i=!0,n=t.substr(2)):e=[],">"===t[0]?e.push(1):e.push(-1)):"="===t[0]?n=t.substr(1):"~"===t[0]&&(i=!0,n=t.substr(1)),e.indexOf(a.default.compareVersions(r,n,i))>-1},e.isOS=function(t){return this.getOSName(!0)===String(t).toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===String(t).toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===String(t).toLowerCase()},e.is=function(t,e){return void 0===e&&(e=!1),this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)},e.some=function(t){var e=this;return void 0===t&&(t=[]),t.some((function(t){return e.is(t)}))},t}();e.default=u,t.exports=e.default},92:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(t){var e={name:"Googlebot"},n=r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/opera/i],describe:function(t){var e={name:"Opera"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opr\/|opios/i],describe:function(t){var e={name:"Opera"},n=r.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/SamsungBrowser/i],describe:function(t){var e={name:"Samsung Internet for Android"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Whale/i],describe:function(t){var e={name:"NAVER Whale Browser"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MZBrowser/i],describe:function(t){var e={name:"MZ Browser"},n=r.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/focus/i],describe:function(t){var e={name:"Focus"},n=r.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/swing/i],describe:function(t){var e={name:"Swing"},n=r.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/coast/i],describe:function(t){var e={name:"Opera Coast"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(t){var e={name:"Opera Touch"},n=r.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/yabrowser/i],describe:function(t){var e={name:"Yandex Browser"},n=r.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/ucbrowser/i],describe:function(t){var e={name:"UC Browser"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Maxthon|mxios/i],describe:function(t){var e={name:"Maxthon"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/epiphany/i],describe:function(t){var e={name:"Epiphany"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/puffin/i],describe:function(t){var e={name:"Puffin"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sleipnir/i],describe:function(t){var e={name:"Sleipnir"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/k-meleon/i],describe:function(t){var e={name:"K-Meleon"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/micromessenger/i],describe:function(t){var e={name:"WeChat"},n=r.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/qqbrowser/i],describe:function(t){var e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},n=r.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/msie|trident/i],describe:function(t){var e={name:"Internet Explorer"},n=r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/\sedg\//i],describe:function(t){var e={name:"Microsoft Edge"},n=r.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/edg([ea]|ios)/i],describe:function(t){var e={name:"Microsoft Edge"},n=r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/vivaldi/i],describe:function(t){var e={name:"Vivaldi"},n=r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/seamonkey/i],describe:function(t){var e={name:"SeaMonkey"},n=r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sailfish/i],describe:function(t){var e={name:"Sailfish"},n=r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return n&&(e.version=n),e}},{test:[/silk/i],describe:function(t){var e={name:"Amazon Silk"},n=r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/phantom/i],describe:function(t){var e={name:"PhantomJS"},n=r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/slimerjs/i],describe:function(t){var e={name:"SlimerJS"},n=r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e={name:"BlackBerry"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e={name:"WebOS Browser"},n=r.default.getFirstMatch(o,t)||r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/bada/i],describe:function(t){var e={name:"Bada"},n=r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/tizen/i],describe:function(t){var e={name:"Tizen"},n=r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/qupzilla/i],describe:function(t){var e={name:"QupZilla"},n=r.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(t){var e={name:"Firefox"},n=r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/electron/i],describe:function(t){var e={name:"Electron"},n=r.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MiuiBrowser/i],describe:function(t){var e={name:"Miui"},n=r.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/chromium/i],describe:function(t){var e={name:"Chromium"},n=r.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/chrome|crios|crmo/i],describe:function(t){var e={name:"Chrome"},n=r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/GSA/i],describe:function(t){var e={name:"Google Search"},n=r.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){var e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe:function(t){var e={name:"Android Browser"},n=r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/playstation 4/i],describe:function(t){var e={name:"PlayStation 4"},n=r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/safari|applewebkit/i],describe:function(t){var e={name:"Safari"},n=r.default.getFirstMatch(o,t);return n&&(e.version=n),e}},{test:[/.*/i],describe:function(t){var e=-1!==t.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:r.default.getFirstMatch(e,t),version:r.default.getSecondMatch(e,t)}}}];e.default=s,t.exports=e.default},93:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},o=n(18),s=[{test:[/Roku\/DVP/],describe:function(t){var e=r.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:o.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(t){var e=r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(t){var e=r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),n=r.default.getWindowsVersionName(e);return{name:o.OS_MAP.Windows,version:e,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(t){var e={name:o.OS_MAP.iOS},n=r.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return n&&(e.version=n),e}},{test:[/macintosh/i],describe:function(t){var e=r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),n=r.default.getMacOSVersionName(e),i={name:o.OS_MAP.MacOS,version:e};return n&&(i.versionName=n),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(t){var e=r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:e}}},{test:function(t){var e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe:function(t){var e=r.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),n=r.default.getAndroidVersionName(e),i={name:o.OS_MAP.Android,version:e};return n&&(i.versionName=n),i}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e=r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),n={name:o.OS_MAP.WebOS};return e&&e.length&&(n.version=e),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e=r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||r.default.getFirstMatch(/\bbb(\d+)/i,t);return{name:o.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(t){var e=r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(t){var e=r.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(t){var e=r.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.PlayStation4,version:e}}}];e.default=s,t.exports=e.default},94:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},o=n(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(t){var e=r.default.getFirstMatch(/(can-l01)/i,t)&&"Nova",n={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(n.model=e),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){var e=t.test(/ipod|iphone/i),n=t.test(/like (ipod|iphone)/i);return e&&!n},describe:function(t){var e=r.default.getFirstMatch(/(ipod|iphone)/i,t);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(t){var e=Number(String(t.getOSVersion()).split(".")[0]);return"android"===t.getOSName(!0)&&e>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];e.default=s,t.exports=e.default},95:function(t,e,n){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=n(17))&&i.__esModule?i:{default:i},o=n(18),s=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(t){if(/\sedg\//i.test(t))return{name:o.ENGINE_MAP.Blink};var e=r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:o.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(t){var e={name:o.ENGINE_MAP.Trident},n=r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){return t.test(/presto/i)},describe:function(t){var e={name:o.ENGINE_MAP.Presto},n=r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){var e=t.test(/gecko/i),n=t.test(/like gecko/i);return e&&!n},describe:function(t){var e={name:o.ENGINE_MAP.Gecko},n=r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(t){var e={name:o.ENGINE_MAP.WebKit},n=r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}}];e.default=s,t.exports=e.default}})},7257:function(t,e,n){"use strict";var i=n(4597),r=n(3584),o=n(7012),s=r("%TypeError%"),a=r("%Function.prototype.apply%"),c=r("%Function.prototype.call%"),u=r("%Reflect.apply%",!0)||i.call(c,a),d=r("%Object.defineProperty%",!0),l=r("%Math.max%");if(d)try{d({},"a",{value:1})}catch(t){d=null}t.exports=function(t){if("function"!=typeof t)throw new s("a function is required");var e=u(i,c,arguments);return o(e,1+l(0,t.length-(arguments.length-1)),!0)};var h=function(){return u(i,a,arguments)};d?d(t.exports,"apply",{value:h}):t.exports.apply=h},1314:function(t,e,n){"use strict";var i=n(4607)(),r=n(3584),o=i&&r("%Object.defineProperty%",!0);if(o)try{o({},"a",{value:1})}catch(t){o=!1}var s=r("%SyntaxError%"),a=r("%TypeError%"),c=n(1700);t.exports=function(t,e,n){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new a("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,r=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,d=arguments.length>6&&arguments[6],l=!!c&&c(t,e);if(o)o(t,e,{configurable:null===u&&l?l.configurable:!u,enumerable:null===i&&l?l.enumerable:!i,value:n,writable:null===r&&l?l.writable:!r});else{if(!d&&(i||r||u))throw new s("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=n}}},7193:function(t){"use strict";var e=Object.prototype.toString,n=Math.max,i=function(t,e){for(var n=[],i=0;i<t.length;i+=1)n[i]=t[i];for(var r=0;r<e.length;r+=1)n[r+t.length]=e[r];return n};t.exports=function(t){var r=this;if("function"!=typeof r||"[object Function]"!==e.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var o,s=function(t,e){for(var n=[],i=e||0,r=0;i<t.length;i+=1,r+=1)n[r]=t[i];return n}(arguments,1),a=n(0,r.length-s.length),c=[],u=0;u<a;u++)c[u]="$"+u;if(o=Function("binder","return function ("+function(t,e){for(var n="",i=0;i<t.length;i+=1)n+=t[i],i+1<t.length&&(n+=e);return n}(c,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof o){var e=r.apply(this,i(s,arguments));return Object(e)===e?e:this}return r.apply(t,i(s,arguments))})),r.prototype){var d=function(){};d.prototype=r.prototype,o.prototype=new d,d.prototype=null}return o}},4597:function(t,e,n){"use strict";var i=n(7193);t.exports=Function.prototype.bind||i},3584:function(t,e,n){"use strict";var i,r=SyntaxError,o=Function,s=TypeError,a=function(t){try{return o('"use strict"; return ('+t+").constructor;")()}catch(t){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(t){c=null}var u=function(){throw new s},d=c?function(){try{return u}catch(t){try{return c(arguments,"callee").get}catch(t){return u}}}():u,l=n(563)(),h=n(7365)(),f=Object.getPrototypeOf||(h?function(t){return t.__proto__}:null),p={},v="undefined"!=typeof Uint8Array&&f?f(Uint8Array):i,y={"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":l&&f?f([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?i:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":l&&f?f(f([][Symbol.iterator]())):i,"%JSON%":"object"==typeof JSON?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&l&&f?f((new Map)[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&l&&f?f((new Set)[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":l&&f?f(""[Symbol.iterator]()):i,"%Symbol%":l?Symbol:i,"%SyntaxError%":r,"%ThrowTypeError%":d,"%TypedArray%":v,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet};if(f)try{null.error}catch(t){var _=f(f(t));y["%Error.prototype%"]=_}var g=function t(e){var n;if("%AsyncFunction%"===e)n=a("async function () {}");else if("%GeneratorFunction%"===e)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)n=a("async function* () {}");else if("%AsyncGenerator%"===e){var i=t("%AsyncGeneratorFunction%");i&&(n=i.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&f&&(n=f(r.prototype))}return y[e]=n,n},m={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=n(4597),w=n(4057),E=b.call(Function.call,Array.prototype.concat),S=b.call(Function.apply,Array.prototype.splice),A=b.call(Function.call,String.prototype.replace),I=b.call(Function.call,String.prototype.slice),x=b.call(Function.call,RegExp.prototype.exec),M=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,O=function(t,e){var n,i=t;if(w(m,i)&&(i="%"+(n=m[i])[0]+"%"),w(y,i)){var o=y[i];if(o===p&&(o=g(i)),void 0===o&&!e)throw new s("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:o}}throw new r("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new s('"allowMissing" argument must be a boolean');if(null===x(/^%?[^%]*%?$/,t))throw new r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(t){var e=I(t,0,1),n=I(t,-1);if("%"===e&&"%"!==n)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==e)throw new r("invalid intrinsic syntax, expected opening `%`");var i=[];return A(t,M,(function(t,e,n,r){i[i.length]=n?A(r,P,"$1"):e||t})),i}(t),i=n.length>0?n[0]:"",o=O("%"+i+"%",e),a=o.name,u=o.value,d=!1,l=o.alias;l&&(i=l[0],S(n,E([0,1],l)));for(var h=1,f=!0;h<n.length;h+=1){var p=n[h],v=I(p,0,1),_=I(p,-1);if(('"'===v||"'"===v||"`"===v||'"'===_||"'"===_||"`"===_)&&v!==_)throw new r("property names with quotes must have matching quotes");if("constructor"!==p&&f||(d=!0),w(y,a="%"+(i+="."+p)+"%"))u=y[a];else if(null!=u){if(!(p in u)){if(!e)throw new s("base intrinsic for "+t+" exists, but the property is not available.");return}if(c&&h+1>=n.length){var g=c(u,p);u=(f=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:u[p]}else f=w(u,p),u=u[p];f&&!d&&(y[a]=u)}}return u}},1700:function(t,e,n){"use strict";var i=n(3584)("%Object.getOwnPropertyDescriptor%",!0);if(i)try{i([],"length")}catch(t){i=null}t.exports=i},4607:function(t,e,n){"use strict";var i=n(3584)("%Object.defineProperty%",!0),r=function(){if(i)try{return i({},"a",{value:1}),!0}catch(t){return!1}return!1};r.hasArrayLengthDefineBug=function(){if(!r())return null;try{return 1!==i([],"length",{value:1}).length}catch(t){return!0}},t.exports=r},7365:function(t){"use strict";var e={foo:{}},n=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof n)}},563:function(t,e,n){"use strict";var i="undefined"!=typeof Symbol&&Symbol,r=n(9956);t.exports=function(){return"function"==typeof i&&("function"==typeof Symbol&&("symbol"==typeof i("foo")&&("symbol"==typeof Symbol("bar")&&r())))}},9956:function(t){"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),n=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var i=Object.getOwnPropertySymbols(t);if(1!==i.length||i[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},4057:function(t,e,n){"use strict";var i=Function.prototype.call,r=Object.prototype.hasOwnProperty,o=n(4597);t.exports=o.call(i,r)},953:function(t){t.exports=function(t){return"string"==typeof t&&e.test(t)&&!isNaN(Date.parse(t))};var e=new RegExp("^\\d{4}-\\d{2}-\\d{2}((T\\d{2}:\\d{2}(:\\d{2})?)(\\.\\d{1,6})?(Z|(\\+|-)\\d{2}:\\d{2})?)?$")},3577:function(t,e,n){"use strict";var i=("undefined"!=typeof JSON?JSON:n(2949)).stringify,r=n(1374),o=n(6675),s=n(7257),a=function(t,e){for(var n="",i=0;i<t;i+=1)n+=e;return n},c=function(t,e,n){return n};t.exports=function(t){var e=arguments.length>1?arguments[1]:void 0,n=e&&e.space||"";"number"==typeof n&&(n=a(n," "));var u=!!e&&"boolean"==typeof e.cycles&&e.cycles,d=e&&e.replacer?s(e.replacer):c,l="function"==typeof e?e:e&&e.cmp,h=l&&function(t){var e=l.length>2&&function(e){return t[e]};return function(n,i){return l({key:n,value:t[n]},{key:i,value:t[i]},e?{__proto__:null,get:e}:void 0)}},f=[];return function t(e,s,c,l){var p=n?"\n"+a(l,n):"",v=n?": ":":";if(c&&c.toJSON&&"function"==typeof c.toJSON&&(c=c.toJSON()),void 0!==(c=d(e,s,c))){if("object"!=typeof c||null===c)return i(c);if(r(c)){for(var y="",_=0;_<c.length;_++){var g=t(c,_,c[_],l+1)||i(null);y+=p+n+g,_+1<c.length&&(y+=",")}return"["+y+p+"]"}if(-1!==f.indexOf(c)){if(u)return i("__cycle__");throw new TypeError("Converting circular structure to JSON")}f.push(c);var m=o(c).sort(h&&h(c)),b=(y="",!1);for(_=0;_<m.length;_++){var w=t(c,s=m[_],c[s],l+1);if(w){var E=i(s)+v+w;y+=(b?",":"")+p+n+E,b=!0}}return f.splice(f.indexOf(c),1),"{"+y+p+"}"}}({"":t},"",t,0)}},1374:function(t){var e={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==e.call(t)}},2949:function(t,e,n){"use strict";e.parse=n(9374),e.stringify=n(267)},9374:function(t){"use strict";var e,n,i,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function o(t){throw{name:"SyntaxError",message:t,at:e,text:i}}function s(t){return t&&t!==n&&o("Expected '"+t+"' instead of '"+n+"'"),n=i.charAt(e),e+=1,n}function a(){var t,e="";for("-"===n&&(e="-",s("-"));n>="0"&&n<="9";)e+=n,s();if("."===n)for(e+=".";s()&&n>="0"&&n<="9";)e+=n;if("e"===n||"E"===n)for(e+=n,s(),"-"!==n&&"+"!==n||(e+=n,s());n>="0"&&n<="9";)e+=n,s();return t=Number(e),isFinite(t)||o("Bad number"),t}function c(){var t,e,i,a="";if('"'===n)for(;s();){if('"'===n)return s(),a;if("\\"===n)if(s(),"u"===n){for(i=0,e=0;e<4&&(t=parseInt(s(),16),isFinite(t));e+=1)i=16*i+t;a+=String.fromCharCode(i)}else{if("string"!=typeof r[n])break;a+=r[n]}else a+=n}o("Bad string")}function u(){for(;n&&n<=" ";)s()}function d(){switch(u(),n){case"{":return function(){var t,e={};if("{"===n){if(s("{"),u(),"}"===n)return s("}"),e;for(;n;){if(t=c(),u(),s(":"),Object.prototype.hasOwnProperty.call(e,t)&&o('Duplicate key "'+t+'"'),e[t]=d(),u(),"}"===n)return s("}"),e;s(","),u()}}o("Bad object")}();case"[":return function(){var t=[];if("["===n){if(s("["),u(),"]"===n)return s("]"),t;for(;n;){if(t.push(d()),u(),"]"===n)return s("]"),t;s(","),u()}}o("Bad array")}();case'"':return c();case"-":return a();default:return n>="0"&&n<="9"?a():function(){switch(n){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null;default:o("Unexpected '"+n+"'")}}()}}t.exports=function(t,r){var s;return i=t,e=0,n=" ",s=d(),u(),n&&o("Syntax error"),"function"==typeof r?function t(e,n){var i,o,s=e[n];if(s&&"object"==typeof s)for(i in d)Object.prototype.hasOwnProperty.call(s,i)&&(void 0===(o=t(s,i))?delete s[i]:s[i]=o);return r.call(e,n,s)}({"":s},""):s}},267:function(t){"use strict";var e,n,i,r=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function s(t){return r.lastIndex=0,r.test(t)?'"'+t.replace(r,(function(t){var e=o[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+t+'"'}function a(t,r){var o,c,u,d,l,h=e,f=r[t];switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(t)),"function"==typeof i&&(f=i.call(r,t,f)),typeof f){case"string":return s(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";if(e+=n,l=[],"[object Array]"===Object.prototype.toString.apply(f)){for(d=f.length,o=0;o<d;o+=1)l[o]=a(o,f)||"null";return u=0===l.length?"[]":e?"[\n"+e+l.join(",\n"+e)+"\n"+h+"]":"["+l.join(",")+"]",e=h,u}if(i&&"object"==typeof i)for(d=i.length,o=0;o<d;o+=1)"string"==typeof(c=i[o])&&(u=a(c,f))&&l.push(s(c)+(e?": ":":")+u);else for(c in f)Object.prototype.hasOwnProperty.call(f,c)&&(u=a(c,f))&&l.push(s(c)+(e?": ":":")+u);return u=0===l.length?"{}":e?"{\n"+e+l.join(",\n"+e)+"\n"+h+"}":"{"+l.join(",")+"}",e=h,u}}t.exports=function(t,r,o){var s;if(e="",n="","number"==typeof o)for(s=0;s<o;s+=1)n+=" ";else"string"==typeof o&&(n=o);if(i=r,r&&"function"!=typeof r&&("object"!=typeof r||"number"!=typeof r.length))throw new Error("JSON.stringify");return a("",{"":t})}},3934:function(t,e,n){"use strict";var i;if(!Object.keys){var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,s=n(6568),a=Object.prototype.propertyIsEnumerable,c=!a.call({toString:null},"toString"),u=a.call((function(){}),"prototype"),d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(t){var e=t.constructor;return e&&e.prototype===t},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!h["$"+t]&&r.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{l(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();i=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===o.call(t),i=s(t),a=e&&"[object String]"===o.call(t),h=[];if(!e&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var p=u&&n;if(a&&t.length>0&&!r.call(t,0))for(var v=0;v<t.length;++v)h.push(String(v));if(i&&t.length>0)for(var y=0;y<t.length;++y)h.push(String(y));else for(var _ in t)p&&"prototype"===_||!r.call(t,_)||h.push(String(_));if(c)for(var g=function(t){if("undefined"==typeof window||!f)return l(t);try{return l(t)}catch(t){return!1}}(t),m=0;m<d.length;++m)g&&"constructor"===d[m]||!r.call(t,d[m])||h.push(d[m]);return h}}t.exports=i},6675:function(t,e,n){"use strict";var i=Array.prototype.slice,r=n(6568),o=Object.keys,s=o?function(t){return o(t)}:n(3934),a=Object.keys;s.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return r(t)?a(i.call(t)):a(t)})}else Object.keys=s;return Object.keys||s},t.exports=s},6568:function(t){"use strict";var e=Object.prototype.toString;t.exports=function(t){var n=e.call(t),i="[object Arguments]"===n;return i||(i="[object Array]"!==n&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===e.call(t.callee)),i}},7012:function(t,e,n){"use strict";var i=n(3584),r=n(1314),o=n(4607)(),s=n(1700),a=i("%TypeError%"),c=i("%Math.floor%");t.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||c(e)!==e)throw new a("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,u=!0;if("length"in t&&s){var d=s(t,"length");d&&!d.configurable&&(i=!1),d&&!d.writable&&(u=!1)}return(i||u||!n)&&(o?r(t,"length",e,!0,!0):r(t,"length",e)),t}},1729:function(t,e){"use strict";e.Z=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},8794:function(t,e,n){"use strict";var i;n.d(e,{Z:function(){return o}});var r=new Uint8Array(16);function o(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}},7376:function(t,e,n){"use strict";for(var i=n(4721),r=[],o=0;o<256;++o)r.push((o+256).toString(16).substr(1));e.Z=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase();if(!(0,i.Z)(n))throw TypeError("Stringified UUID is invalid");return n}},651:function(t,e,n){"use strict";var i=n(8794),r=n(7376);e.Z=function(t,e,n){var o=(t=t||{}).random||(t.rng||i.Z)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(var s=0;s<16;++s)e[n+s]=o[s];return e}return(0,r.Z)(o)}},4721:function(t,e,n){"use strict";var i=n(1729);e.Z=function(t){return"string"==typeof t&&i.Z.test(t)}},1297:function(t,e,n){"use strict";n.d(e,{aw:function(){return r},default:function(){return o}});var i=n(2467);const r="0.0.0";var o={VERSION:"2.14.8",appVersion:r,configured:!1,workerUrl:"/push-worker.js",_disableServiceWorker:!1,apiUrl:"",storagePrefix:"_ua_sdk",deprecatedStoragePrefix:null,disableAnalytics:!1,appKey:"",secret:null,token:null,defaultIcon:"",defaultTitle:"",defaultActionURL:"",vapidPublicKey:null,debug:!1,websitePushId:null,migrateAPNsSafari:!1,workerUpdateTicketDuration:{minutes:5,seconds:0},dataCollectionOptInEnabled:!1,skipWaiting:!0,allowedDomains:null,enabledFeatures:[...i.H],components:{inAppAutomation:{enabled:!0,startInPausedState:!1,displayIntervalMs:0,matchBrowserDarkMode:!0,displayBreakpoints:{medium:1024,large:1920}},embeddedViews:{}},contacts:{namedUserTtlMs:2592e6,_forceExpireNamedUsers:!1},subscriptionLists:{cacheTtlMs:3e5,cacheMissStaleResponseTtlMs:3e4},remoteData:{deferredTimeoutMs:61e3,additionalAudienceCheckTimeoutMs:61e3,audienceCheckCacheTtlMs:6e5,obsoleteAfterMs:2592e5,foregroundRefreshInterval:{minutes:5}},deferred:{featureFlagCacheTtlMs:6e5},reports:{requestTimeoutMs:6e4,reportingPotentialLagMs:6e5}}},56:function(t,e,n){"use strict";n.d(e,{G4:function(){return s},I5:function(){return l},Ip:function(){return c},U4:function(){return r},Vp:function(){return i},eW:function(){return h},pz:function(){return a},uE:function(){return o},yO:function(){return u},yU:function(){return f},zW:function(){return d}});const i="default",r="tags",o="queued_events",s="iaa_schedule",a="iaa_state",c="iaa_trigger",u="frequency_constraints",d="frequency_occurrence",l="message_display_history",h="hashing_cache",f="remote_data_listing"},142:function(t,e,n){"use strict";n.d(e,{A:function(){return i}});class i extends Error{constructor(t){super(t),Object.setPrototypeOf(this,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name=this.constructor.name}}},2697:function(t,e,n){"use strict";n.r(e),n.d(e,{AnalyticsDisabledError:function(){return s},DataCollectionDisabledError:function(){return r},FeatureCannotEnableError:function(){return o},FeatureDisabledError:function(){return l},InvalidConfigurationError:function(){return u},InvalidValueError:function(){return h},ReportingDisabledError:function(){return i},UnsupportedContextError:function(){return c},UserDeniedPermissionError:function(){return d},ValidationError:function(){return a}});class i extends Error{constructor(t="reporting disabled"){super(t),Object.setPrototypeOf(this,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name=this.constructor.name}}class r extends i{constructor(t="data collection is not enabled"){super(t),Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,r),this.name=this.constructor.name}}class o extends r{constructor(t="data collection is not enabled"){super(t),Object.setPrototypeOf(this,o.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,o),this.name=this.constructor.name}}class s extends i{constructor(t="analytics are not enabled"){super(t),Object.setPrototypeOf(this,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,s),this.name=this.constructor.name}}class a extends Error{constructor(t){super(t),Object.setPrototypeOf(this,a.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,a),this.name=this.constructor.name}}class c extends Error{constructor(t){super(t),Object.setPrototypeOf(this,c.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,c),this.name=this.constructor.name}}class u extends Error{constructor(t){super(t),Object.setPrototypeOf(this,u.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,u),this.name=this.constructor.name}}class d extends Error{constructor(t){super(t),Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,d),this.name=this.constructor.name}}class l extends Error{constructor(t="feature is disabled"){super(t),Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,d),this.name=this.constructor.name}}class h extends TypeError{constructor(t="The provided name is not valid."){super(t),Object.setPrototypeOf(this,h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h),this.name=this.constructor.name}}},313:function(t,e,n){"use strict";n.d(e,{eh:function(){return h},oN:function(){return c},qw:function(){return l}});var i=n(651),r=n(510),o=n(2369),s=n(5314),a=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class c extends r.y{constructor(t,e,{_modelFactory:n}={}){super(),this._container=t,this._originalContents=Array.from(t.childNodes);const i=this._onPendingEmbeddedChange.bind(this);this._model=n?n(i):new u(e,i),this._model.subscribe()}_onPendingEmbeddedChange(){return a(this,void 0,void 0,(function*(){yield this.render(),this.dispatchTypedEvent("displayChange",new CustomEvent("displayChange",{detail:{isDisplaying:this.isDisplaying}}))}))}render(){return a(this,void 0,void 0,(function*(){const t=this._model.nextView(),e=t?[yield t.render()]:Array.from(this._originalContents);return this._container.replaceChildren(...e),this._container}))}get isDisplaying(){return void 0!==this._model.nextView()}destroy(){return a(this,void 0,void 0,(function*(){this._model.unsubscribe(),this._container.replaceChildren(...this._originalContents)}))}}class u{constructor(t,e,{_queue:n=l.shared,_viewSorter:i=v.shared,_viewFactory:r}={}){this.embeddedId=t,this._views=[],this._onChangeCallback=e,this._viewSorter=i,this._viewFactory=null!=r?r:t=>new d(t,i),this._queue=n,this._observer={onAddEmbedded:this.onAddEmbedded.bind(this),onRemoveEmbedded:this.onRemoveEmbedded.bind(this)}}onAddEmbedded(t){return a(this,void 0,void 0,(function*(){const e=this._viewFactory(t);this._views.push(e),this._onChangeCallback()}))}onRemoveEmbedded(t){return a(this,void 0,void 0,(function*(){const e=[],n=[];this._views.forEach((i=>{i.pendingEmbedded.instanceId===t.instanceId?e.push(i):n.push(i)})),this._views=n,this._onChangeCallback(),yield Promise.all(e.map((t=>t.destroy())))}))}subscribe(){this._queue.registerObserver(this.embeddedId,this._observer)}unsubscribe(){this._queue.removeObserver(this.embeddedId,this._observer),this._views.forEach((t=>t.destroy())),this._views=[]}nextView(){return this._viewSorter.nextView(this.embeddedId,this._views)}}class d{constructor(t,e){this._thomasObject=null,this._container=document.createElement("div"),this._container.style.width="100%",this._container.style.height="100%",this.pendingEmbedded=t,this._viewSorter=e}render(){return a(this,void 0,void 0,(function*(){if(!this._thomasObject){const{createThomas:t,definition:e,interactions:n}=this.pendingEmbedded;this._thomasObject=t(this._container,{definition:e,interactions:n}),this.pendingEmbedded.delegate.onWillDisplay(),this._thomasObject.start(),this._viewSorter.onViewDisplayed(this.pendingEmbedded)}return this._container}))}destroy(){return a(this,void 0,void 0,(function*(){this._thomasObject&&(this.pendingEmbedded.delegate.onFinishedDisplay(),this._thomasObject.stop()),this._thomasObject=null}))}}class l{constructor(){this._pendingList=[],this._observers={}}addEmbedded(t){var e;this._pendingList.push(t);const n=null!==(e=this._observers[t.embeddedInfo.embeddedId])&&void 0!==e?e:[];for(const e of n)e.onAddEmbedded(t)}removeEmbedded(t){var e;this._pendingList=this._pendingList.filter((e=>e.instanceId!==t.instanceId));const n=null!==(e=this._observers[t.embeddedId])&&void 0!==e?e:[];for(const e of n)e.onRemoveEmbedded(t)}removeAllEmbedded(){[...this._pendingList].forEach((t=>this.removeEmbedded(t.embeddedInfo))),this._pendingList=[],this._observers={}}registerObserver(t,e){this._observers[t]||(this._observers[t]=[]),this._observers[t].push(e),this._pendingList.filter((e=>e.embeddedInfo.embeddedId===t)).forEach((t=>e.onAddEmbedded(t)))}removeObserver(t,e){this._observers[t]&&(this._observers[t]=this._observers[t].filter((t=>t!==e)))}}l.shared=new l;class h{constructor(t){this._embeddedViewFactory=t,this.selectors=new p(t)}create(t,e){return this._embeddedViewFactory(t,e)}}const f="ua-embedded";class p{constructor(t){this._embeddedViewFactory=t,this._selectorToEmbeddedIdMap={},this._managedViews={},this._observer=null}_createManaged(t,e,n){var r;const o=`ua-embedded-${(0,i.Z)()}`;t.classList.add(f,o);const s=this._embeddedViewFactory(t,e);this._managedViews[n]=null!==(r=this._managedViews[n])&&void 0!==r?r:[],this._managedViews[n].push({id:o,view:s})}_removeManaged(t,e){const n=this._managedViews[e],i=n.findIndex((e=>t.classList.contains(e.id)));if(i>=0){const{id:e,view:r}=n[i];t.classList.remove(f,e),r.destroy(),n.splice(i,1)}}_startObserver(){if(this._observer)return;const t=e=>{if(e instanceof HTMLElement)for(const[t,n]of Object.entries(this._selectorToEmbeddedIdMap))e.matches(t)&&this._createManaged(e,n,t);e.childNodes.forEach(t)},e=t=>{if(t instanceof HTMLElement)for(const e of Object.keys(this._selectorToEmbeddedIdMap))t.matches(e)&&this._removeManaged(t,e);t.childNodes.forEach(e)},n=t=>{if(t instanceof HTMLElement)for(const[e,n]of Object.entries(this._selectorToEmbeddedIdMap))t.matches(`${e}:not(.${f})`)&&this._createManaged(t,n,e),t.matches(`.${f}:not(${e})`)&&this._removeManaged(t,e)};this._observer=new MutationObserver((i=>{for(const r of i)switch(r.type){case"attributes":{const t=r.target;n(t);break}case"childList":for(const e of Array.from(r.addedNodes))t(e);for(const t of Array.from(r.removedNodes))e(t)}})),this._observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0})}_stopObserver(){var t;null===(t=this._observer)||void 0===t||t.disconnect(),this._observer=null}set(t,e){this.remove(t),this._selectorToEmbeddedIdMap[t]=e;const n=document.querySelectorAll(t);for(const i of Array.from(n))i instanceof HTMLElement&&this._createManaged(i,e,t);this._startObserver()}setAll(t){if(!(0,s.Uy)(t))throw new TypeError("selectors must be a mapping from CSS selector to embedded ID");this.removeAll(),this._selectorToEmbeddedIdMap=t;for(const[t,e]of Object.entries(this._selectorToEmbeddedIdMap)){this._managedViews[t]=[];const n=document.querySelectorAll(t);for(const i of Array.from(n))i instanceof HTMLElement&&this._createManaged(i,e,t)}Object.keys(this._selectorToEmbeddedIdMap).length>0&&this._startObserver()}remove(t){var e,n;delete this._selectorToEmbeddedIdMap[t],0===Object.keys(this._selectorToEmbeddedIdMap).length&&this._stopObserver();for(const{id:i,view:r}of null!==(e=this._managedViews[t])&&void 0!==e?e:[])null===(n=document.querySelector(`.${i}`))||void 0===n||n.classList.remove(f,i),r.destroy();delete this._managedViews[t]}removeAll(){var t;this._stopObserver(),document.querySelectorAll(`.${f}`).forEach((t=>t.classList.remove(f)));for(const e of Object.values(this._managedViews))for(const{id:n,view:i}of e)null===(t=document.querySelector(`.${n}`))||void 0===t||t.classList.remove(n),i.destroy();this._managedViews={}}}class v{constructor(){this._lastDisplayed={}}onViewDisplayed(t){const{embeddedId:e,instanceId:n}=t.embeddedInfo;(0,o.ZP)(`Updating last displayed for ${e}: ${n}`),this._lastDisplayed[e]=n}nextView(t,e){const n=this._lastDisplayed[t];if(n){const i=e.find((t=>t.pendingEmbedded.embeddedInfo.instanceId===n));if(i)return(0,o.ZP)(`Selecting previously displayed view for ${t}: ${n}`),i}const i=[...e].sort(((t,e)=>{var n,i;const r=(null!==(n=t.pendingEmbedded.priority)&&void 0!==n?n:0)-(null!==(i=e.pendingEmbedded.priority)&&void 0!==i?i:0);return 0!==r?r:t.pendingEmbedded.triggeredAt-e.pendingEmbedded.triggeredAt}))[0];if(i)return(0,o.ZP)(`Selecting priority sorted view for ${t}: ${i.pendingEmbedded.instanceId}`),i}}v.shared=new v},2467:function(t,e,n){"use strict";n.d(e,{H:function(){return i}});const i=["push","in_app_automation","tags_and_attributes","contacts","feature_flags","analytics"]},2591:function(t,e,n){"use strict";n.d(e,{Hb:function(){return g},q0:function(){return v},TP:function(){return y},xA:function(){return _},f6:function(){return p},ZP:function(){return f}});var i=n(2697),r=n(3518),o=n(510),s=n(827),a=n(2369),c=n(5314);const u=["seconds","minutes","hours","days","weeks","months","years"];var d=n(9553),l=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},h=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n};class f extends o.y{constructor(t,e,n,i,r,o,s,c,{sdkVersion:u,foregroundRefreshInterval:d}){super(),this._debug=(0,a.g$)("remote-data"),this._sdkEnabled=t,this._sources=e,this._locale=n,this._sdkVersion=u,this._notifier=i,this._variantSeedProvider=r,this._lifecycle=o,this._interval=s,this._foregroundRefreshInterval=d,this._appConfig=c,this._notifier.addEventListener("remote_data:refresh",(({detail:t})=>{if(t.sdkVersion!==this._sdkVersion)return void this._debug(`dropping refresh message due to mismatched sdk versions; source: ${t.sdkVersion}, destination: ${this._sdkVersion}`);this._debug("bubbling broadcast refresh message");const e=new CustomEvent("refresh",{detail:t});this.dispatchTypedEvent("refresh",e)})),this._lifecycle.addEventListener("contact",(t=>l(this,void 0,void 0,(function*(){(yield this._sdkEnabled())&&(yield this._onContactEvent(t.detail.payload)),this.dispatchTypedEvent("_contact_handled",new CustomEvent("_contact_handled"))})))),this._lifecycle.addEventListener("locale",(t=>l(this,void 0,void 0,(function*(){(yield this._sdkEnabled())&&(yield this._onLocaleEvent(t.detail.payload)),this.dispatchTypedEvent("_locale_handled",new CustomEvent("_locale_handled"))})))),this._lifecycle.addEventListener("foreground",(t=>l(this,void 0,void 0,(function*(){(yield this._sdkEnabled())&&(yield this._onForegroundEvent(t.detail.payload)),this.dispatchTypedEvent("_foreground_handled",new CustomEvent("_foreground_handled"))})))),this._appConfig.addEventListener("config_update",(t=>l(this,void 0,void 0,(function*(){(yield this._sdkEnabled())&&(yield this._onConfigEvent(t.detail)),this.dispatchTypedEvent("_config_handled",new CustomEvent("_config_handled"))}))))}_handleRefresh(t){return l(this,void 0,void 0,(function*(){yield this._appConfig.store(t);const e={sdkVersion:this._sdkVersion,payloadsModifiedAt:t.reduce(((t,e)=>{var n;const i=(0,s.V)(e.timestamp).getTime();return(!t[e.type]||(null!==(n=t[e.type])&&void 0!==n?n:0)<i)&&(t[e.type]=i),t}),{})},n=new CustomEvent("refresh",{detail:e});this.dispatchTypedEvent("refresh",n),this._debug("broadcasting remote data refresh"),this._notifier.broadcast(e)}))}_onContactEvent(t){return l(this,void 0,void 0,(function*(){const e=yield this._getParams();switch(t.type){case"identify":case"resolve":if(t.contactIdSame)return;case"reset":return this._debug("refreshing remote data due to contact change",t),yield Promise.all(this._sources.map((t=>t.markStale(e)))),void(yield this._refresh(e));case"attribute_mutation":case"subscription_list_mutation":case"tag_mutation":return;default:throw new Error(`unhandled contact event ${t}`)}}))}_onForegroundEvent(t){return l(this,void 0,void 0,(function*(){if(!(yield this._interval.getTicketForOperation("foreground_refresh",this._foregroundRefreshInterval)))return void this._debug("no ticket available for foreground refresh");this._debug("refreshing remote data due to foreground event",t);const e=yield this._getParams();yield Promise.all(this._sources.map((t=>t.markStale(e)))),yield this._refresh(e)}))}_onLocaleEvent(t){return l(this,void 0,void 0,(function*(){this._debug("refreshing remote data due to locale change event",t);const e=yield this._getParams();yield Promise.all(this._sources.map((t=>t.markStale(e)))),yield this._refresh(e)}))}_onConfigEvent(t){return l(this,void 0,void 0,(function*(){this._debug("refreshing remote data due to config update",t);const e=yield this._getParams();yield this._refresh(e)}))}_getParams(){return l(this,void 0,void 0,(function*(){return{locale:yield this._locale(),randomValue:yield this._variantSeedProvider.variantSeed(),sdkVersion:this._sdkVersion}}))}get(){return l(this,void 0,void 0,(function*(){if(!(yield this._sdkEnabled()))throw new i.FeatureDisabledError("SDK is not enabled");const t=yield this._getParams();let e=!1;const n=(yield Promise.all(this._sources.map((n=>l(this,void 0,void 0,(function*(){const i=yield n.get(t);if("current"===(null==i?void 0:i.status))return i;this._debug("refreshing remote data due to outdated results, status:",null==i?void 0:i.status);const r=yield n.refresh(t);if("failed"===r.type){if(!i)throw new Error("failed to refresh uninitialized source");return this._debug("reusing previous remote data results due to failed refresh",r),i}return"disabled"!==r.type?("refreshed"===r.type&&(e=!0),r.data):void 0})))))).filter((t=>void 0!==t));n.some((t=>"current"!==t.status))&&this._debug("received non-current results, attempting a best-effort refresh");const r=n.reduce(((t,e)=>(t.push(...e.payloads),t)),[]);return e&&this._handleRefresh(r),r}))}refresh(){return l(this,void 0,void 0,(function*(){if(!(yield this._sdkEnabled()))throw new i.FeatureDisabledError("SDK is not enabled");const t=yield this._getParams();return yield Promise.all(this._sources.map((e=>e.markStale(t)))),this._refresh(t)}))}_refresh(t){return l(this,void 0,void 0,(function*(){yield this._interval.recordOperation("foreground_refresh");const e=[],n=(yield Promise.all(this._sources.map((n=>l(this,void 0,void 0,(function*(){const i=yield n.refresh(t);return"failed"!==i.type&&"disabled"!==i.type&&e.push(...i.data.payloads),i.type})))))).reduce(((t,e)=>"failed"===e||"failed"===t?"failed":"refreshed"===e||"refreshed"===t?"refreshed":"disabled"===e?"skipped":e),"skipped");switch(n){case"refreshed":return yield this._handleRefresh(e),n;case"failed":case"disabled":case"skipped":return n;default:throw new Error(`unhandled refresh result ${n}`)}}))}}class p{constructor(t){this._remote=t}get(t){return l(this,void 0,void 0,(function*(){const e=yield this.list();for(const n of e)if(n.id===t)return n;return null}))}list(){return l(this,void 0,void 0,(function*(){const t=yield this._remote.get(),e=[];return t.filter(d.uy).forEach((t=>{t.data.preference_forms.forEach((t=>e.push(t.form)))})),e}))}}const v=Object.freeze({exists:!1,eligible:!1,data:null,_meta:void 0});class y{constructor(t,e,n,i,r,o,s){this._remote=t,this._provider=e,this._reporter=n,this._lifecycleEvents=i,this._deferredResolver=r,this._stickyCache=o,this._featureQuerier=s}get(t){return l(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.areFeaturesEnabled("feature_flags")))throw new i.FeatureDisabledError;const e=(yield this._list()).filter((e=>e.flag.name===t));if(!e.length)return v;const{default:r}=yield n.e(601).then(n.bind(n,8601));return yield r(e,this._provider,this._deferredResolver,this._stickyCache)}))}_list(){return l(this,void 0,void 0,(function*(){const t=yield this._remote.get(),e=[];return t.filter(d.Aj).forEach((t=>{e.push(...t.data.feature_flags)})),e}))}trackInteraction(t){return l(this,void 0,void 0,(function*(){const{analytics:e,feature_flags:n}=yield this._featureQuerier.isFeatureEnabled("analytics","feature_flags");if(!n)throw new i.FeatureDisabledError;if(!e)throw new i.DataCollectionDisabledError;try{const e=Date.now();yield this._reporter.featureFlagInteraction(t,e),this._lifecycleEvents.accept("feature_flag_interaction",e,{featureFlag:t})}catch(t){if(!(t instanceof r.D))throw t;console.debug(`unable to track feature flag interaction: ${t.message}`)}}))}}class _ extends o.y{constructor(t){super(),this._remote=t,this._remote.addEventListener("refresh",(t=>{const{experiments:e,in_app_messages:n}=t.detail.payloadsModifiedAt;if(!e&&!n)return;const i=new CustomEvent("refresh");this.dispatchTypedEvent("refresh",i)}))}payloadForId(t){return l(this,void 0,void 0,(function*(){const{messages:e}=yield this.list();return e.data.find((e=>e.id===t))}))}list(){return l(this,void 0,void 0,(function*(){const t=yield this._remote.get(),e={messages:{modifiedAtMs:0,data:[]},constraints:[],experiments:{modifiedAtMs:0,data:[]}};return t.filter(d.Gx).forEach((({timestamp:t,data:n})=>{const i=(0,s.V)(t).getTime();i>e.messages.modifiedAtMs&&(e.messages.modifiedAtMs=i);const{in_app_messages:r,frequency_constraints:o}=n;e.messages.data.push(...r),e.constraints.push(..._.convertFrequencyConstraints(null!=o?o:[]))})),t.filter(d.KC).forEach((({timestamp:t,data:n})=>{const i=(0,s.V)(t).getTime();i>e.experiments.modifiedAtMs&&(e.experiments.modifiedAtMs=i);const{experiments:r}=n;e.experiments.data.push(...r)})),e}))}static convertFrequencyConstraints(t){return t.map((({id:t,boundary:e,period:n,range:i})=>{if(r=n,!(0,c.HD)(r)||!u.includes(r))throw new Error(`invalid frequency period: ${n}`);var r;return{id:t,count:e,range:{period:n,value:i},type:"in_app_message"}}))}}class g extends o.y{constructor(t,e,{initialBaseUrl:n}){super(),this._db=t,this._mutex=e,this._initialBaseUrl=n}_mergeDefaults(t){var{baseUrls:e}=t,n=h(t,["baseUrls"]);return Object.assign({baseUrls:Object.assign({analyticsUrlBase:this._initialBaseUrl,deviceApiUrlBase:this._initialBaseUrl,meteredUsageUrlBase:this._initialBaseUrl},e),fetchContactRemoteData:!1,enableMeteredUsage:!1},n)}get(){return this._mutex.runExclusive((()=>this._get()))}_get(){return l(this,void 0,void 0,(function*(){const t=yield this._db.get();return this._mergeDefaults(t)}))}store(t){return this._mutex.runExclusive((()=>this._store(t)))}_store(t){return l(this,void 0,void 0,(function*(){const[e,n]=yield this._db.update((e=>{var n,i,r;const o=this._mergeDefaults(e),s=[...t.filter(d.aQ).map((t=>t.data)),...t.filter(d.rh).map((t=>t.data))].reduce(((t,e)=>Object.assign(Object.assign({},t),e)),{}),a=s.airship_config;return a&&(a.analytics_url&&(o.baseUrls.analyticsUrlBase=a.analytics_url),a.device_api_url&&(o.baseUrls.deviceApiUrlBase=a.device_api_url),a.metered_usage_url&&(o.baseUrls.meteredUsageUrlBase=a.metered_usage_url)),o.enableMeteredUsage=null!==(i=null===(n=s.metered_usage)||void 0===n?void 0:n.enabled)&&void 0!==i&&i,o.fetchContactRemoteData=null!==(r=s.fetch_contact_remote_data)&&void 0!==r&&r,o.audienceCheckDefaults=s.additional_audience_check,o}));if(e){const t=new CustomEvent("config_update",{detail:n});this.dispatchTypedEvent("config_update",t)}}))}}},9791:function(t,e,n){"use strict";n.d(e,{n:function(){return r}});const i=["app","web","email","sms"];function r(t){return i.includes(t)}},9553:function(t,e,n){"use strict";n.d(e,{Aj:function(){return a},Gx:function(){return c},KC:function(){return u},aQ:function(){return d},dJ:function(){return v},rh:function(){return l},ts:function(){return p},uy:function(){return s}});var i=n(2369),r=n(1379),o=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function s(t){return"preference_forms"===t.type}function a(t){return"feature_flags"===t.type}function c(t){return"in_app_messages"===t.type}function u(t){return"experiments"===t.type}function d(t){return"app_config"===t.type}function l(t){return"app_config:web"===t.type}const h=Object();class f{constructor(t,e,n,r,{_getNow:o=(()=>Date.now())}={}){this._sourceType=t,this._request=e,this._db=n,this._mutex=r,this._getNow=o,this._debug=(0,i.g$)(`remote-data:${t}`)}_fetch(t,e){return o(this,arguments,void 0,(function*({requestPath:t,auth:e},{locale:n,sdkVersion:i,randomValue:o,ifModifiedSince:s}){const a={sdk_version:i,random_value:o.toFixed()};(null==n?void 0:n.language)&&(null==n?void 0:n.country)&&(a.language=n.language,a.country=n.country);const c={};let u;e&&(c.Authorization=e),s&&(c["If-Modified-Since"]=new Date(s).toUTCString());try{u=yield this._request.get(t,{queryParams:a,headers:c,cache:"reload"})}catch(t){if(t instanceof r.L&&304===t.statusCode)return h;throw t}if(!u.ok)throw new Error("unexpected response");return u.payloads}))}get(t){return o(this,void 0,void 0,(function*(){return this._mutex.runExclusive((()=>this._get(t)))}))}_get(t){return o(this,void 0,void 0,(function*(){if(!(yield this._enabled()))return;const{id:e}=yield this._getSourceDetails();return this._db.get(this._sourceType,e,t)}))}markStale(t){return o(this,void 0,void 0,(function*(){return this._mutex.runExclusive((()=>this._markStale(t)))}))}_markStale(t){return o(this,void 0,void 0,(function*(){if(!(yield this._enabled()))return;const{id:e}=yield this._getSourceDetails();return this._db.markStale(this._sourceType,e,t)}))}refresh(t){return this._debug("refresh requested"),this._mutex.runExclusive((()=>this._refresh(t)))}_refresh(t){return o(this,void 0,void 0,(function*(){if(!(yield this._enabled()))return{type:"disabled"};const e=yield this._getSourceDetails(),n=yield this._db.get(this._sourceType,e.id,t);if(n&&"current"===n.status)return{type:"skipped",data:n};try{const i=this._getNow(),r=yield this._fetch(e,Object.assign(Object.assign({},t),{ifModifiedSince:null==n?void 0:n.fetchedAtMs}));if(r===h&&n)return yield this._db.put(this._sourceType,e.id,i,t,n.payloads),{type:"skipped",data:{status:"current",fetchedAtMs:i,payloads:n.payloads}};if(r===h)throw new Error('invalid state: should not have gotten a "not modified" response without a previous state');return yield this._db.put(this._sourceType,e.id,i,t,r),{type:"refreshed",data:{status:"current",fetchedAtMs:i,payloads:r}}}catch(t){return this._debug("failed to refresh remote data",t),{type:"failed"}}}))}}class p extends f{constructor(t,e,n,i,r,o={}){super("app",n,i,r,o),this._appKey=t,this._config=e}_enabled(){return o(this,void 0,void 0,(function*(){return!0}))}_getSourceDetails(){return o(this,void 0,void 0,(function*(){return{id:this._appKey,requestPath:`${this._config.paths.app}/${this._appKey}/web/`}}))}}class v extends f{constructor(t,e,n,i,r,o,s,a={}){super("contact",r,o,s,a),this._appConfig=t,this._featureQuerier=e,this._identity=n,this._config=i}_enabled(){return o(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.areFeaturesEnabled("contacts")))return!1;const{fetchContactRemoteData:t}=yield this._appConfig.get();return t}))}_getSourceDetails(){return o(this,void 0,void 0,(function*(){const{id:t,auth:e}=yield this._identity.identity();return{id:t,requestPath:`${this._config.paths.contact}/web/${t}`,auth:`Bearer ${e.token}`}}))}}},3518:function(t,e,n){"use strict";n.d(e,{$:function(){return r},D:function(){return i}});class i extends Error{constructor(t="reporting error"){super(t),Object.setPrototypeOf(this,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name=this.constructor.name}}class r extends i{constructor(t="invalid reporting event"){super(t),Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,r),this.name=this.constructor.name}}},1761:function(t,e,n){"use strict";n.d(e,{I:function(){return o},S:function(){return r}});var i=n(827);function r(t){return(Math.round(t)/1e3).toFixed(3)}function o(t,e){return{contact_id:e.contactId,entity_id:t.entityId,event_id:t.eventId,occurred:(0,i.Z1)(t.occurred),product:t.product,reporting_context:t.reportingContext,usage_type:t.type}}},510:function(t,e,n){"use strict";n.d(e,{y:function(){return i}});class i{constructor(){this._delegate=new EventTarget}addEventListener(t,e,n){return this._delegate.addEventListener(t,e,n)}removeEventListener(t,e,n){return this._delegate.removeEventListener(t,e,n)}dispatchEvent(t){return this._delegate.dispatchEvent(t)}dispatchTypedEvent(t,e){return this._delegate.dispatchEvent(e)}}},873:function(t,e,n){"use strict";n.d(e,{e:function(){return i}});class i extends Error{constructor(t="failed to resolve check"){super(t),Object.setPrototypeOf(this,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name=this.constructor.name}}},827:function(t,e,n){"use strict";function i(t){let e;return e="number"==typeof t?new Date(t):null!=t?t:new Date,e.toISOString().split(".")[0]}n.d(e,{V:function(){return o},Z1:function(){return i}});const r=/\d{4}-\d{2}-\d{2}(T| )\d{2}:\d{2}(:\d{2})?(.\d+)?$/;function o(t){if(!r.test(t))throw new Error("invalid timestamp string");return new Date(`${t}Z`)}},2369:function(t,e,n){"use strict";n.d(e,{Cf:function(){return a},ZP:function(){return d},g$:function(){return u}});var i=n(1297);const r="__ua_web_sdk_session_debug_enabled",o="1";let s=function(){const t=c();if(t)return t.getItem(r)===o;return!1}();function a(t){s=t;const e=c();e&&(t?e.setItem(r,o):e.removeItem(r))}function c(){try{return window.sessionStorage}catch(t){return}}function u(t){return(e,...n)=>{if("string"==typeof e)return d(`[${t}] ${e}`,...n);d(`[${t}]`,e,...n)}}function d(...t){if(i.default.debug||s){if(1===t.length&&(Array.isArray(t[0])||"object"==typeof t[0])&&console.table)return console.table(t[0]);console.log(...t)}}},4524:function(t,e,n){"use strict";n.d(e,{c:function(){return r},z:function(){return i}});class i extends Error{constructor(t="temporary failure resolving deferred"){super(t),Object.setPrototypeOf(this,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name=this.constructor.name}}class r extends Error{constructor(t="permanent failure resolving deferred"){super(t),Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,r),this.name=this.constructor.name}}},4323:function(t,e){"use strict";e.Z=class{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}},4308:function(t,e,n){"use strict";function i(t,e="object is not defined"){if(!o(t))throw new Error(e)}function r(t,e="object is not defined"){if(!o(t))throw new Error(e);return t}function o(t){return!(null==t)}n.d(e,{Dz:function(){return i},n1:function(){return r}})},1379:function(t,e,n){"use strict";n.d(e,{L:function(){return r},f:function(){return i}});class i extends TypeError{constructor(t="Predicate was not satisfied."){super(t),Object.setPrototypeOf(this,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name=this.constructor.name}}class r extends Error{constructor(t,e="Request Error"){super(e),this._statusCode=t,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,r),this.name=this.constructor.name}get statusCode(){return this._statusCode}}},5314:function(t,e,n){"use strict";function i(t){return void 0===t}function r(t){return"string"==typeof t}function o(t){return"boolean"==typeof t}function s(t){return"number"==typeof t&&!Number.isNaN(t)}function a(t){return"object"==typeof t&&(!!t&&!Array.isArray(t))}function c(t){return function(t){return null===t}(t)||i(t)}n.d(e,{HD:function(){return r},Uy:function(){return a},hj:function(){return s},jn:function(){return o},le:function(){return c},o8:function(){return i}})},6451:function(t,e,n){"use strict";n.d(e,{DF:function(){return a},dI:function(){return s}});var i=n(5314),r=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function o(t){return!!(0,i.Uy)(t)&&(!!(0,i.jn)(t.valid)&&(!t.valid||(0,i.HD)(t.msisdn)))}class s{constructor(t,{path:e}){this._request=t,this._path=e}validate(t){return r(this,void 0,void 0,(function*(){return this._request.post(this._path,t,{predicate:o})}))}}function a(t){const[e="",n=""]=t.trim().split("@"),[i="",r=""]=n.split(".");return Boolean(e.trim()&&i.trim()&&r.trim())}}},o={};function s(t){var e=o[t];if(void 0!==e)return e.exports;var n=o[t]={exports:{}};return r[t].call(n.exports,n,n.exports,s),n.exports}s.m=r,s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,{a:e}),e},e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__},s.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var r=Object.create(null);s.r(r);var o={};t=t||[null,e({}),e([]),e(e)];for(var a=2&i&&n;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((function(t){o[t]=function(){return n[t]}}));return o.default=function(){return n},s.d(r,o),r},s.d=function(t,e){for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.f={},s.e=function(t){return Promise.all(Object.keys(s.f).reduce((function(e,n){return s.f[n](t,e),e}),[]))},s.u=function(t){return"ua-"+t+".min.js"},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n={},i="@ua/web-sdk-internal:",s.l=function(t,e,r,o){if(n[t])n[t].push(e);else{var a,c;if(void 0!==r)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var l=u[d];if(l.getAttribute("src")==t||l.getAttribute("data-webpack")==i+r){a=l;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",i+r),a.src=t),n[t]=[e];var h=function(e,i){a.onerror=a.onload=null,clearTimeout(f);var r=n[t];if(delete n[t],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((function(t){return t(i)})),e)return e(i)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&!t;)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t}(),function(){var t={630:0};s.f.j=function(e,n){var i=s.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((function(n,r){i=t[e]=[n,r]}));n.push(i[2]=r);var o=s.p+s.u(e),a=new Error;s.l(o,(function(n){if(s.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",a.name="ChunkLoadError",a.type=r,a.request=o,i[1](a)}}),"chunk-"+e,e)}};var e=function(e,n){var i,r,o=n[0],a=n[1],c=n[2],u=0;if(o.some((function(e){return 0!==t[e]}))){for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(c)c(s)}for(e&&e(n);u<o.length;u++)r=o[u],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0},n=self.webpackChunk_ua_web_sdk_internal=self.webpackChunk_ua_web_sdk_internal||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}(),s.nc=void 0,function(){"use strict";var t=s(8335),e=s(2697),n=s(5314),i=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const r=255;class o{constructor(t,e){this._storage=t,this._eventReporter=e}list(){return i(this,void 0,void 0,(function*(){const t=yield this._storage.getAssociatedIdentifiers();return Array.from(t.entries()).map((([t,e])=>({[t]:e})))}))}edit(){return function(t){let o=[];class s{_validateKey(t){if(!t)throw new e.InvalidValueError("key is required");if(!(0,n.HD)(t))throw new e.InvalidValueError("key must be a string");if(t.length>r)throw new e.ValidationError(`associated identifier key ${t} exceeds character limit of 255`)}_validateIdentifier(t){if(!t)throw new e.InvalidValueError("identifier is required");if(!(0,n.HD)(t))throw new e.InvalidValueError("identifier must be a string");if(t.length>r)throw new e.ValidationError(`associated identifier ${t} exceeds character limit of 255`)}set(t){for(const e of t){const t=Object.keys(e)[0],n=e[t];this._validateKey(t),this._validateIdentifier(n)}return o.unshift({action:"set",identifiers:t}),this}add(t,e){return this._validateKey(t),this._validateIdentifier(e),o.push({action:"add",key:t,identifier:e}),this}remove(t){return this._validateKey(t),o.push({action:"remove",key:t}),this}clear(){return o.unshift({action:"clear"}),this}apply(){return i(this,void 0,void 0,(function*(){yield t(o),o=[]}))}}return new s}((t=>i(this,void 0,void 0,(function*(){const e=Date.now(),[n,i]=yield this._storage.mutateAssociatedIdentifiers(t);n&&(yield this._notify(e,i))}))))}_notify(t,e){return i(this,void 0,void 0,(function*(){const n=Object.fromEntries(e);yield this._eventReporter.associateIdentifiers(n,t)}))}}var a=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class c{constructor(t,e,n,i,r){this._eventReporter=t,this._lifecycle=e,this._db=n,this._featureQuerier=i,this._featureController=r}setEnabled(t){return t?this._featureController.enableFeatures("analytics"):this._featureController.disableFeatures("analytics")}isEnabled(){return a(this,void 0,void 0,(function*(){return this._featureQuerier.areFeaturesEnabled("analytics")}))}trackScreen(t){return a(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.areFeaturesEnabled("analytics")))throw new e.AnalyticsDisabledError;const n=Date.now();this._lifecycle.accept("screen",n,{screenName:t});const i=yield this._db.getScreenView();i&&(yield this._eventReporter.screenViewEvent(i,n)),yield this._db.setScreenView({screen:t,enteredTime:n,previousScreen:null==i?void 0:i.screen})}))}get associatedIdentifiers(){return this._associatedIdentifiers||(this._associatedIdentifiers=new o(this._db,this._eventReporter)),this._associatedIdentifiers}}var u=s(142),d=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const l="screen",h="associated_identifiers";class f{constructor(t){this._db=t}mutateAssociatedIdentifiers(t){return d(this,void 0,void 0,(function*(){return yield this._db.mutate(h,(n=>{const i=n?new Map(n):new Map;for(const e of t)if("add"===e.action)i.set(e.key,e.identifier);else if("remove"===e.action)i.delete(e.key);else if("clear"===e.action)i.clear();else{if("set"!==e.action){throw new Error(`unhandled AssociatedIdentifier mutation type: ${e}`)}i.clear(),e.identifiers.forEach((({key:t,identifier:e})=>{i.set(t,e)}))}if(i.size>20)throw new e.ValidationError("number of associated identifiers exceeds limit of 20");if(n?i.size!==n.size||Array.from(i.entries()).some((([t,e])=>(null==n?void 0:n.get(t))!==e)):i.size>0)return i;throw new u.A("no changes were made to the associated identifiers")}))}))}getAssociatedIdentifiers(){return d(this,void 0,void 0,(function*(){var t;return null!==(t=yield this._db.get(h))&&void 0!==t?t:new Map}))}getScreenView(){return d(this,void 0,void 0,(function*(){return yield this._db.get(l)}))}setScreenView(t){return d(this,void 0,void 0,(function*(){const e=yield this._db.get(l);yield this._db.set(l,Object.assign(Object.assign({},e),t))}))}clearScreenView(){return this._db.remove(l)}}var p=s(56),v=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},y=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,r){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,r,(e=t[n](e)).done,e.value)}))}}};class _{constructor(t,{_getNow:e=(()=>Date.now())}={}){this._db=t,this._getNow=e}storeHashResult(t,e){return v(this,arguments,void 0,(function*({hashedId:t,hashedIdType:e,stickyId:n},{isAudienceMember:i,reportingMeta:r},{lastAccessTtlMs:o}={}){const s=this._db.transaction([p.eW],"readwrite").objectStore(p.eW),a=this._getNow(),c=void 0!==o?a+o:Number.MAX_SAFE_INTEGER;yield s.put({expiresAtMs:c,hashedId:t,hashedIdType:e,stickyId:n,isAudienceMember:i,reportingMeta:r,lastAccessTtlMs:o,storedAtMs:a})}))}getHashResult(t){return v(this,arguments,void 0,(function*({hashedIdType:t,hashedId:e,stickyId:n}){const i=this._db.transaction([p.eW],"readwrite").objectStore(p.eW),r=yield i.index("hashedIdType-hashedId-stickyId-storedAtMs").openCursor(IDBKeyRange.bound([t,e,n,0],[t,e,n,1/0]),"prev");if(!r)return;const{value:o}=r,s=this._getNow();if(!(s>o.expiresAtMs))return void 0!==o.lastAccessTtlMs&&(yield i.put(Object.assign(Object.assign({},o),{storedAtMs:s,expiresAtMs:s+o.lastAccessTtlMs}))),{isAudienceMember:o.isAudienceMember,reportingMeta:o.reportingMeta};r.delete()}))}prune(){return v(this,void 0,void 0,(function*(){var t,e,n,i;const r=this._db.transaction([p.eW],"readwrite").objectStore(p.eW),o=yield r.index("expiresAtMs").openCursor(IDBKeyRange.bound([0],[this._getNow()]),"next");if(o)try{for(var s,a=!0,c=y(o);!(t=(s=yield c.next()).done);a=!0){i=s.value,a=!1;const t=i;yield t.delete()}}catch(t){e={error:t}}finally{try{a||t||!(n=c.return)||(yield n.call(c))}finally{if(e)throw e.error}}}))}}var g,m,b=s(510);!function(t){t.SET="set",t.REMOVE="remove"}(g||(g={})),function(t){t.ADD="add",t.SET="set",t.REMOVE="remove"}(m||(m={}));var w=s(827);function E(t){if("string"==typeof t)return t;if("number"==typeof t)return t.toString(10);if(t instanceof Date)return(0,w.Z1)(t);if((0,n.Uy)(t))try{return JSON.stringify(t),t}catch(n){throw new e.InvalidValueError(`invalid attribute value: ${String(t)}`)}throw new e.InvalidValueError(`invalid attribute value: ${t}`)}function S(t){return new class{constructor(){this._mutations=[]}apply(){return t(this._mutations)}remove(t){return x(t),this._mutations.push({action:"remove",key:t,timestamp:(0,w.Z1)()}),this}set(t,e){return x(t),E(e),this._mutations.push({action:"set",key:t,value:e,timestamp:(0,w.Z1)()}),this}}}function A(t){const e=[];return[...t].sort(((t,e)=>(0,w.V)(t.timestamp).getTime()-(0,w.V)(e.timestamp).getTime())).reverse().filter((t=>!e.includes(t.key)&&(e.push(t.key),!0))).map(I).reverse()}function I(t){switch(t.action){case"set":return{action:g.SET,key:t.key,value:E(t.value),timestamp:t.timestamp};case"remove":return{action:g.REMOVE,key:t.key,timestamp:t.timestamp};default:throw new Error(`invalid attribute mutation action: ${t}`)}}function x(t){if(!(0,n.HD)(t))throw new e.InvalidValueError("attribute key must be a string")}var M=s(4308),P=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function O(t,e,{validateGroup:n}={}){return new class{constructor(){this._mutations=[]}apply(){return P(this,void 0,void 0,(function*(){const n=yield e();yield t(this._mutations),yield n.mutate(this._mutations)}))}add(t,e){null==n||n(t);const i=C(e);return this._mutations.push({action:"add",tags:i,group:t,timestamp:(0,w.Z1)()}),this}remove(t,e){null==n||n(t);const i=C(e);return this._mutations.push({action:"remove",tags:i,group:t,timestamp:(0,w.Z1)()}),this}set(t,e){null==n||n(t);const i=C(e);return this._mutations.push({action:"set",tags:i,group:t,timestamp:(0,w.Z1)()}),this}}}function C(t){const n=Array.isArray(t)?t:[t];return n.forEach((t=>{if("string"!=typeof t)throw new e.InvalidValueError(`invalid tag value ${t}`)})),n}function k(t){const e={},n={},i={};return[...t].sort(((t,e)=>(0,w.V)(t.timestamp).getTime()-(0,w.V)(e.timestamp).getTime())).forEach((t=>{switch(t.action){case"add":return e[t.group]||(e[t.group]=new Set),void t.tags.forEach((i=>{e[t.group].add(i),n[t.group]&&n[t.group].delete(i)}));case"remove":return n[t.group]||(n[t.group]=new Set),void t.tags.forEach((i=>{n[t.group].add(i),e[t.group]&&e[t.group].delete(i)}));case"set":return delete e[t.group],delete n[t.group],void(i[t.group]=new Set(t.tags));default:throw new Error(`invalid tag mutation action: ${t}`)}})),{add:D(e),remove:D(n),set:D(i)}}function D(t){const e={};return Object.keys(t).forEach((n=>{const i=[...t[n].values()];i.length&&(e[n]=i)})),Object.keys(e).length?e:void 0}function T({forbiddenGroups:t=[],forbiddenGroupPrefixes:n=[]}={}){const i=["ua_",...n];return n=>{if(t.includes(n))throw new e.ValidationError(`invalid tag group: ${n}`);if(i.some((t=>n.startsWith(t))))throw new e.ValidationError(`forbidden tag group prefix: ${n}`)}}var F=s(9791);function j(t){const e=[];return[...t].reverse().filter((t=>!e.includes(t.listId)&&(e.push(t.listId),!0))).reverse()}function R(t){const e=[];return[...t].reverse().filter((t=>!e.find((e=>e.listId===t.listId&&e.scope===t.scope))&&(e.push(t),!0))).reverse()}function B(t){return R(t).map(V)}function N(t){return{action:t.action,list_id:t.listId,timestamp:t.timestamp}}function V(t){return{action:t.action,list_id:t.listId,timestamp:t.timestamp,scope:t.scope}}function U(t){if(!(0,n.HD)(t))throw new e.InvalidValueError("subscription list id must be a string")}function L(t){if(!(0,n.HD)(t)||!(0,F.n)(t))throw new e.InvalidValueError(`subscription list scope '${t}' is not a valid scope identifier`)}var $=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class q{constructor(t,e,n,i,r){this._client=t,this._channel=e,this._dataCollectionEnabled=n,this._listHistory=i,this._mutationApplier=r}list(){return $(this,void 0,void 0,(function*(){if(!(yield this._dataCollectionEnabled()))throw new e.DataCollectionDisabledError;const t=yield this._channel();return function(t,e){const n=j(e);let i=[...t];return n.forEach((t=>{const{action:e,listId:n}=t;"subscribe"!==e||i.includes(n)||i.push(n),"unsubscribe"===e&&i.includes(n)&&(i=i.filter((t=>t!==n)))})),i}(yield this._client.listSubscriptions(t),yield this._listHistory.channelListMutations())}))}edit(){return K((t=>$(this,void 0,void 0,(function*(){if(!(yield this._dataCollectionEnabled()))throw new e.DataCollectionDisabledError;return this._mutationApplier(t)}))))}}function K(t){const e=[];return new class{apply(){return $(this,void 0,void 0,(function*(){yield t(e)}))}subscribe(t){return U(t),e.push({action:"subscribe",listId:t,timestamp:(0,w.Z1)()}),this}unsubscribe(t){return U(t),e.push({action:"unsubscribe",listId:t,timestamp:(0,w.Z1)()}),this}}}var W=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class H extends b.y{constructor(t,e,n,i,r,o){super(),this._hasEmit=!1,this._manager=t,this._featureQuerier=e,this._tagState=n,this._mutations=i,this._listHistory=r,this._subscriptionListClient=o,this._manager.addChannelListener((t=>{this._emitChannel(t.channel_id)})),this._manager.getChannelId().then((t=>{t&&this._emitChannel(t)}))}_emitChannel(t){if(this._hasEmit)return;this._hasEmit=!0;const e=new CustomEvent("channel",{detail:{id:t}});this.dispatchTypedEvent("channel",e)}id(){return W(this,void 0,void 0,(function*(){var t;return null!==(t=yield this._manager.getChannelId())&&void 0!==t?t:null}))}optedIn(){return W(this,void 0,void 0,(function*(){return this._manager.getOptedIn()}))}_createSubscriptionManager(){return new q(this._subscriptionListClient,(()=>W(this,void 0,void 0,(function*(){return(0,M.n1)(yield this._manager.getChannelId(),"channel is not available")}))),(()=>this._featureQuerier.areFeaturesEnabled("tags_and_attributes")),this._listHistory,(t=>this._mutations.applySubscriptionListMutations(t)))}get subscriptions(){return this._subscriptions||(this._subscriptions=this._createSubscriptionManager()),this._subscriptions}optOut(){return W(this,void 0,void 0,(function*(){return this._manager.optOut()}))}editTags(){return O((t=>W(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes")))throw new e.DataCollectionDisabledError;return this._mutations.applyTagMutations(t)}))),(()=>W(this,void 0,void 0,(function*(){return this._tagState}))),{validateGroup:T()})}editAttributes(){return S((t=>W(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes")))throw new e.DataCollectionDisabledError;return this._mutations.applyAttributeMutations(t)}))))}}var Z=H,G=s(4314),z=s(1297);function Q(t){const e=Intl.DateTimeFormat().resolvedOptions(),n=e.timeZone,[i,r]=e.locale.split("-"),o=(null==t?void 0:t.language)||i;let s=(null==t?void 0:t.country)||r;if(!s&&navigator.languages){s=navigator.languages.reduce(((t,e)=>(t||(t=e.includes("-")?e.split("-")[1]:null),t)),null)||""}return{localeCountry:s,localeLanguage:o,timezone:n}}const Y=["chrome","edge","firefox","opera","safari","yandex browser","uc browser","samsung internet for android"];function J({optedIn:t,localeOverride:e,analyticsEnabled:n}){let i={};try{const{localeCountry:t,localeLanguage:n,timezone:r}=Q(e);i={timezone:r,locale_country:t,locale_language:n}}catch(t){}const r=z.default.VERSION;if(!n)return Object.assign(Object.assign({},i),{device_type:"web",opt_in:t,web:{web_sdk_version:r}});const{browser:o,platform:s}=G.parse(navigator.userAgent),a=navigator.userAgent,c=function(t){if(!t)return"unknown";if(t=t.toLowerCase(),!Y.includes(t))return"unknown";return t.split(" ")[0]}(o.name),u=`${c}-${o.version}`,d="mobile"===s.type||"tablet"===s.type?"mobile":"desktop",l=z.default.appVersion!==z.aw?z.default.appVersion:void 0;return Object.assign(Object.assign({},i),{device_type:"web",opt_in:t,app_version:l,web:{user_agent_string:a,browser_name:c,browser_version:u,browser_type:d,web_sdk_version:r}})}var X=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class tt{constructor(t,e,n,i,r,o,{registrationPathBase:s}){this._listeners=[],this._storage=t,this._request=n,this._locale=e,this._mutex=i,this._notifier=r,this._notifier.addEventListener("channel:registration",(()=>this._notify())),this._featureQuerier=o,this._path=s}getChannelId(){return this._mutex.runExclusive((()=>this._getChannelId()))}_getChannelId(){return X(this,void 0,void 0,(function*(){const t=yield this._storage.getChannel();return null==t?void 0:t.channel_id}))}getOptedIn(){return this._mutex.runExclusive((()=>this._getOptedIn()))}_getOptedIn(){return X(this,void 0,void 0,(function*(){var t;const e=yield this._storage.getChannel();return null!==(t=null==e?void 0:e.opt_in)&&void 0!==t&&t}))}update(t){return this._mutex.runExclusive((()=>this._update(t)))}_update(t){return X(this,void 0,void 0,(function*(){(yield this._getChannelId())&&(yield this._updateOrCreate(t))}))}updateOrCreate(t){return this._mutex.runExclusive((()=>this._updateOrCreate(t)))}_updateOrCreate(t){return X(this,void 0,void 0,(function*(){var e,n;const i=yield this._storage.getChannel(),r=yield this._locale(),{analytics:o}=yield this._featureQuerier.isFeatureEnabled("analytics"),s=Object.assign(Object.assign(Object.assign({},J({optedIn:null!==(e=null==i?void 0:i.opt_in)&&void 0!==e&&e,localeOverride:r,analyticsEnabled:o})),i),t);let a,c;if(!s.push_address&&s.opt_in&&delete s.opt_in,null==i?void 0:i.channel_id)yield this._request.putVoid(`${this._path}/${i.channel_id}`,{channel:s}),a=i.channel_id,c=!1;else{a=(yield this._request.post(this._path,{channel:s},{predicate:et})).channel_id,c=!0}return yield this._storage.setChannel({channel_id:a,opt_in:null!==(n=s.opt_in)&&void 0!==n&&n}),yield this._notify(),c&&this._notifier.broadcast({channelId:a}),a}))}optOut(t){return this._mutex.runExclusive((()=>this._optOut(t)))}_optOut(){return X(this,arguments,void 0,(function*({clearDeviceTags:t=!1}={}){const e=yield this._getChannelId();if(!e)return;const n=yield this._locale(),{analytics:i}=yield this._featureQuerier.isFeatureEnabled("analytics"),r=Object.assign(Object.assign(Object.assign({},J({optedIn:!1,localeOverride:n,analyticsEnabled:i})),{channel_id:e}),t?{set_tags:!0,tags:[]}:{});yield this._request.putVoid(`${this._path}/${e}`,{channel:r}),yield this._storage.setChannel({opt_in:!1}),yield this._notify()}))}_notify(){return X(this,void 0,void 0,(function*(){const t=yield this._storage.getChannel();(null==t?void 0:t.channel_id)&&this._listeners.forEach((e=>e(t)))}))}addChannelListener(t){this._listeners.push(t)}}function et(t){return!!(0,n.Uy)(t)&&((0,n.jn)(t.ok)&&t.ok&&(0,n.HD)(t.channel_id))}var nt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function it(t,{defaultValue:e=!0}={}){if("boolean"==typeof t)return t;if(void 0===t)return e;try{return JSON.parse(t)}catch(t){return e}}class rt{constructor(t,e,n){this._config=t,this._request=e,this._cache=n}listSubscriptions(t){return nt(this,void 0,void 0,(function*(){const e=`${this._config.paths.list}/${t}`;return yield this._cache.get(e,(t=>nt(this,void 0,void 0,(function*(){try{const t=yield this._request.get(e);if(!t.ok)throw new Error("Unable to retrieve channel subscription lists");return{data:t.list_ids}}catch(e){if(t)return Object.assign(Object.assign({},t),{ttlMs:z.default.subscriptionLists.cacheMissStaleResponseTtlMs});throw e}}))))}))}}class ot{constructor(t,e){this._editor=t,this._featureQuerier=e}tags(){return nt(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes"))return this._editor.editTags()}))}attributes(){return nt(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes"))return this._editor.editAttributes()}))}subscriptionLists(){return nt(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes"))return this._editor.subscriptions.edit()}))}}var st=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const at="channel";class ct{constructor(t){this._db=t}getChannel(){return st(this,void 0,void 0,(function*(){var t;const e=yield this._db.get(at);if(e)return{channel_id:e.channel_id,opt_in:it(null!==(t=e.opt_in)&&void 0!==t&&t)}}))}setChannel(t){return st(this,void 0,void 0,(function*(){const e=yield this.getChannel();yield this._db.set(at,Object.assign(Object.assign({},e),t))}))}}var ut=s(313),dt=s(2591),lt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class ht{constructor(t){this._iaxEngineGetter=t}setPaused(t){return lt(this,void 0,void 0,(function*(){return(yield this._iaxEngineGetter()).setPaused(t)}))}isPaused(){return lt(this,void 0,void 0,(function*(){return(yield this._iaxEngineGetter()).isPaused()}))}getDisplayInterval(){return lt(this,void 0,void 0,(function*(){return(yield this._iaxEngineGetter()).getDisplayInterval()}))}setDisplayInterval(t){return lt(this,void 0,void 0,(function*(){return(yield this._iaxEngineGetter()).setDisplayInterval(t)}))}setDisplayDelegate(t){return lt(this,void 0,void 0,(function*(){return(yield this._iaxEngineGetter()).setDisplayDelegate(t)}))}setCustomViewDelegate(t){return lt(this,void 0,void 0,(function*(){return(yield this._iaxEngineGetter()).setThomasDelegates({customViewDelegate:t})}))}}class ft{constructor(t,e,n,i,r,o,s,a,c){this._remoteData=t,this._audience=e,this._reporter=n,this._lifecycleEvents=i,this._deferredResolver=r,this._iaxEngineGetter=o,this._embeddedViewFactory=s,this._stickyCache=a,this._featureQuerier=c,i.addEventListener("channel",(t=>this._handle("channel",t))),i.addEventListener("contact",(t=>this._handle("contact",t))),i.addEventListener("custom_event",(t=>this._handle("custom_event",t))),i.addEventListener("screen",(t=>this._handle("screen",t))),i.addEventListener("session",(t=>this._handle("session",t))),i.addEventListener("version",(t=>this._handle("version",t))),i.addEventListener("feature_flag_interaction",(t=>this._handle("feature_flag_interaction",t))),i.addEventListener("foreground",(t=>this._handle("foreground",t))),i.addEventListener("locale",(t=>this._handle("locale",t))),i.addEventListener("url_match",(t=>this._handle("url_match",t)))}_handle(t,n){return lt(this,void 0,void 0,(function*(){try{const e=yield this._iaxEngineGetter(),{timestamp:i,payload:r}=n.detail;yield e.notify(t,i,r)}catch(t){if(t instanceof e.FeatureDisabledError)return;throw t}}))}get featureFlags(){return this._featureFlagManager||(this._featureFlagManager=new dt.TP(this._remoteData,this._audience,this._reporter,this._lifecycleEvents,this._deferredResolver,this._stickyCache,this._featureQuerier)),this._featureFlagManager}get preferenceCenters(){return this._preferenceCenterManager||(this._preferenceCenterManager=new dt.f6(this._remoteData)),this._preferenceCenterManager}get inAppAutomation(){return this._inAppAutomationManager||(this._inAppAutomationManager=new ht(this._iaxEngineGetter)),this._inAppAutomationManager}get embeddedViews(){return this._embeddedViewManager||(this._embeddedViewManager=new ut.eh(this._embeddedViewFactory)),this._embeddedViewManager}}const pt=["web","email","sms","open","ios","android","amazon"];var vt=s(2369);var yt=Object.freeze({channel:{batch:"/api/channels/sdk/batch",smsFormat:"/api/channels/sms/format"},cla:"/api/channels",cra:"/api/web-channels",tags:"/api/web-channels/tags",attributes:"/api/channels/attributes",remote_data:{app:"/api/remote-data/app",contact:"/api/remote-data-contact"},subscription_lists:{list:"/api/subscription_lists/channels",update:"/api/channels/subscription_lists"},named_user:{associate:"/api/named_users/associate",disassociate:"/api/named_users/disassociate",tags:"/api/named_users/tags"},contact:{identify:"/api/contacts/identify/v2_web",batch:"/api/contacts",subscription_lists_list:"/api/subscription_lists/contacts",registration:{email:"/api/channels/restricted/email",sms:"/api/channels/restricted/sms",open:"/api/channels/restricted/open"}},meteredUsage:"/api/metered-usage",reports:{featureFlagInteraction:"/api/web-events/ff_interaction",warp9:"/warp9/",venus:"/api/web-events"}});function _t(t){return void 0===t||Array.isArray(t)?t:[t]}var gt=s(1379);var mt=(...t)=>self.fetch(...t),bt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class wt{constructor(t){this._config=t}get(t,e){return this._jsonRequestResponse("GET",t,e)}put(t,e,n){return this._jsonRequestResponse("PUT",t,n,e)}putVoid(t,e,n){return bt(this,void 0,void 0,(function*(){yield this._requestResponse("PUT",t,Object.assign({body:e},n))}))}post(t,e,n){return this._jsonRequestResponse("POST",t,n,e)}postVoid(t,e,n){return bt(this,void 0,void 0,(function*(){yield this._requestResponse("POST",t,Object.assign({body:e},n))}))}patch(t,e,n){return this._jsonRequestResponse("PATCH",t,n,e)}patchVoid(t,e,n){return bt(this,void 0,void 0,(function*(){yield this._requestResponse("PATCH",t,Object.assign({body:e},n))}))}delete(t,e){return bt(this,void 0,void 0,(function*(){yield this._requestResponse("DELETE",t,null!=e?e:{})}))}_authHeaders(){switch(this._config.type){case"basic":return{Authorization:`Basic ${self.btoa(`${this._config.appKey}:${this._config.secret}`)}`};case"bearer":return{"X-UA-Appkey":this._config.appKey,Authorization:`Bearer ${this._config.token}`};default:const t=this._config;throw new Error(`invalid config: ${t}`)}}_requestResponse(t,e,n){return bt(this,arguments,void 0,(function*(t,e,{headers:n,queryParams:i={},body:r,cache:o}){const s=new URL(`${this._config.apiBase||""}${e}`),a={method:t,cache:o},c=Object.assign({Accept:wt.V3_ACCEPT_HEADER},this._authHeaders()),u=new URLSearchParams(s.search.slice(1));let d;if(Object.keys(i).forEach((t=>{var e;(e=i[t],Array.isArray(e)?e:[e]).forEach((e=>{u.append(t,e.toString())}))})),s.search=u.toString(),a.credentials="include",this._config.timeoutMs){const t=new AbortController;d=setTimeout((()=>t.abort()),this._config.timeoutMs),a.signal=t.signal}r&&(c["Content-Type"]="application/json",a.body="string"==typeof r?r:JSON.stringify(r)),a.headers=Object.assign(Object.assign({},c),null!=n?n:{});try{const t=yield mt(s.toString(),a);if(d&&clearTimeout(d),!t.ok)throw new gt.L(t.status,t.statusText);return t}finally{d&&clearTimeout(d)}}))}_jsonRequestResponse(t,e){return bt(this,arguments,void 0,(function*(t,e,{headers:n,queryParams:i,predicate:r,cache:o}={},s){const a=yield this._requestResponse(t,e,{headers:n,queryParams:i,body:s,cache:o}),c=yield a.json();if(r&&!r(c))throw new gt.f;return c}))}}wt.V3_ACCEPT_HEADER="application/vnd.urbanairship+json; version=3;";var Et=wt;function St(t,{timeoutMs:e,apiBase:n}={}){if(t.appKey&&t.token)return new Et({apiBase:n,appKey:t.appKey,type:"bearer",token:t.token,timeoutMs:e});if(t.appKey&&t.secret)return new Et({apiBase:n,appKey:t.appKey,type:"basic",secret:t.secret,timeoutMs:e});throw new Error("invalid auth configuration: appKey and at least one of token or secret must be configured.")}function At(t,e){return t instanceof gt.L&&function(t,e){const n=e-e%100;return t>=n&&t<n+100}(t.statusCode,e)}class It extends Error{constructor(t="Cannot perform this operation without an associated channel."){super(t),Object.setPrototypeOf(this,It.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,It),this.name=this.constructor.name}}class xt extends Error{constructor(t="The provided name is not valid."){super(t),Object.setPrototypeOf(this,xt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xt),this.name=this.constructor.name}}var Mt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};var Pt=class{constructor(t,e){this._config=t,this._request=e}registerEmail(t,e){return Mt(this,void 0,void 0,(function*(){const n=Object.assign({type:"email",address:t,transactional_opted_in:Ct(e.transactionalOptedIn)},Ot(e));(function(t){return!t.doubleOptIn})(e)&&(n.commercial_opted_in=Ct(e.commercialOptedIn));const i={};return function(t){return Boolean(t.doubleOptIn)}(e)&&(i.opt_in_mode="double"),e.properties&&(i.properties=e.properties),this._register(this._config.paths.email,n,{registrationOptions:i})}))}registerSms(t,e){return Mt(this,void 0,void 0,(function*(){const n=Object.assign({msisdn:t,sender:e.senderId},Ot(e));return(yield this._request.post(this._config.paths.sms,n)).channel_id}))}registerOpen(t,e){return Mt(this,void 0,void 0,(function*(){const n=Object.assign({type:"open",address:t,opt_in:!0,open:{open_platform_name:e.platformName,identifiers:e.identifiers}},Ot(e));return this._register(this._config.paths.open,n)}))}_register(t,e){return Mt(this,arguments,void 0,(function*(t,e,{registrationOptions:n}={}){const i=Object.assign({channel:e},n);return(yield this._request.post(t,i)).channel_id}))}};function Ot(t){return{timezone:t.timezone,locale_country:t.localeCountry,locale_language:t.localeLanguage}}function Ct(t){if(t)return(0,w.Z1)(t)}var kt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Dt{constructor(t,e,n,i,r,o,s){this._client=t,this._mutations=e,this._storage=n,this._contact=i,this._idLastChanged=r,this._dataCollectionEnabled=o,this._listHistory=s}list(){return kt(this,void 0,void 0,(function*(){if(!(yield this._dataCollectionEnabled()))throw new e.DataCollectionDisabledError;const t=yield this._contact(),n=yield this._client.listSubscriptions(t),i=yield this._listHistory.contactListMutations(),r=yield this._idLastChanged();return function(t,e){const n=Object.assign({},t);return R(e).forEach((t=>{const{listId:e,scope:i,action:r}=t;n[e]||(n[e]=[]),"subscribe"!==r||n[e].includes(i)||n[e].push(i),"unsubscribe"===r&&n[e].includes(i)&&(n[e]=n[e].filter((t=>t!==i))),n[e].length||delete n[e]})),n}(n,i.filter((t=>(0,w.V)(t.timestamp).getTime()>(null!=r?r:0))))}))}edit(){return Tt((t=>kt(this,void 0,void 0,(function*(){if(!(yield this._dataCollectionEnabled()))throw new e.DataCollectionDisabledError;const n=yield this._contact();t.length&&(yield this._mutations.applySubscriptionListMutations(t),yield this._storage.appendSubscriptionListMutations(n,t))}))))}}function Tt(t){return new class{constructor(){this._mutations=[]}apply(){return kt(this,void 0,void 0,(function*(){yield t(this._mutations)}))}subscribe(t,e){return U(t),L(e),this._mutations.push({action:"subscribe",listId:t,timestamp:(0,w.Z1)(),scope:e}),this}unsubscribe(t,e){return U(t),L(e),this._mutations.push({action:"unsubscribe",listId:t,timestamp:(0,w.Z1)(),scope:e}),this}}}var Ft=s(651),jt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const Rt="contact.id",Bt="contact.auth",Nt="contact.name",Vt="contact.named_user_associated",Ut="contact.id_last_changed",Lt=t=>`contact.${t}.tag_mutations`,$t=t=>`contact.${t}.attribute_mutations`,qt=t=>`contact.${t}.subscription_list_mutations`,Kt=t=>`contact.${t}.associated_channels`;var Wt=class{constructor({namedUserTtlMs:t,_forceExpireNamedUsers:e,_getNow:n},i){this._db=i,this._namedUserTtlMs=t,this._forceExpireNamedUsers=e,this._getNow=null!=n?n:()=>Date.now()}getAuth(){return jt(this,void 0,void 0,(function*(){const t=yield this._db.get(Bt);if(!t)return;const{fetchedAtMs:e,ttlMs:n}=t;return this._getNow()>e+n?void 0:t}))}setAuth(t){return this._db.set(Bt,t)}getOrCreateContactId(){return jt(this,void 0,void 0,(function*(){let t=!1;const e=yield this._db.mutate(Rt,(e=>{if(!e){const e=(0,Ft.Z)();return t=!0,e}return e}));if(!e[0])throw new u.A("unable to generate contact id");return t&&(yield this.setContactIdLastChangedTimestamp()),e[1]}))}setContactId(t){return jt(this,void 0,void 0,(function*(){yield this._db.set(Rt,t),yield this.setContactIdLastChangedTimestamp()}))}clearContactId(){return jt(this,void 0,void 0,(function*(){const t=(0,Ft.Z)();return yield this._db.set(Rt,t),yield this.setContactIdLastChangedTimestamp(),t}))}getNamedUserId(){return jt(this,void 0,void 0,(function*(){const t=yield this.getNamedUserAssociatedTimestamp();if(!t&&this._forceExpireNamedUsers)return;if(t&&this._getNow()-t>this._namedUserTtlMs)return;const e=yield this._db.get(Nt);return e&&!t&&this.setNamedUserAssociatedTimestamp(),e}))}setNamedUserId(t){return jt(this,void 0,void 0,(function*(){yield this._db.set(Nt,t),yield this.setNamedUserAssociatedTimestamp()}))}clearNamedUserId(){return jt(this,void 0,void 0,(function*(){yield this._db.remove(Nt),yield this.clearNamedUserAssociatedTimestamp()}))}setNamedUserAssociatedTimestamp(){return jt(this,void 0,void 0,(function*(){this._db.set(Vt,String(this._getNow()))}))}clearNamedUserAssociatedTimestamp(){return jt(this,void 0,void 0,(function*(){this._db.remove(Vt)}))}setContactIdLastChangedTimestamp(){return jt(this,void 0,void 0,(function*(){yield this._db.set(Ut,String(this._getNow()))}))}getContactIdLastChangedTimestamp(){return jt(this,void 0,void 0,(function*(){const t=yield this._db.get(Ut);if(!t)return;const e=Number.parseInt(t,10);return Number.isNaN(e)?void 0:e}))}getNamedUserAssociatedTimestamp(){return jt(this,void 0,void 0,(function*(){const t=yield this._db.get(Vt);if(!t)return;const e=Number.parseInt(t,10);if(!Number.isNaN(e))return e;yield this.clearNamedUserAssociatedTimestamp()}))}appendTagMutations(t,e){return jt(this,void 0,void 0,(function*(){yield this._db.mutate(Lt(t),((t=[])=>t.concat(...e)))}))}getTagMutations(t){return jt(this,void 0,void 0,(function*(){const e=yield this._db.get(Lt(t));return null!=e?e:[]}))}appendAttributeMutations(t,e){return jt(this,void 0,void 0,(function*(){yield this._db.mutate($t(t),((t=[])=>t.concat(...e)))}))}getAttributeMutations(t){return jt(this,void 0,void 0,(function*(){const e=yield this._db.get($t(t));return null!=e?e:[]}))}appendSubscriptionListMutations(t,e){return jt(this,void 0,void 0,(function*(){yield this._db.mutate(qt(t),((t=[])=>t.concat(...e)))}))}getSubscriptionListMutations(t){return jt(this,void 0,void 0,(function*(){const e=yield this._db.get(qt(t));return null!=e?e:[]}))}getAssociatedChannels(t){return jt(this,void 0,void 0,(function*(){const e=yield this._db.get(Kt(t));return null!=e?e:[]}))}appendAssociatedChannel(t,e){return jt(this,void 0,void 0,(function*(){yield this._db.mutate(Kt(t),((t=[])=>t.concat(e)))}))}clearAssociatedChannels(t){return jt(this,void 0,void 0,(function*(){yield this._db.remove(Kt(t))}))}},Ht=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Zt(t,e){return new Wt({namedUserTtlMs:t.contacts.namedUserTtlMs,_forceExpireNamedUsers:t.contacts._forceExpireNamedUsers},e)}class Gt{constructor(t,e){this._editor=t,this._featureQuerier=e}tags(){return Ht(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes"))return this._editor.editTags()}))}attributes(){return Ht(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes"))return this._editor.editAttributes()}))}subscriptionLists(){return Ht(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes"))return this._editor.subscriptions.edit()}))}registerEmail(t,e){return Ht(this,void 0,void 0,(function*(){(yield this._featureQuerier.areFeaturesEnabled("contacts"))&&(yield this._editor.registerEmail(t,e))}))}registerSms(t,e){return Ht(this,void 0,void 0,(function*(){(yield this._featureQuerier.areFeaturesEnabled("contacts"))&&(yield this._editor.registerSms(t,e))}))}}var zt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Qt extends b.y{constructor(t,e,n,i,r,o,s,a,c,u,d,l,h){var f;super(),this._channel=t,this._locale=e,this._storage=n,this._client=i,this._registration=r,this._featureQuerier=o,this._featureNotifier=s,this._lifecycle=a,this._tagStore=c,this._mutations=u,this._emitter=h,this._listHistory=d,this._mutex=l,this._ready=this._init(),this._channelListener=this._onChannel.bind(this),null===(f=this._emitter)||void 0===f||f.addEventListener("channel",this._channelListener,{once:!0}),this._featureNotifier.addEventListener("features_updated",(t=>this._onFeaturesUpdated(t)))}_onFeaturesUpdated(t){return zt(this,arguments,void 0,(function*({detail:t}){yield this._ready;const{current:e,previous:n}=t;if(e.includes("contacts")&&!n.includes("contacts"))return this._init()}))}contactId(){return zt(this,void 0,void 0,(function*(){yield this._ready;if(yield this._isContactEnabled())return this._mutex.runExclusive((()=>this._storage.getOrCreateContactId()))}))}identity(){return zt(this,void 0,void 0,(function*(){yield this._ready,yield this._assertContactsEnabled();const t=yield this._channel();if(!t)throw new It("cannot resolve contact without a channel");return this._resolve(t)}))}_purge(){return zt(this,void 0,void 0,(function*(){yield this._ready,yield this._mutex.runExclusive((()=>zt(this,void 0,void 0,(function*(){const t=yield this._reset();this._lifecycle.accept("contact",Date.now(),{contactId:t,type:"reset"})}))))}))}_init(){return zt(this,void 0,void 0,(function*(){var t;const e=yield this._channel();if(!e)return void(0,vt.ZP)("contact: initialized without channel");null===(t=this._emitter)||void 0===t||t.removeEventListener("channel",this._channelListener);(yield this._isContactEnabled())&&(yield this._resolve(e),(0,vt.ZP)("contact: initialized"))}))}identify(t){return zt(this,void 0,void 0,(function*(){return yield this._ready,yield this._assertContactsEnabled(),function(t){if("string"!=typeof t)throw new xt("must be a string");if(!t.trim())throw new xt("must not be blank")}(t),this._mutex.runExclusive((()=>zt(this,void 0,void 0,(function*(){const e=yield this._storage.getOrCreateContactId(),n=yield this._identify(t);this._lifecycle.accept("contact",Date.now(),{contactId:n,type:"identify",id:t,contactIdSame:e===n})}))))}))}_identify(t){return zt(this,void 0,void 0,(function*(){if(yield this._namedUserIdEquals(t))return(0,vt.ZP)("contact: identify, not setting as user is already identified"),this._storage.getOrCreateContactId();if(yield this._storage.getNamedUserId()){(0,vt.ZP)("contact: identify, this contact already has a named user. Creating new contact.");const t=yield this._storage.clearContactId();yield this._resetStoredContact(t)}const e=yield this._channel();if(!e)throw new It;const n=yield this._doIdentify(t,e);return(0,vt.ZP)("contact: identified",t,e,n),n}))}_namedUserIdEquals(t){return zt(this,void 0,void 0,(function*(){return t===(yield this._storage.getNamedUserId())}))}reset(){return zt(this,void 0,void 0,(function*(){yield this._ready,yield this._assertContactsEnabled(),yield this._mutex.runExclusive((()=>zt(this,void 0,void 0,(function*(){const t=yield this._reset();this._lifecycle.accept("contact",Date.now(),{contactId:t,type:"reset"})}))))}))}_reset(){return zt(this,void 0,void 0,(function*(){const t=yield this._channel();return yield this._doReset(t)}))}editAttributes(){return S((t=>zt(this,void 0,void 0,(function*(){yield this._ready,yield this._assertContactsEnabled();if(!(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes")))throw new e.DataCollectionDisabledError;const n=yield this._storage.getOrCreateContactId();yield this._applyAttributeMutations(n,t)}))))}_applyAttributeMutations(t,e){return zt(this,void 0,void 0,(function*(){e.length&&(yield this._mutations.applyAttributeMutations(e),yield this._storage.appendAttributeMutations(t,e),this._lifecycle.accept("contact",Date.now(),{contactId:t,type:"attribute_mutation",mutations:e}))}))}editTags(){return O((t=>zt(this,void 0,void 0,(function*(){yield this._ready,yield this._assertContactsEnabled();if(!(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes")))throw new e.DataCollectionDisabledError;const n=yield this._storage.getOrCreateContactId();yield this._applyTagMutations(n,t)}))),(()=>zt(this,void 0,void 0,(function*(){return this._tagStore}))),{validateGroup:T({forbiddenGroups:["device"]})})}_applyTagMutations(t,e){return zt(this,void 0,void 0,(function*(){e.length&&(yield this._mutations.applyTagMutations(e),yield this._storage.appendTagMutations(t,e),this._lifecycle.accept("contact",Date.now(),{contactId:t,type:"tag_mutation",mutations:e}))}))}_createSubscriptionManager(){return new Dt(this._client,this._mutations,this._storage,(()=>zt(this,void 0,void 0,(function*(){return yield this._ready,this._storage.getOrCreateContactId()}))),(()=>zt(this,void 0,void 0,(function*(){return yield this._ready,this._storage.getContactIdLastChangedTimestamp()}))),(()=>zt(this,void 0,void 0,(function*(){return yield this._assertContactsEnabled(),this._featureQuerier.areFeaturesEnabled("tags_and_attributes")}))),this._listHistory)}get subscriptions(){return this._subscriptions||(this._subscriptions=this._createSubscriptionManager()),this._subscriptions}_registerAndAssociateChannel(t){return zt(this,void 0,void 0,(function*(){yield this._ready;const e=Q(yield this._locale()),n=yield t(e);return this._associateChannel(n)}))}_associateChannel(t){return zt(this,void 0,void 0,(function*(){const e=yield this._storage.getOrCreateContactId();yield this._client.associateChannel(e,t),yield this._storage.appendAssociatedChannel(e,t)}))}registerEmail(t,e){return zt(this,void 0,void 0,(function*(){return yield this._ready,yield this._assertContactsEnabled(),this._registerAndAssociateChannel((n=>zt(this,void 0,void 0,(function*(){return{channelId:yield this._registration.registerEmail(t,Object.assign(Object.assign({},e),n)),platform:"email"}}))))}))}registerSms(t,e){return zt(this,void 0,void 0,(function*(){return yield this._ready,yield this._assertContactsEnabled(),this._registerAndAssociateChannel((n=>zt(this,void 0,void 0,(function*(){return{channelId:yield this._registration.registerSms(t,Object.assign(Object.assign({},e),n)),platform:"sms"}}))))}))}registerOpen(t,e){return zt(this,void 0,void 0,(function*(){return yield this._ready,yield this._assertContactsEnabled(),this._registerAndAssociateChannel((n=>zt(this,void 0,void 0,(function*(){return{channelId:yield this._registration.registerOpen(t,Object.assign(Object.assign({},e),n)),platform:"open"}}))))}))}associateChannel(t,n){return zt(this,void 0,void 0,(function*(){if(yield this._ready,yield this._assertContactsEnabled(),i=t,!pt.includes(i))throw new e.ValidationError(`invalid platform: ${t}`);var i;return this._associateChannel({platform:t,channelId:n})}))}_resolve(t){return zt(this,void 0,void 0,(function*(){return this._mutex.runExclusive((()=>zt(this,void 0,void 0,(function*(){const e=yield this._storage.getOrCreateContactId(),n=yield this._storage.getNamedUserId(),i=yield this._storage.getAuth();if(i)return{id:e,isAnonymous:!n,auth:i};const{id:r,isAnonymous:o,auth:s}=yield this._client.resolve({channelId:t,contactId:e});yield this._storage.setAuth(s);const a=e===r;return a&&!n===o?(this._lifecycle.accept("contact",Date.now(),{contactId:r,type:"resolve",contactIdSame:a}),{id:r,isAnonymous:o,auth:s}):(yield this._storage.setContactId(r),o&&(yield this._storage.clearNamedUserId()),yield this._maybeEmitConflict(e,n),this._lifecycle.accept("contact",Date.now(),{contactId:r,type:"resolve",contactIdSame:a}),{id:r,isAnonymous:o,auth:s})}))))}))}_doIdentify(t,e){return zt(this,void 0,void 0,(function*(){const n=yield this._storage.getOrCreateContactId(),{id:i,auth:r}=yield this._client.identify(t,{channelId:e,contactId:n});return n!==i&&(yield this._maybeEmitConflict(n)),yield this._storage.setContactId(i),yield this._storage.setNamedUserId(t),yield this._storage.setAuth(r),i}))}_doReset(t){return zt(this,void 0,void 0,(function*(){const e=yield this._storage.getOrCreateContactId();let n;if(t){const{id:e,auth:i}=yield this._client.reset(t);yield this._storage.setAuth(i),n=e}else n=yield this._storage.clearContactId();return e!==n&&(yield this._maybeEmitConflict(e,yield this._storage.getNamedUserId())),yield this._resetStoredContact(n),n}))}_onChannel(t){return zt(this,void 0,void 0,(function*(){yield this._ready;const{id:e}=t.detail;yield this._resolve(e);const n=new CustomEvent("_channel_handled");this.dispatchTypedEvent("_channel_handled",n)}))}_maybeEmitConflict(t,e){return zt(this,void 0,void 0,(function*(){const n=yield this._storage.getAttributeMutations(t),i=yield this._storage.getTagMutations(t),r=yield this._storage.getAssociatedChannels(t),o=yield this._storage.getSubscriptionListMutations(t);if(!(e||n.length||i.length||r.length||o.length))return;const s={namedUserId:e,attributes:A(n),tags:k(i),subscriptions:B(o),associatedChannels:r},a=new CustomEvent("conflict",{detail:s});this.dispatchTypedEvent("conflict",a)}))}get ready(){return this._ready}_resetStoredContact(t){return zt(this,void 0,void 0,(function*(){yield this._storage.setContactId(t),yield this._storage.clearNamedUserId()}))}_assertContactsEnabled(){return zt(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.areFeaturesEnabled("contacts")))throw new e.FeatureDisabledError("contacts feature is disabled")}))}_isContactEnabled(){return this._featureQuerier.areFeaturesEnabled("contacts")}}var Yt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Jt(t){return!!(0,n.Uy)(t)&&(!!(0,n.jn)(t.ok)&&(!!t.ok&&(function(t){return!!(0,n.Uy)(t)&&(0,n.HD)(t.contact_id)&&(0,n.jn)(t.is_anonymous)&&(0,n.HD)(t.channel_association_timestamp)}(t.contact)&&(0,n.HD)(t.token)&&(0,n.hj)(t.token_expires_in))))}class Xt{constructor(t,e,n){this._config=t,this._request=e,this._cache=n}listSubscriptions(t){return Yt(this,void 0,void 0,(function*(){const e=`${this._config.paths.subscription_lists_list}/${t}`;return function(t){const e={};return t.forEach((t=>{const n=t.scope;t.list_ids.forEach((t=>{e[t]?e[t].push(n):e[t]=[n]}))})),e}(yield this._cache.get(e,(t=>Yt(this,void 0,void 0,(function*(){try{const t=yield this._request.get(e);if(!t.ok)throw new Error("Unable to retrieve contact subscription lists");return{data:t.subscription_lists}}catch(e){if(t)return Object.assign(Object.assign({},t),{ttlMs:z.default.subscriptionLists.cacheMissStaleResponseTtlMs});throw e}})))))}))}}var te=class{constructor(t,e,n,{_getNow:i=(()=>Date.now())}={}){this._config=t,this._request=e,this._subscriptionListClient=n,this._getNow=i}_doIdentifyV2Request(t,e){return Yt(this,void 0,void 0,(function*(){const n=this._config.paths.identify,i={device_info:{device_type:"web"},action:e},r={"X-UA-Channel-ID":t},o=this._getNow();return function({contact:t,token:e,token_expires_in:n},i){return{id:t.contact_id,isAnonymous:t.is_anonymous,auth:{token:e,fetchedAtMs:i,ttlMs:n}}}(yield this._request.post(n,i,{headers:r,predicate:Jt}),o)}))}identify(t,{channelId:e,contactId:n}){return this._doIdentifyV2Request(e,{type:"identify",contact_id:n,named_user_id:t})}resolve({channelId:t,contactId:e}){return this._doIdentifyV2Request(t,{type:"resolve",contact_id:e})}reset(t){return this._doIdentifyV2Request(t,{type:"reset"})}listSubscriptions(t){return Yt(this,void 0,void 0,(function*(){return yield this._subscriptionListClient.listSubscriptions(t)}))}associateChannel(t,e){return Yt(this,void 0,void 0,(function*(){const n=`${this._config.paths.batch}/${t}`,i={associate:[{channel_id:e.channelId,device_type:e.platform}]};yield this._request.post(n,i)}))}};function ee(){return window.location}var ne=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const ie=s(953);var re=class{constructor(t,e,n={},i){if(!t)throw new ReferenceError("argument: `name` is required.");this._name=t,this.value=e,this._properties=n,this.transactionId=i,this.interactionId=ee().href,this.interactionType="url"}get value(){return this._value}set value(t){if(t&&(t=Number(t),Number.isNaN(t)||"number"!=typeof t))throw new TypeError("`value` must be a number");this._value=t}get name(){return this._name}get properties(){return this._properties}set properties(t){this._properties=t}_prepareInteractionId(){return ne(this,void 0,void 0,(function*(){if(this.interactionId===ee().href&&this.interactionId.length<=255)return!1;const t=new window.TextEncoder("utf-8").encode(this.interactionId),e=yield window.crypto.subtle.digest("SHA-256",t),n=Array.from(new Uint8Array(e)).map((t=>("0"+t.toString(16)).slice(-2))).join("");return this.interactionId=`${this.interactionId.slice(0,230)}...${n.slice(0,20)}`,!0}))}validate(){this._validateProperties(this.properties);const t=["name","transactionId","interactionId","interactionType"];for(const e of t){const t=this[e];if(void 0!==t){if(!(0,n.HD)(t))throw new TypeError(`CustomEvent.${e} must be a string`);if(t.length>255)throw new RangeError(`CustomEvent.${e} has a 255 character limit`)}}}_validateProperties(t){if(Array.isArray(t)||"object"!=typeof t)throw new TypeError("CustomEvent: properties must be an object");let e;try{e=JSON.stringify(t)}catch(t){throw new TypeError("CustomEvent: properties must be JSON serializable.")}if(e.length>32768)throw new RangeError(`CustomEvent: properties are ${e.length} when JSON encoded, exceeding the maximum of 32768.`)}_validateBooleanProperty(t){if(this._properties&&this._properties.hasOwnProperty(t)&&"boolean"!=typeof this._properties[t])throw new TypeError(`CustomEvent property '${t}' must be a Boolean`)}_validateIsoDateProperty(t){if(this._properties&&this._properties.hasOwnProperty(t)&&!ie(this._properties[t]))throw new TypeError(`CustomEvent property '${t}' must be an ISO_8601 date string`)}track(){return ne(this,void 0,void 0,(function*(){return yield this._prepareInteractionId(),this.validate(),this.sendEvent()}))}};class oe extends re{constructor(t,e={},n){super("registered_account",t,e,n),this.templateType="account"}get properties(){const t=this._properties;return this.value&&(t.ltv=!0),t}}class se extends re{constructor(t,e,n={},i){super(t,e,n,i),this.templateType="media"}validate(){this._validateBooleanProperty("feature"),this._validateIsoDateProperty("published_date"),super.validate()}get properties(){const t=this._properties;return this.value&&(t.ltv=!0),t}}class ae extends se{constructor(t,e={},n){super("browsed_content",t,e,n)}}class ce extends se{constructor(t,e={},n){super("consumed_content",t,e,n)}}class ue extends se{constructor(t,e={},n){super("starred_content",t,e,n)}}class de extends se{constructor(t,e,n={},i){super("shared_content",void 0,n,i),this._properties.source=t,this._properties.medium=e}}class le extends re{constructor(t,e,n={},i){super(t,e,n,i),this.templateType="retail"}validate(){this._validateBooleanProperty("new_item"),super.validate()}}class he extends le{constructor(t,e={},n){super("browsed",t,e,n)}}class fe extends le{constructor(t,e={},n){super("added_to_cart",t,e,n)}}class pe extends le{constructor(t,e={},n){super("purchased",t,e,n)}get properties(){const t=this._properties;return this.value&&(t.ltv=!0),t}}class ve extends le{constructor(t,e={},n){super("starred_product",t,e,n)}}class ye extends le{constructor(t,e,n={},i){super("shared_product",void 0,n,i),this._properties.source=t,this._properties.medium=e}}const _e=(t,e)=>e.some((e=>t instanceof e));let ge,me;const be=new WeakMap,we=new WeakMap,Ee=new WeakMap;let Se={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return be.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Me(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function Ae(t){Se=t(Se)}function Ie(t){return(me||(me=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Pe(this),e),Me(this.request)}:function(...e){return Me(t.apply(Pe(this),e))}}function xe(t){return"function"==typeof t?Ie(t):(t instanceof IDBTransaction&&function(t){if(be.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{e(),i()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)}));be.set(t,e)}(t),_e(t,ge||(ge=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Se):t)}function Me(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{e(Me(t.result)),i()},o=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",o)}));return Ee.set(e,t),e}(t);if(we.has(t))return we.get(t);const e=xe(t);return e!==t&&(we.set(t,e),Ee.set(e,t)),e}const Pe=t=>Ee.get(t);function Oe(t,e,{blocked:n,upgrade:i,blocking:r,terminated:o}={}){const s=indexedDB.open(t,e),a=Me(s);return i&&s.addEventListener("upgradeneeded",(t=>{i(Me(s.result),t.oldVersion,t.newVersion,Me(s.transaction),t)})),n&&s.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{o&&t.addEventListener("close",(()=>o())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const Ce=["get","getKey","getAll","getAllKeys","count"],ke=["put","add","delete","clear"],De=new Map;function Te(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(De.get(e))return De.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=ke.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Ce.includes(n))return;const o=async function(t,...e){const o=this.transaction(t,r?"readwrite":"readonly");let s=o.store;return i&&(s=s.index(e.shift())),(await Promise.all([s[n](...e),r&&o.done]))[0]};return De.set(e,o),o}Ae((t=>({...t,get:(e,n,i)=>Te(e,n)||t.get(e,n,i),has:(e,n)=>!!Te(e,n)||t.has(e,n)})));const Fe=["continue","continuePrimaryKey","advance"],je={},Re=new WeakMap,Be=new WeakMap,Ne={get(t,e){if(!Fe.includes(e))return t[e];let n=je[e];return n||(n=je[e]=function(...t){Re.set(this,Be.get(this)[e](...t))}),n}};async function*Ve(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;const n=new Proxy(e,Ne);for(Be.set(n,e),Ee.set(n,Pe(e));e;)yield n,e=await(Re.get(n)||e.continue()),Re.delete(n)}function Ue(t,e){return e===Symbol.asyncIterator&&_e(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&_e(t,[IDBIndex,IDBObjectStore])}Ae((t=>({...t,get(e,n,i){return Ue(e,n)?Ve:t.get(e,n,i)},has(e,n){return Ue(e,n)||t.has(e,n)}})));var Le=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},$e=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,r){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,r,(e=t[n](e)).done,e.value)}))}}};const qe=(0,vt.g$)("db-migrations"),Ke={1:function(t,e){qe("add tag store"),t.createObjectStore(p.U4,{keyPath:"group"})},2:function(t,e){qe("add queued event store");const n=t.createObjectStore(p.uE,{keyPath:"uniqueId"});n.createIndex("type","type"),n.createIndex("sendsAttempted","sendsAttempted"),n.createIndex("queuedAtMs","queuedAtMs"),n.createIndex("lastAttemptedAtMs","lastAttemptedAtMs"),n.createIndex("lastSendId","lastSendId")},3:function(t,e){(function(t,e){qe("add iaa instance store");const n=t.createObjectStore(p.G4,{keyPath:"id"});n.createIndex("createdAtMs","createdAtMs"),n.createIndex("lastUpdatedAtMs","lastUpdatedAtMs"),n.createIndex("storedAtMs","storedAtMs"),n.createIndex("priority","priority"),n.createIndex("executionCount","executionCount")})(t),function(t,e){qe("add iaa schedule state store");const n=t.createObjectStore(p.pz,{keyPath:"scheduleId"});n.createIndex("state","state"),n.createIndex("transitionedAtMs","transitionedAtMs")}(t),function(t,e){qe("add iaa trigger store");const n=t.createObjectStore(p.Ip,{keyPath:"id"});n.createIndex("type","type"),n.createIndex("scheduleId","scheduleId"),n.createIndex("scheduleId-type-behavior",["scheduleId","type","behavior"])}(t)},4:function(t,e){qe("add frequency constraint stores");t.createObjectStore(p.yO,{keyPath:"id"}).createIndex("type","type");const n=t.createObjectStore(p.zW,{keyPath:"id",autoIncrement:!0});n.createIndex("constraintId","constraintId"),n.createIndex("occurredAtMs","occurredAtMs"),n.createIndex("constraintId-occurred",["constraintId","occurredAtMs"])},5:function(t,e){qe("add queued event store composite index");e.objectStore(p.uE).createIndex("type-queuedAtMs",["type","queuedAtMs"])},6:function(t,e){qe("add queued event store tombstone composite indexes");const n=e.objectStore(p.uE);n.createIndex("tombstone","tombstone"),n.createIndex("tombstone-type-queuedAtMs",["tombstone","type","queuedAtMs"]),n.createIndex("tombstone-lastAttemptedAtMs",["tombstone","lastAttemptedAtMs"]);(()=>Le(this,void 0,void 0,(function*(){var t,e,i,r,o;try{for(var s,a=!0,c=$e(n.index("type"));!(t=(s=yield c.next()).done);a=!0){r=s.value,a=!1;const t=r;t.update(Object.assign(Object.assign({},t.value),{tombstone:null!==(o=t.value.tombstone)&&void 0!==o?o:0}))}}catch(t){e={error:t}}finally{try{a||t||!(i=c.return)||(yield i.call(c))}finally{if(e)throw e.error}}})))().catch((t=>qe(t)))},7:function(t,e){qe("add message display history store");t.createObjectStore(p.I5,{keyPath:"scheduleId"}).createIndex("scheduleId","scheduleId")},8:function(t,e){const n=t.createObjectStore(p.eW,{keyPath:"id",autoIncrement:!0});n.createIndex("expiresAtMs","expiresAtMs"),n.createIndex("hashedId","hashedId"),n.createIndex("hashedIdType","hashedIdType"),n.createIndex("stickyId","stickyId"),n.createIndex("storedAtMs","storedAtMs"),n.createIndex("hashedIdType-hashedId-stickyId-storedAtMs",["hashedIdType","hashedId","stickyId","storedAtMs"])},9:function(t,e){qe("add remote data listing store");const n=t.createObjectStore(p.yU,{keyPath:"id",autoIncrement:!0});n.createIndex("source","source"),n.createIndex("sourceId","sourceId"),n.createIndex("lastKnownStatus","lastKnownStatus"),n.createIndex("sdkVersion","sdkVersion"),n.createIndex("fetchedAtMs","fetchedAtMs"),n.createIndex("language","language"),n.createIndex("country","country"),n.createIndex("randomValue","randomValue"),n.createIndex("source-sourceId-sdkVersion-randomValue-fetchedAtMs",["source","sourceId","sdkVersion","randomValue","fetchedAtMs"])}},We={[p.Vp]:Ke};class He{constructor(t,e,n){this._name=t,this._version=e,this._migrations=n}get db(){return this._dbHandle||(this._dbHandle=Oe(this._name,this._version,{upgrade:(t,e,n,i)=>{var r,o;const s=e+1,a=n||s;for(let e=s;e<=a;++e)null===(o=(r=this._migrations)[e])||void 0===o||o.call(r,t,i)}})),this._dbHandle}static prefixName(t){return`${z.default.storagePrefix}:ua:${t}`}}const Ze={};function Ge(){return function(t){const e=He.prefixName(t),n=We[t];if(!n)throw new Error(`invalid configuration: db name "${t}" has no migrations present`);const i=Math.max(...Object.keys(n).map(Number));if(i<1)throw new Error(`invalid configuration: could not discern valid db version for "${t}"`);return Ze[t]||(Ze[t]=new He(e,i,n)),Ze[t].db}(p.Vp)}var ze=s(3518),Qe=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},Ye=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,r){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,r,(e=t[n](e)).done,e.value)}))}}};const Je="NO_CONTACT_ID";class Xe{constructor(t,e,n,i,r,{channel:o,contact:s,maxEventsPerRequest:a=100}){this._db=t,this._deliverWarp9Events=e,this._deliverVenusEvents=n,this._deliverMutationEvents=r,this._deliverMeteredUsageEvents=i,this._channel=o,this._contact=s,this._maxEventsPerRequest=a}acceptWarp9Event(t,e){return this._db.add("warp9",{device:e,event:t})}acceptVenusEvent(t){return this._db.add("venus",t)}acceptChannelMutation(t){return this._db.add("channel_mutation",t)}acceptContactMutation(t){return this._db.add("contact_mutation",t)}acceptMeteredUsageEvent(t,e){return this._db.add("metered_usage",{device:e,event:t})}_flushMutationEvents(t){return Qe(this,void 0,void 0,(function*(){var e,n,i,r;const o=yield this._channel();if(!o)return;const s=yield this._contact(),a=(0,Ft.Z)(),c=[];try{for(var u,d=!0,l=Ye(this._db.listAndMarkSent(`${t}_mutation`,a));!(e=(u=yield l.next()).done);d=!0){r=u.value,d=!1;const t=r;c.push(t)}}catch(t){n={error:t}}finally{try{d||e||!(i=l.return)||(yield i.call(l))}finally{if(n)throw n.error}}if(!c.length)return;let h;switch(t){case"channel":h=o;break;case"contact":if(!s)return;h=s;break;default:throw new Error(`unknown mutation type: ${t}`)}try{yield this._deliverMutationEvents.acceptMutationEvents(t,h,c)}catch(t){if(!(t instanceof ze.$))throw t;console.debug("unable to record channel mutations",t)}yield this._db.tombstoneForSendId(a)}))}_flushWarp9Events(){return Qe(this,void 0,void 0,(function*(){var t,e,n,i;const r=(0,Ft.Z)(),o=[];try{for(var s,a=!0,c=Ye(this._db.listAndMarkSent("warp9",r));!(t=(s=yield c.next()).done);a=!0){i=s.value,a=!1;const t=i;if(o.push(t),o.length>=this._maxEventsPerRequest)break}}catch(t){e={error:t}}finally{try{a||t||!(n=c.return)||(yield n.call(c))}finally{if(e)throw e.error}}if(o.length){try{yield this._deliverWarp9Events.acceptWarp9Events(o.map((({event:t})=>t)),o[o.length-1].device)}catch(t){if(!(t instanceof ze.$))throw t;console.debug("unable to record warp9 events",t)}yield this._db.tombstoneForSendId(r),o.length>=this._maxEventsPerRequest&&(yield this._flushWarp9Events())}}))}_flushVenusEvents(){return Qe(this,void 0,void 0,(function*(){var t,e,n,i;const r=(0,Ft.Z)(),o=[];try{for(var s,a=!0,c=Ye(this._db.listAndMarkSent("venus",r));!(t=(s=yield c.next()).done);a=!0){i=s.value,a=!1;const t=i;if(o.push(t),o.length>=this._maxEventsPerRequest)break}}catch(t){e={error:t}}finally{try{a||t||!(n=c.return)||(yield n.call(c))}finally{if(e)throw e.error}}if(o.length){try{yield this._deliverVenusEvents.acceptVenusEvents(o)}catch(t){if(!(t instanceof ze.$))throw t;console.debug("unable to record venus events",t)}yield this._db.tombstoneForSendId(r),o.length>=this._maxEventsPerRequest&&(yield this._flushVenusEvents())}}))}_flushMeteredUsageEvents(){return Qe(this,void 0,void 0,(function*(){var t,e,n,i,r;const o=(0,Ft.Z)(),s={};let a=!1;try{for(var c,u=!0,d=Ye(this._db.listAndMarkSent("metered_usage",o));!(t=(c=yield d.next()).done);u=!0){i=c.value,u=!1;const{event:t,device:e}=i,n=null!==(r=e.contactId)&&void 0!==r?r:Je;if(s[n]||(s[n]=[]),s[n].push(t),s[n].length>=this._maxEventsPerRequest){a=!0;break}}}catch(t){e={error:t}}finally{try{u||t||!(n=d.return)||(yield n.call(d))}finally{if(e)throw e.error}}if(!Object.keys(s).length)return;const l=yield this._channel();if(l){try{yield Promise.all(Object.entries(s).map((([t,e])=>this._deliverMeteredUsageEvents.acceptMeteredUsageEvents(e,{channelId:l,contactId:t===Je?void 0:t}))))}catch(t){if(!(t instanceof ze.$))throw t;console.debug("unable to record impression events",t)}yield this._db.tombstoneForSendId(o),a&&(yield this._flushMeteredUsageEvents())}}))}flush(){return Qe(this,void 0,void 0,(function*(){yield Promise.all([this._flushWarp9Events(),this._flushMutationEvents("channel"),this._flushMutationEvents("contact"),this._flushMeteredUsageEvents(),this._flushVenusEvents()]),yield this._db.prune()}))}}var tn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},en=function(t){return this instanceof en?(this.v=t,this):new en(t)},nn=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,r){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,r,(e=t[n](e)).done,e.value)}))}}},rn=function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(t,e||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(t){return function(e){return Promise.resolve(e).then(t,u)}})),i[Symbol.asyncIterator]=function(){return this},i;function s(t,e){r[t]&&(i[t]=function(e){return new Promise((function(n,i){o.push([t,e,n,i])>1||a(t,e)}))},e&&(i[t]=e(i[t])))}function a(t,e){try{(n=r[t](e)).value instanceof en?Promise.resolve(n.value.v).then(c,u):d(o[0][2],n)}catch(t){d(o[0][3],t)}var n}function c(t){a("next",t)}function u(t){a("throw",t)}function d(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}};class on{constructor(t,{_getNow:e=(()=>Date.now()),minTimeBetweenAttemptsMs:n,retainSentRecordsForMs:i}){this._db=t,this._minTimeBetweenAttemptsMs=n,this._retainSentRecordsForMs=i,this._getNow=e}add(t,e){return tn(this,void 0,void 0,(function*(){const n=this._db.transaction(p.uE,"readwrite"),i=n.objectStore(p.uE);let r;switch(t){case"warp9":r=e.event.event_id;break;case"venus":r=e.event_id;break;case"channel_mutation":case"contact_mutation":r=(0,Ft.Z)();break;case"metered_usage":r=e.event.eventId;break;case"custom_event":throw new Error("cannot add deprecated event type: custom_event");default:throw new Error(`invalid event type: ${t}`)}yield i.put({uniqueId:r,tombstone:0,sendsAttempted:0,queuedAtMs:this._getNow(),lastAttemptedAtMs:0,lastSendId:"",type:t,event:e}),yield n.done}))}listAndMarkSent(t,e){return rn(this,arguments,(function*(){var n,i,r,o;const s=this._db.transaction(p.uE,"readwrite"),a=s.objectStore(p.uE),c=yield en(a.index("tombstone-type-queuedAtMs").openCursor(IDBKeyRange.bound([0,t,0],[0,t,1/0]))),u=this._getNow()-this._minTimeBetweenAttemptsMs;if(!c)return yield en(null);try{for(var d,l=!0,h=nn(c);!(n=(d=yield en(h.next())).done);l=!0){o=d.value,l=!1;const n=o,{value:i}=n;!on.IDEMPOTENT_RECORD_TYPES.includes(t)&&i.lastAttemptedAtMs>u||(n.update(Object.assign(Object.assign({},i),{sendsAttempted:i.sendsAttempted+1,lastAttemptedAtMs:this._getNow(),lastSendId:e})),yield yield en(n.value.event))}}catch(t){i={error:t}}finally{try{l||n||!(r=h.return)||(yield en(r.call(h)))}finally{if(i)throw i.error}}yield en(s.done)}))}getRetained(t){return tn(this,void 0,void 0,(function*(){var e,n,i,r;const o=this._db.transaction(p.uE,"readonly").objectStore(p.uE),s=yield o.index("type-queuedAtMs").openCursor(IDBKeyRange.bound([t,0],[t,1/0]),"next");if(!s)return[];const a=this._getNow()-this._retainSentRecordsForMs,c=[];try{for(var u,d=!0,l=nn(s);!(e=(u=yield l.next()).done);d=!0){r=u.value,d=!1;const t=r,{value:e}=t;(e.queuedAtMs>a||!e.tombstone)&&c.push(e.event)}}catch(t){n={error:t}}finally{try{d||e||!(i=l.return)||(yield i.call(l))}finally{if(n)throw n.error}}return c}))}tombstoneForSendId(t){return tn(this,void 0,void 0,(function*(){var e,n,i,r;const o=this._db.transaction(p.uE,"readwrite").objectStore(p.uE),s=yield o.index("lastSendId").openCursor(IDBKeyRange.only(t),"next");if(s)try{for(var a,c=!0,u=nn(s);!(e=(a=yield u.next()).done);c=!0){r=a.value,c=!1;const t=r;t.update(Object.assign(Object.assign({},t.value),{tombstone:1}))}}catch(t){n={error:t}}finally{try{c||e||!(i=u.return)||(yield i.call(u))}finally{if(n)throw n.error}}}))}prune(){return tn(this,void 0,void 0,(function*(){var t,e,n,i;const r=this._getNow()-this._retainSentRecordsForMs,o=this._db.transaction(p.uE,"readwrite"),s=o.objectStore(p.uE),a=yield s.index("tombstone-lastAttemptedAtMs").openCursor(IDBKeyRange.bound([1,0],[1,r]),"next");if(a){try{for(var c,u=!0,d=nn(a);!(t=(c=yield d.next()).done);u=!0){i=c.value,u=!1;i.delete()}}catch(t){e={error:t}}finally{try{u||t||!(n=d.return)||(yield n.call(d))}finally{if(e)throw e.error}}yield o.done}}))}purge(t,e){return tn(this,void 0,void 0,(function*(){var n,i,r,o;const s=this._db.transaction(p.uE,"readwrite"),a=s.objectStore(p.uE),c=yield a.index("type-queuedAtMs").openCursor(IDBKeyRange.bound([t,0],[t,1/0]),"next");if(c){try{for(var u,d=!0,l=nn(c);!(n=(u=yield l.next()).done);d=!0){o=u.value,d=!1;const t=o;e(t.value.event)&&t.delete()}}catch(t){i={error:t}}finally{try{d||n||!(r=l.return)||(yield r.call(l))}finally{if(i)throw i.error}}return s.done}}))}}on.IDEMPOTENT_RECORD_TYPES=["channel_mutation","contact_mutation"];var sn=on;p.Vp;const an=["attributes","tags","subscription_lists","scoped_subscription_lists"];function cn(t){return!!(0,n.HD)(t)&&an.includes(t)}function un(t){return"attributes"===t.type}function dn(t){return"tags"===t.type}function ln(t){return"subscription_lists"===t.type}function hn(t){return"scoped_subscription_lists"===t.type}var fn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class pn{constructor(t){this._db=t}history(t){return fn(this,void 0,void 0,(function*(){return this._db.getRetained(t)}))}channelListMutations(){return fn(this,void 0,void 0,(function*(){return(yield this.history("channel_mutation")).filter(ln).reduce(((t,{mutations:e})=>(t.push(...e),t)),[])}))}contactListMutations(){return fn(this,void 0,void 0,(function*(){return(yield this.history("contact_mutation")).filter(hn).reduce(((t,{mutations:e})=>(t.push(...e),t)),[])}))}}function vn(t){if(!function(t){if(!(0,n.Uy)(t))return!1;if("language"in t){const e=t.language;if(!(0,n.HD)(e)&&!(0,n.le)(e))return!1}if("country"in t){const e=t.country;if(!(0,n.HD)(e)&&!(0,n.le)(e))return!1}return!0}(t))throw new e.ValidationError("invalid locale object provided");let i=t.country;if((0,n.HD)(i)&&(i=i.trim().toUpperCase(),2!==i.length))throw new e.ValidationError(`invalid country value: ${t.country}`);let r=t.language;if((0,n.HD)(r)&&(r=r.trim().toLowerCase(),2!==r.length))throw new e.ValidationError(`invalid language value: ${t.language}`);return{country:i,language:r}}var yn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class _n extends b.y{constructor(t,e,{normalizationFn:n=vn}={}){super(),this._localeStorage=t,this._resolver=e,this._normalize=n}set(t){return yn(this,void 0,void 0,(function*(){const e=this._normalize(t);"updated"===(yield this._localeStorage.set(e))&&this._notify(e)}))}clear(){return yn(this,void 0,void 0,(function*(){yield this._localeStorage.clear(),this._notify()}))}get(){return yn(this,void 0,void 0,(function*(){const t=yield this._localeStorage.get();return this._resolver.resolve(t)}))}_notify(t){const e=new CustomEvent("locale",{detail:this._resolver.resolve(t)});this.dispatchTypedEvent("locale",e)}}var gn=_n;class mn{resolve(t={}){const e=Q(Object.assign({country:null,language:null},t));return{country:e.localeCountry,language:e.localeLanguage}}}var bn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const wn="localeOverride";class En{constructor(t){this._db=t}get(){return bn(this,void 0,void 0,(function*(){const t=yield this._db.get(wn);return{language:null==t?void 0:t.locale_language,country:null==t?void 0:t.locale_country}}))}set(t){return bn(this,void 0,void 0,(function*(){const[e]=yield this._db.mutate(wn,((e={})=>{const n=Object.assign({},e);if(void 0!==t.country&&(n.locale_country=t.country),void 0!==t.language&&(n.locale_language=t.language),e.locale_country===n.locale_country&&e.locale_language===n.locale_language)throw new u.A("locale was not updated");return n}));return e?"updated":"not-changed"}))}clear(){return bn(this,void 0,void 0,(function*(){return this._db.remove(wn)}))}}var Sn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};var An=class{constructor(){this.plugins=new Map,this.loaders=new Map}get list(){const t=[];for(const e of this.plugins.keys())t.push(e);return t}load(t,e,n){const i=this.loaders.get(t);if(i)return i;const r=new Promise((i=>{const r={url:e,opts:n,setLoaded:t=>{i(t)}};this.plugins.set(t,r)}));this.loaders.set(t,r);const o=function(t,e,n=document){const i=n.createElement("script");return i.src=e,i.async=!0,i.setAttribute("rel",t),n.head.appendChild(i),i}(t,e);return o.addEventListener("error",(()=>{throw this.loaders.delete(t),new Error(`Error while loading plugin at URL: '${e}'`)})),r}_setLoaded(t,e,n){const i=this.plugins.get(t);if(!i)throw new Error(`Airship Plugin ${t} does not match any currently loading plugins: ${this.list.join(", ")}`);return i.setLoaded(e(i.opts,n))}get(t){return Sn(this,void 0,void 0,(function*(){const e=this.loaders.get(t);if(e)return e;throw new Error(`The plugin '${t}' is not loaded. Make sure you have called plugins.load(...) correctly.`)}))}};function In(t,e){return e.push_address=t.endpoint,e.web.subscription=t.toJSON().keys,{channel:e}}var xn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Mn(t){return xn(this,void 0,void 0,(function*(){const e=On(),n=yield Pn(t);return n||function(t,e){return t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})}(t,e)}))}function Pn(t){return xn(this,void 0,void 0,(function*(){const n=On();if(!("pushManager"in t))throw new e.UnsupportedContextError("push manager is not available in this context");const i=yield t.pushManager.getSubscription();if(i){if(r=new Uint8Array(i.options.applicationServerKey),o=n,r.length===o.length&&r.every(((t,e)=>t===o[e])))return i;yield i.unsubscribe()}var r,o}))}function On(){const t=z.default.vapidPublicKey;if("string"!=typeof t)throw new e.InvalidConfigurationError("vapidPublicKey not configured");return function(t){let e;try{e=window}catch(t){e=self}const n=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=e.atob(n),r=new Uint8Array(i.length);for(let t=0;t<i.length;++t)r[t]=i.charCodeAt(t);return r}(t)}var Cn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};var kn=s(3577),Dn=s.n(kn),Tn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},Fn=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,r){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,r,(e=t[n](e)).done,e.value)}))}}};class jn{constructor(t,{obsoleteAfterMs:e,_getNow:n=(()=>Date.now())}){this._db=t,this._obsoleteAfterMs=e,this._getNow=n}get(t,e,n){return Tn(this,arguments,void 0,(function*(t,e,{locale:n,randomValue:i,sdkVersion:r}){var o,s,a,c;const u=this._db.transaction(p.yU,"readonly").objectStore(p.yU),d=yield u.index("source-sourceId-sdkVersion-randomValue-fetchedAtMs").openCursor(IDBKeyRange.bound([t,e,r,i,0],[t,e,r,i,1/0]),"prev");if(d)try{for(var l,h=!0,f=Fn(d);!(o=(l=yield f.next()).done);h=!0){c=l.value,h=!1;const{value:t}=c;if(jn._localeMatchesRecord(n,t)){return{status:this._recordStatus(t),fetchedAtMs:t.fetchedAtMs,payloads:t.payloads}}}}catch(t){s={error:t}}finally{try{h||o||!(a=f.return)||(yield a.call(f))}finally{if(s)throw s.error}}}))}static _localeMatchesRecord(t,e){var n,i;const r=t.country===(null!==(n=e.country)&&void 0!==n?n:null),o=t.language===(null!==(i=e.language)&&void 0!==i?i:null);return r&&o}_recordStatus({fetchedAtMs:t,lastKnownStatus:e}){const n=this._getNow();return t+this._obsoleteAfterMs<n?"obsolete":e}put(t,e,n,i,r){return Tn(this,arguments,void 0,(function*(t,e,n,{locale:i,randomValue:r,sdkVersion:o},s){var a,c;const u=this._db.transaction(p.yU,"readwrite").objectStore(p.yU);yield this._markStale(u,t,e,{sdkVersion:o}),yield u.put({source:t,sourceId:e,lastKnownStatus:"current",fetchedAtMs:n,randomValue:r,sdkVersion:o,payloads:s,country:null!==(a=i.country)&&void 0!==a?a:void 0,language:null!==(c=i.language)&&void 0!==c?c:void 0})}))}markStale(t,e,n){return Tn(this,arguments,void 0,(function*(t,e,{sdkVersion:n}){const i=this._db.transaction(p.yU,"readwrite").objectStore(p.yU);return this._markStale(i,t,e,{sdkVersion:n})}))}_markStale(t,e,n,i){return Tn(this,arguments,void 0,(function*(t,e,n,{sdkVersion:i}){var r,o,s,a;const c=yield t.index("source-sourceId-sdkVersion-randomValue-fetchedAtMs").openCursor(IDBKeyRange.bound([e,n,i,0,0],[e,n,i,1/0,1/0]),"prev");if(c)try{for(var u,d=!0,l=Fn(c);!(r=(u=yield l.next()).done);d=!0){a=u.value,d=!1;const t=a;"current"===t.value.lastKnownStatus&&(yield t.update(Object.assign(Object.assign({},t.value),{lastKnownStatus:"stale"})))}}catch(t){o={error:t}}finally{try{d||r||!(s=l.return)||(yield s.call(l))}finally{if(o)throw o.error}}}))}prune(t,e){return Tn(this,void 0,void 0,(function*(){var n,i,r,o;const s=this._db.transaction(p.yU,"readwrite").objectStore(p.yU),a=yield s.index("fetchedAtMs").openCursor(IDBKeyRange.lowerBound(0),"prev");if(!a)return;const c={app:[],contact:[]};try{for(var u,d=!0,l=Fn(a);!(n=(u=yield l.next()).done);d=!0){o=u.value,d=!1;const n=o,{value:i}=n,r=this._recordStatus(i),s=t[i.source]===i.sourceId,a=jn._localeMatchesRecord(e,i),l=c[i.source].includes(t[i.source]);if(c[i.source].push(i.sourceId),l||!s||!a)switch(r){case"obsolete":yield n.delete();continue;case"stale":if(!l)continue;yield n.delete();continue;case"current":continue}}}catch(t){i={error:t}}finally{try{d||n||!(r=l.return)||(yield r.call(l))}finally{if(i)throw i.error}}}))}}class Rn{constructor(t){this._db=t}variantSeed(){return Tn(this,void 0,void 0,(function*(){return this._db.getOrLoad(Rn.VARIANT_SEED_KEY,(()=>Math.floor(Math.random()*Rn.MAX_VARIANT)))}))}}Rn.VARIANT_SEED_KEY="remote_data:variant_seed",Rn.MAX_VARIANT=1e4;class Bn{constructor(t){this._db=t}get(){return Tn(this,void 0,void 0,(function*(){const t=yield this._db.get(Bn.APP_CONFIG_KEY);return null!=t?t:{}}))}update(t){return Tn(this,void 0,void 0,(function*(){return this._db.mutate(Bn.APP_CONFIG_KEY,(e=>{const n=t(null!=e?e:{});if(Dn()(e)===Dn()(n))throw new u.A("no update required");return n}))}))}}Bn.APP_CONFIG_KEY="remote_data:app_config";var Nn=s(9553),Vn=s(1761),Un=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Ln{constructor(t,e){this._appConfigProvider=t,this._featureQuerier=e}validateAnalyticsAllowed(){return Un(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.anyFeaturesEnabled()))throw new e.DataCollectionDisabledError;if(!(yield this._featureQuerier.areFeaturesEnabled("analytics")))throw new e.AnalyticsDisabledError}))}analyticsEnabled(){return this._featureQuerier.areFeaturesEnabled("analytics")}meteredUsageEnabled(){return Un(this,void 0,void 0,(function*(){const{enableMeteredUsage:t}=yield this._appConfigProvider.get();return t}))}}class $n{constructor(t,e,n,i,r,o,s,{_getRegistrationBase:a=J}={}){this.screenViewEvent=this._wrapWarp9Reporting(this._screenViewEvent.bind(this)),this.customEvent=this._wrapWarp9Reporting(this._customEvent.bind(this)),this.notificationButtonClick=this._wrapWarp9Reporting(this._notificationButtonClick.bind(this)),this.featureFlagInteraction=this._wrapWarp9Reporting(this._featureFlagInteraction.bind(this)),this.inAppDisplay=this._wrapWarp9Reporting(this._inAppDisplay.bind(this)),this.inAppResolution=this._wrapWarp9Reporting(this._inAppResolution.bind(this)),this.buttonTap=this._wrapWarp9Reporting(this._buttonTap.bind(this)),this.inAppFormSubmit=this._wrapWarp9Reporting(this._inAppFormSubmit.bind(this)),this.inAppFormDisplay=this._wrapWarp9Reporting(this._inAppFormDisplay.bind(this)),this.inAppPageView=this._wrapWarp9Reporting(this._inAppPageView.bind(this)),this.inAppPageSwipe=this._wrapWarp9Reporting(this._inAppPageSwipe.bind(this)),this.inAppPagerCompleted=this._wrapWarp9Reporting(this._inAppPagerCompleted.bind(this)),this.inAppPagerSummary=this._wrapWarp9Reporting(this._inAppPagerSummary.bind(this)),this.inAppPermissionResult=this._wrapWarp9Reporting(this._inAppPermissionResult.bind(this)),this.inAppGesture=this._wrapWarp9Reporting(this._inAppGesture.bind(this)),this.inAppPageAction=this._wrapWarp9Reporting(this._inAppPageAction.bind(this)),this.associateIdentifiers=this._wrapWarp9Reporting(this._associateIdentifiers.bind(this)),this._events=t,this._analyticsConfig=e,this._channelId=n,this._contactId=i,this._session=r,this._intlDetails=o,this._optedIn=s,this._getRegistrationBase=a}notificationClick(t,e){return Un(this,arguments,void 0,(function*({sendId:t},e){yield this._analyticsConfig.validateAnalyticsAllowed();const{country:n=null,language:i=null}=yield this._getLocale(),r={event_type:"click",occurred:(0,w.Z1)(e),event_id:(0,Ft.Z)(),send_id:t,channel:Object.assign({channel_id:yield this._channelId()},this._getRegistrationBase({optedIn:yield this._optedIn(),localeOverride:{country:n,language:i},analyticsEnabled:yield this._analyticsConfig.analyticsEnabled()}))};yield this._events.acceptVenusEvent(r)}))}session(t,e){return Un(this,arguments,void 0,(function*({id:t,send_id:e},n){yield this._analyticsConfig.validateAnalyticsAllowed();const{country:i=null,language:r=null}=yield this._getLocale(),o={event_type:"session",occurred:(0,w.Z1)(n),event_id:(0,Ft.Z)(),send_id:e,session_id:t,channel:Object.assign({channel_id:yield this._channelId()},this._getRegistrationBase({optedIn:yield this._optedIn(),localeOverride:{country:i,language:r},analyticsEnabled:yield this._analyticsConfig.analyticsEnabled()}))};yield this._events.acceptVenusEvent(o)}))}inAppImpression(t,e){return Un(this,void 0,void 0,(function*(){if(!(yield this._analyticsConfig.meteredUsageEnabled()))return void(0,vt.ZP)("dropping impression event: disabled");if(!e.productId)return void(0,vt.ZP)("dropping impression event: missing product id",t);const n=yield this._analyticsConfig.analyticsEnabled(),i={type:"web_impression",eventId:(0,Ft.Z)(),occurred:e.occurred,product:e.productId};n&&(i.entityId=t.message_id,i.reportingContext=e.context.reporting_context);const{channel_id:r,contact_id:o}=yield this._getDevice(e.device);yield this._events.acceptMeteredUsageEvent(i,{channelId:r,contactId:n?o:void 0})}))}_screenViewEvent(t,e){return Un(this,void 0,void 0,(function*(){return{type:"screen_tracking",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{source:"urban-airship",device:yield this._getDevice(),locale:yield this._getLocale(),session_id:yield this._getSessionId(),screen:t.screen,entered_time:(0,Vn.S)(t.enteredTime),duration:(0,Vn.S)(e-t.enteredTime),exited_time:(0,Vn.S)(e)}}}))}_wrapWarp9Reporting(t){return(...e)=>Un(this,void 0,void 0,(function*(){yield this._analyticsConfig.validateAnalyticsAllowed();const n=yield t(...e);yield this._events.acceptWarp9Event(n,{channelId:yield this._channelId(),contactId:yield this._contactId()})}))}_getSessionId(){return Un(this,void 0,void 0,(function*(){const t=yield this._session();return null==t?void 0:t.id}))}_customEvent(t,e){return Un(this,arguments,void 0,(function*({name:t,interactionId:e,interactionType:n,properties:i,transactionId:r,value:o},s){const a=void 0!==o?1e6*o:void 0,c=yield this._session();return{type:"enhanced_custom_event",event_id:(0,Ft.Z)(),time:(0,Vn.S)(s),data:{source:"urban-airship",device:yield this._getDevice(),locale:yield this._getLocale(),event_name:t,event_value:a,properties:i,interaction_id:e,interaction_type:n,transaction_id:r,session_id:null==c?void 0:c.id,conversion_send_id:null==c?void 0:c.send_id}}}))}_notificationButtonClick(t,e){return Un(this,arguments,void 0,(function*({buttonId:t,sendId:e},n){const i=yield this._session();return{type:"enhanced_custom_event",event_id:(0,Ft.Z)(),time:(0,Vn.S)(n),data:{source:"urban-airship",device:yield this._getDevice(),locale:yield this._getLocale(),event_name:`button--${t.toLowerCase()}`,interaction_type:"ua_interactive_notification",session_id:null==i?void 0:i.id,conversion_metadata:e,properties:{}}}}))}_featureFlagInteraction(t,e){return Un(this,void 0,void 0,(function*(){var n;if(!t._meta)throw new ze.$;return{type:"feature_flag_interaction",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{source:"urban-airship",device:yield this._getDevice(t._meta.device),locale:yield this._getLocale(),eligible:t.eligible,flag_name:t._meta.name,reporting_metadata:t._meta.context,superseded_reporting_metadata:(null===(n=t._meta.supersededContext)||void 0===n?void 0:n.length)?t._meta.supersededContext:void 0,session_id:yield this._getSessionId()}}}))}_inAppDisplay(t,e){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i}){return{type:"in_app_display",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),locale:yield this._getLocale()}}}))}_inAppResolution(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},r){return{type:"in_app_resolution",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{resolution:r,id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),locale:yield this._getLocale()}}}))}_buttonTap(t,e,n,i){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},r,o){return{type:"in_app_button_tap",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),button_identifier:r,locale:yield this._getLocale(),reporting_metadata:o}}}))}_transformFormResult(t,e,n){if("nps"===t){if(void 0===n)throw new Error("nps forms must have a score id");return{type:"nps",score_id:n,response_type:"nps",children:e}}return{type:"form",response_type:"user_feedback",children:e}}_inAppFormSubmit(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{formId:r,children:o,responseType:s,scoreId:a}){return{type:"in_app_form_result",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),forms:{[r]:this._transformFormResult(s,o,a)},locale:yield this._getLocale()}}}))}_inAppFormDisplay(t,e,n){return Un(this,arguments,void 0,(function*(t,{context:e,occurred:n,device:i},{formId:r,responseType:o}){return{type:"in_app_form_display",event_id:(0,Ft.Z)(),time:(0,Vn.S)(n),data:{id:t,source:"urban-airship",context:e,device:yield this._getDevice(i),session_id:yield this._getSessionId(),form_identifier:r,form_response_type:o,form_type:"nps"===o?"nps":"form",locale:yield this._getLocale()}}}))}_inAppPageView(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{completed:r,pageCount:o,pageId:s,pageIndex:a,pageViewCount:c,pagerId:u,pageHistory:d}){const l={type:"in_app_page_view",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),completed:r,page_count:o,page_identifier:s,pager_identifier:u,page_index:a,viewed_count:c,locale:yield this._getLocale(),page_history:d.map((({pageId:t,pageIndex:e,displayTimeMs:n})=>({page_identifier:t,page_index:e,display_time:(0,Vn.S)(n)})))}};return l}))}_inAppPageSwipe(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{pagerId:r,toPageId:o,toPageIndex:s,fromPageId:a,fromPageIndex:c}){return{type:"in_app_page_swipe",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),locale:yield this._getLocale(),pager_identifier:r,to_page_identifier:o,to_page_index:s,from_page_identifier:a,from_page_index:c}}}))}_inAppPagerCompleted(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{pageCount:r,pageId:o,pageIndex:s,pagerId:a}){return{type:"in_app_pager_completed",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),page_count:r,page_identifier:o,page_index:s,pager_identifier:a,locale:yield this._getLocale()}}}))}_inAppPagerSummary(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{pagerId:r,viewedPages:o}){return{type:"in_app_pager_summary",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),pager_identifier:r,viewed_pages:o.map((({displayTimeMs:t,pageId:e,pageIndex:n})=>({display_time:(0,Vn.S)(t),page_identifier:e,page_index:n}))),locale:yield this._getLocale()}}}))}_inAppPermissionResult(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{permission:r,result:o}){return{type:"in_app_permission_result",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),permission:r,starting_permission_status:o.startingPermission,ending_permission_status:o.endingPermission,locale:yield this._getLocale()}}}))}_inAppGesture(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{gestureId:r,reportingMetadata:o}){return{type:"in_app_gesture",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),gesture_identifier:r,reporting_info:o,locale:yield this._getLocale()}}}))}_inAppPageAction(t,e,n){return Un(this,arguments,void 0,(function*(t,{occurred:e,context:n,device:i},{actionId:r,reportingMetadata:o}){return{type:"in_app_page_action",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:{id:t,source:"urban-airship",context:n,device:yield this._getDevice(i),session_id:yield this._getSessionId(),action_identifier:r,reporting_info:o,locale:yield this._getLocale()}}}))}_associateIdentifiers(t,e){return Un(this,void 0,void 0,(function*(){return{type:"associate_identifiers",event_id:(0,Ft.Z)(),time:(0,Vn.S)(e),data:t}}))}_getDevice(t){return Un(this,void 0,void 0,(function*(){var e,n;return{channel_id:null!==(e=null==t?void 0:t.channelId)&&void 0!==e?e:yield this._channelId(),contact_id:null!==(n=null==t?void 0:t.contactId)&&void 0!==n?n:yield this._contactId()}}))}_getLocale(){return Un(this,void 0,void 0,(function*(){const{localeLanguage:t,localeCountry:e}=yield this._intlDetails();return{language:t,country:e}}))}}var qn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Kn{constructor(t,e,n){this._debug=(0,vt.g$)("reports-client"),this._request=t,this._options=e,this._featureQuerier=n}_send(t,e){return qn(this,arguments,void 0,(function*(t,e,{headers:n}={}){try{yield this._request.postVoid(t,e,{headers:n})}catch(t){if(At(t,400))throw new ze.$("rejected by backend");throw t}}))}acceptWarp9Events(t,e){return qn(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("analytics"))return this._send(this._options.warp9EventPath,t,{headers:this._getWarp9Headers(e)});this._debug("analytics are disabled, dropping warp9 events",t)}))}acceptVenusEvents(t){return qn(this,void 0,void 0,(function*(){if(yield this._featureQuerier.areFeaturesEnabled("analytics"))return this._send(this._options.venusEventPath,t);this._debug("analytics are disabled, dropping venus events",t)}))}_getWarp9Headers({channelId:t,contactId:e}){return{"X-UA-Channel-ID":t,"X-UA-Contact-ID":e,"X-UA-Device-Family":"web","X-UA-Sent-At":(0,Vn.S)(Date.now()),Accept:"application/json"}}acceptMeteredUsageEvents(t,e){return qn(this,void 0,void 0,(function*(){const n={usage:t.map((t=>(0,Vn.I)(t,e)))};return this._send(this._options.meteredUsageEventPath,n,{headers:this._getMeteredUsageHeaders(e)})}))}_getMeteredUsageHeaders({channelId:t}){return{"X-UA-Appkey":this._options.appKey,"X-UA-Channel-ID":t,"X-UA-Device-Family":"web"}}}class Wn{constructor(t,e,n){this._debug=(0,vt.g$)("mutations-client"),this._channel=t,this._contact=e,this._featureQuerier=n}acceptMutationEvents(t,e,n){return qn(this,void 0,void 0,(function*(){switch(t){case"channel":return this._deliverChannelEvents(e,n);case"contact":return this._deliverContactEvents(e,n);default:throw new Error(`invalid mutation event type: ${t}`)}}))}_deliverChannelEvents(t,e){return qn(this,void 0,void 0,(function*(){if(!(yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes")))return void this._debug(`tags and attributes disabled, dropping events for channel ${t}`,e);const n={},i=e.filter(dn);if(i.length){const t=k(i.reduce(((t,e)=>(t.push(...e.mutations),t)),[]));Object.keys(t).length&&(n.tags=t)}const r=e.filter(un);if(r.length){const t=A(r.reduce(((t,e)=>(t.push(...e.mutations),t)),[]));t.length&&(n.attributes=t)}const o=e.filter(ln);if(o.length){const t=j(o.reduce(((t,e)=>(t.push(...e.mutations),t)),[])).map(N);t.length&&(n.subscription_lists=t)}return Object.keys(n).length?this._channel.updateChannel(t,n):void 0}))}_deliverContactEvents(t,e){return qn(this,void 0,void 0,(function*(){const n={},i=yield this._featureQuerier.areFeaturesEnabled("tags_and_attributes"),r=e.filter(dn);if(r.length&&i){const t=k(r.reduce(((t,e)=>(t.push(...e.mutations),t)),[]));Object.keys(t).length&&(n.tags=t)}else r.length&&this._debug(`dropping tag mutations for contact ${t}`,r);const o=e.filter(un);if(o.length&&i){const t=A(o.reduce(((t,e)=>(t.push(...e.mutations),t)),[]));t.length&&(n.attributes=t)}else o.length&&this._debug(`dropping attribute mutations for contact ${t}`,r);const s=e.filter(hn);if(s.length&&i){const t=B(s.reduce(((t,e)=>(t.push(...e.mutations),t)),[]));t.length&&(n.subscription_lists=t)}else s.length&&this._debug(`dropping subscription list mutations for contact ${t}`,r);if(Object.keys(n).length)return this._contact.updateContact(t,n)}))}}class Hn{constructor(t,e){this._request=t,this._options=e}updateChannel(t,e){return qn(this,void 0,void 0,(function*(){const n=`${this._options.channelBatchPath}/${t}`;try{yield this._request.putVoid(n,e)}catch(t){if(At(t,400))throw new ze.$("rejected by backend");throw t}}))}updateContact(t,e){return qn(this,void 0,void 0,(function*(){const n=`${this._options.contactBatchPath}/${t}`;try{yield this._request.postVoid(n,e)}catch(t){if(At(t,400))throw new ze.$("rejected by backend");throw t}}))}}var Zn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Gn{constructor(t,e,n,i,r,{_getUuid:o=Ft.Z}={}){this._db=t,this._sendId=e,this._intervalRestricter=n,this._reporter=i,this._mutex=r,this._getUuid=o}get(){return this._mutex.runExclusive((()=>this._get()))}_get(){return Zn(this,void 0,void 0,(function*(){return this._db.get(Gn.SESSION_DB_KEY)}))}start(){return this._mutex.runExclusive((()=>this._start()))}_start(){return Zn(this,void 0,void 0,(function*(){const t=yield this._intervalRestricter.getTicketForOperation("activity",Gn.SESSION_LENGTH);this._intervalRestricter.recordOperation("activity");const e=yield this._sendId.getSendId();if(e||t){const t={id:this._getUuid(),send_id:e};yield this._db.set(Gn.SESSION_DB_KEY,t),this._reporter.reportSession(t)}}))}clear(){return this._mutex.runExclusive((()=>this._clear()))}_clear(){return this._db.remove(Gn.SESSION_DB_KEY)}}Gn.SESSION_DB_KEY="session",Gn.SESSION_LENGTH={minutes:30};class zn{constructor(t,{_getNow:e=(()=>Date.now())}={}){this._db=t,this._getNow=e}storeSendId(t){return Zn(this,void 0,void 0,(function*(){const e=this._getNow(),n={id:t,timestamp:e};yield this._db.set(zn.SEND_ID_DB_KEY,n)}))}getSendId(){return Zn(this,void 0,void 0,(function*(){const t=this._getNow(),[e,n]=yield this._db.mutate(zn.SEND_ID_DB_KEY,(e=>{if(e&&!e.consumed&&t-e.timestamp<=zn.SEND_ID_VALIDITY_LENGTH)return Object.assign(Object.assign({},e),{consumed:!0});throw new u.A("no update required")}));if(e&&n)return n.id}))}}zn.SEND_ID_DB_KEY="last_send_id",zn.SEND_ID_VALIDITY_LENGTH=2e4;const Qn="session";function Yn(t,e,i){return Zn(this,arguments,void 0,(function*({storagePrefix:t},e,i){const r=`${t}:${Qn}`,o=e.getItem(r);if(!o)return;let s;e.removeItem(r);try{s=JSON.parse(o)}catch(t){return}var a;(a=s,(0,n.Uy)(a)&&(0,n.HD)(a.id)&&Boolean(a.id))&&(yield i.mutate(Gn.SESSION_DB_KEY,(t=>{if(t)throw new u.A("value already exists");return s})))}))}var Jn=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const Xn="warp9",ti="venus",ei="metered-usage",ni="channel-mutation",ii="contact-mutation",ri="flush",oi="version",si="worker-configuration";class ai{constructor(t,{timeoutMs:e}={}){this._debug=(0,vt.g$)("sdk-rpc-client"),this._client=t,this._timeoutMs=e}acceptWarp9Event(t,e){return Jn(this,void 0,void 0,(function*(){const n={event:t,device:e};yield this._client.send(Xn,n),this._debug("successfully dispatched warp 9 event")}))}acceptVenusEvent(t){return Jn(this,void 0,void 0,(function*(){yield this._client.send(ti,t),this._debug("successfully dispatched venus event")}))}acceptChannelMutation(t){return Jn(this,void 0,void 0,(function*(){yield this._client.send(ni,t)}))}acceptContactMutation(t){return Jn(this,void 0,void 0,(function*(){yield this._client.send(ii,t)}))}acceptMeteredUsageEvent(t,e){return Jn(this,void 0,void 0,(function*(){const n={event:t,device:e};yield this._client.send(ei,n)}))}flush(){return Jn(this,void 0,void 0,(function*(){yield this._client.exchange(ri,n.o8,void 0,{timeoutMs:this._timeoutMs}),this._debug("successfully executed flush command")}))}getVersion(){return this._client.exchange(oi,n.HD,void 0,{timeoutMs:this._timeoutMs})}getConfiguration(){return this._debug("fetching configuration"),this._client.exchange(si,pi,void 0,{timeoutMs:this._timeoutMs})}withTimeout(t){return new ai(this._client,{timeoutMs:t})}}class ci{constructor(t){this._server=t,this._addRoute(Xn,ui,(({event:t,device:e})=>this.acceptWarp9Event(t,e))),this._addRoute(ti,di,(t=>this.acceptVenusEvent(t))),this._addRoute(ei,li,(({event:t,device:e})=>this.acceptMeteredUsageEvent(t,e))),this._addRoute(ni,hi,(t=>this.acceptChannelMutation(t))),this._addRoute(ii,fi,(t=>this.acceptContactMutation(t))),this._addRoute(ri,n.o8,(()=>this.flush())),this._addRoute(oi,n.o8,(()=>this.getVersion())),this._addRoute(si,n.o8,(()=>this.getConfiguration()))}_addRoute(t,e,n){this._server.addRoute(t,(i=>{if(!e(i))throw new Error(`unexpected message received for route '${t}': ${i}`);return n(i)}))}}function ui(t){return!!(0,n.Uy)(t)&&(!!(0,n.Uy)(t.event)&&(!!(0,n.Uy)(t.device)&&((0,n.HD)(t.event.event_id)&&(0,n.HD)(t.event.type))))}function di(t){return!!(0,n.Uy)(t)&&(!!(0,n.HD)(t.event_type)&&!!(0,n.Uy)(t.channel))}function li(t){return!!(0,n.Uy)(t)&&(!!(0,n.Uy)(t.event)&&(!!(0,n.Uy)(t.device)&&((0,n.HD)(t.event.product)&&(0,n.HD)(t.event.type))))}function hi(t){return!!(0,n.Uy)(t)&&("type"in t&&(!!cn(t.type)&&"scoped_subscription_lists"!==t.type))}function fi(t){return!!(0,n.Uy)(t)&&("type"in t&&(!!cn(t.type)&&"subscription_lists"!==t.type))}function pi(t){return(0,n.Uy)(t)&&"appKey"in t}class vi{constructor(t,{version:e,configuration:n}){this._eventManager=t,this._version=e,this._configuration=n}acceptVenusEvent(t){return this._eventManager.acceptVenusEvent(t)}acceptWarp9Event(t,e){return this._eventManager.acceptWarp9Event(t,e)}acceptMeteredUsageEvent(t,e){return this._eventManager.acceptMeteredUsageEvent(t,e)}acceptChannelMutation(t){return this._eventManager.acceptChannelMutation(t)}acceptContactMutation(t){return this._eventManager.acceptContactMutation(t)}flush(){return this._eventManager.flush()}getVersion(){return Jn(this,void 0,void 0,(function*(){return this._version}))}getConfiguration(){return Jn(this,void 0,void 0,(function*(){return this._configuration}))}}class yi{constructor(t,{flushCadenceMs:e=500}={}){this._flushTimerHandle=null,this._rpc=t,this._flushCadenceMs=e,this._queueFlush()}_queueFlush(){null!==this._flushTimerHandle&&window.clearTimeout(this._flushTimerHandle),this._flushTimerHandle=window.setTimeout((()=>{this._flushTimerHandle=null,this.flush()}),this._flushCadenceMs)}acceptVenusEvent(t){return Jn(this,void 0,void 0,(function*(){yield this._rpc.acceptVenusEvent(t),this._queueFlush()}))}acceptWarp9Event(t,e){return Jn(this,void 0,void 0,(function*(){yield this._rpc.acceptWarp9Event(t,e),this._queueFlush()}))}acceptMeteredUsageEvent(t,e){return Jn(this,void 0,void 0,(function*(){yield this._rpc.acceptMeteredUsageEvent(t,e),this._queueFlush()}))}acceptChannelMutation(t){return Jn(this,void 0,void 0,(function*(){yield this._rpc.acceptChannelMutation(t),this._queueFlush()}))}acceptContactMutation(t){return Jn(this,void 0,void 0,(function*(){yield this._rpc.acceptContactMutation(t),this._queueFlush()}))}flush(){return Jn(this,void 0,void 0,(function*(){null!==this._flushTimerHandle&&(window.clearTimeout(this._flushTimerHandle),this._flushTimerHandle=null),yield this._rpc.flush()}))}getVersion(){return Jn(this,void 0,void 0,(function*(){return this._rpc.getVersion()}))}getConfiguration(){return Jn(this,void 0,void 0,(function*(){return this._rpc.getConfiguration()}))}}var _i=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class gi{constructor(t,e,n){this._manager=t,this._provider=e,this._client=n}passesAdditionalAudienceCheck(t){return _i(this,void 0,void 0,(function*(){const{audienceCheckDefaults:e}=yield this._manager.get();if(!e)return!0;if(!e.enabled)return!0;const n=Object.assign(Object.assign({},e),t);if(n.bypass)return!0;if(!n.url)throw TypeError("url is required when a check value is set");const i={identifiers:{channelId:yield this._provider.channelId(),contactId:yield this._provider.contactId()},context:n.context};return this._client.resolve(n.url,i)}))}}var mi=s(873),bi=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function wi(t){return!!(0,n.Uy)(t)&&(!(!("allowed"in t)||!(0,n.jn)(t.allowed))&&!(!("cache_seconds"in t)||!(0,n.hj)(t.cache_seconds)))}class Ei{constructor(t,e){this._debug=(0,vt.g$)("additional-audience-check-client"),this._request=t,this._cache=e}resolve(t,e){return bi(this,arguments,void 0,(function*(t,{context:e,identifiers:n,namedUserId:i}){const r={channel_id:n.channelId,contact_id:n.contactId,url:t,context:e,named_user_id:i},o={"X-UA-Contact-ID":n.contactId,"X-UA-Device-Family":"web"};try{const{allowed:e}=yield this._cache.get(Ei._makeCacheKey(t),(()=>bi(this,void 0,void 0,(function*(){const{allowed:e,cache_seconds:n}=yield this._request.post(t,r,{headers:o,predicate:wi});return{data:{allowed:e,req:r},ttlMs:1e3*n}}))),{testValid:t=>{return e=t.req,n=r,Dn()(e)===Dn()(n);var e,n}});return e}catch(t){if(!(t instanceof Error))throw this._debug("unknown error while resolving",t),new mi.e;if(t instanceof gt.f)return this._debug("unsatisfied predicate",t),!1;throw new mi.e(t.message)}}))}static _makeCacheKey(t){return`${Ei.CACHE_KEY_PREFIX}:${t}`}}Ei.CACHE_KEY_PREFIX="audience-check";var Si=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};var Ai=class{constructor(t){this._db=t}update(t){return Si(this,void 0,void 0,(function*(){const[e]=yield this._db.mutate("appVersion",(e=>{if(e===t)throw new u.A("no app update");return t}));return e}))}};class Ii extends b.y{constructor(t,e){super(),this._type=t,this._channel=e,this._channel.addEventListener("message",(t=>this._onMessage(t)))}_isSerializationOfType(t){return t.type===this._type}_onMessage({data:t}){var e;if(e=t,(0,n.Uy)(e)&&"__uaBroadcastMessageVersion"in e&&1===e.__uaBroadcastMessageVersion){if(this._isSerializationOfType(t))return(0,vt.ZP)("received message",t),this._dispatchEvent(t.message)}else(0,vt.ZP)("received unexpected broadcast message",t)}_dispatchEvent(t){const e=new CustomEvent(this._type,{detail:t});this.dispatchTypedEvent(this._type,e)}broadcast(t,{broadcastLocally:e=!1}={}){(0,vt.ZP)("broadcasting message",t);const n={__uaBroadcastMessageVersion:1,type:this._type,message:t};this._channel.postMessage(n),e&&this._dispatchEvent(t)}}class xi{constructor(t){this._instances={},this._factory=t}forType(t){if(this._instances[t])return this._instances[t];const e=new Ii(t,this._factory(t));return this._instances[t]=e,e}}var Mi=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Pi{constructor({defaultTtlMs:t,prefix:e,_getNow:n=(()=>Date.now())},i,r){this._defaultTtlMs=t,this._prefix=e,this._getNow=n,this._db=i,this._mutex=r}get(t,e,n){return Mi(this,void 0,void 0,(function*(){return this._mutex.runExclusive((()=>this._get(this._makeKey(t),e,n)))}))}_get(t,e){return Mi(this,arguments,void 0,(function*(t,e,{testValid:n}={}){var i;let r=yield this._db.get(t);if(r&&!this._expired(r)){if(null===(i=null==n?void 0:n(r.data))||void 0===i||i)return r.data;r=void 0}const o=yield e(r),s=Object.assign(Object.assign({},o),{cachedAt:this._getNow()});return yield this._db.set(t,s),o.data}))}invalidate(t){return Mi(this,void 0,void 0,(function*(){return this._mutex.runExclusive((()=>this._invalidate(this._makeKey(t))))}))}_invalidate(t){return Mi(this,void 0,void 0,(function*(){yield this._db.remove(t)}))}_expired(t){var e,n;return(null!==(e=t.cachedAt)&&void 0!==e?e:0)+(null!==(n=t.ttlMs)&&void 0!==n?n:this._defaultTtlMs)<this._getNow()}_makeKey(t){return`${this._prefix}:${t}`}}var Oi=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Ci(){return Oi(this,void 0,void 0,(function*(){var t,e;try{const n=null===(e=yield null===(t=null===navigator||void 0===navigator?void 0:navigator.permissions)||void 0===t?void 0:t.query({name:"notifications"}))||void 0===e?void 0:e.state,i="default"===Notification.permission?"prompt":Notification.permission;if("denied"===n||"denied"===i)return"denied";if("granted"===n||"granted"===i)return"granted";if("prompt"===n&&"prompt"===i)return"prompt"}catch(t){return}}))}function ki(){return!("standalone"in navigator)||!("ontouchstart"in window)||navigator.standalone}function Di(){const t=window.isSecureContext;return void 0!==t?t:Boolean(ee().protocol.match("https"))}const Ti=["indexedDB","localStorage","fetch","crypto"];function Fi(){return Ti.every((t=>t in window))}function ji(){return!!Fi()&&"PushManager"in window}var Ri=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Bi(t){return Ri(this,void 0,void 0,(function*(){if(!(yield t.listConfiguredFeatures()).includes("push"))return{allowed:!1,reason:"feature_disabled"};if(!Di())return{allowed:!1,reason:"context_insecure"};if(!ki())return{allowed:!1,reason:"context_disallowed"};if(!ji())return{allowed:!1,reason:"push_unsupported"};const e=yield Ci();return e?"denied"===e?{allowed:!1,reason:"permission_denied"}:{allowed:!0}:{allowed:!1,reason:"push_unsupported"}}))}var Ni=s(4524);var Vi=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},Ui=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n};class Li{constructor(t,e,n,i,r){this._requester=n,this._overrides=e,this._provider=t,this._config=i,this._cache=r}featureFlag(t){return Vi(this,void 0,void 0,(function*(){const{flag:e}=t,{deferred:n,evaluation_options:i}=e,r=yield this._provider.channelId(),o=yield this._provider.contactId(),s=((t,e)=>{const{flag:n,last_updated:i,flag_id:r}=t;return[n.name,r,i,e,"deferred"===n.type?n.deferred.url:""].join(":")})(t,null!=o?o:r),{attributes:a,tags:c}=yield this._overrides.overrides(),u={notification_opt_in:yield this._provider.notificationOptIn(),app_version:this._config.appVersion,sdk_version:this._config.sdkVersion};return yield this._cache.get(Li.CACHE_KEY_BASE+s,(e=>Vi(this,void 0,void 0,(function*(){var s;try{const e={platform:"web",channel_id:r,contact_id:o,tag_overrides:c,attribute_overrides:a,state_overrides:u};return{data:yield this._requester.post(n.url,e),ttlMs:Math.max((null===(s=t.flag.evaluation_options)||void 0===s?void 0:s.ttl)||0,6e4)}}catch(t){if(e&&!(null==i?void 0:i.disallow_stale_value))return e;if(At(t,400))throw new Ni.c;throw new Ni.z}}))))}))}inAppMessage(t,e){return Vi(this,void 0,void 0,(function*(){const{deferred:n}=t,i=Ui(t,["deferred"]),{attributes:r,tags:o}=yield this._overrides.overrides(),s={notification_opt_in:yield this._provider.notificationOptIn(),app_version:this._config.appVersion,sdk_version:this._config.sdkVersion},{country:a,language:c}=yield this._provider.locale();a&&(s.locale_country=a),c&&(s.locale_language=c);const u={platform:"web",channel_id:yield this._provider.channelId(),contact_id:yield this._provider.contactId(),tag_overrides:o,attribute_overrides:r,state_overrides:s};e.trigger&&(u.trigger={event:e.triggerContext,goal:e.trigger.goal,type:e.trigger.type});const d=yield this._requester.post(n.url,u).catch((t=>{if(At(t,400))throw new Ni.c;throw new Ni.z}));return d.audience_match?{audienceMatch:!0,payload:Object.assign(Object.assign({},i),{message:d.message})}:{audienceMatch:!1}}))}}Li.CACHE_KEY_BASE="deferred:";var $i=Li,qi=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Ki{constructor(t){this._history=t}overrides(){return qi(this,void 0,void 0,(function*(){const t=yield this._history.history("channel_mutation"),e=yield this._history.history("contact_mutation");return{tags:Wi(t,e),attributes:Hi(t,e)}}))}}function Wi(t,e){return k([...t.filter(dn),...e.filter(dn)].reduce(((t,e)=>(t.push(...e.mutations),t)),[]))}function Hi(t,e){return A([...t.filter(un),...e.filter(un)].reduce(((t,e)=>(t.push(...e.mutations),t)),[]))}var Zi=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Gi{constructor(t,e){if(!Gi.isSupported)throw new Error("not supported in the current context");this._lifecycle=t,this._tabId=e,document.addEventListener("visibilitychange",(()=>this._onVisibilityChange()))}static get isSupported(){try{return Boolean(document&&document.visibilityState)}catch(t){return!1}}start(){return this._checkVisibilityAndEmit()}_onVisibilityChange(){return this._checkVisibilityAndEmit()}_checkVisibilityAndEmit(){return Zi(this,void 0,void 0,(function*(){var t;if("visible"!==document.visibilityState)return;const e=yield null===(t=this._tabId)||void 0===t?void 0:t.getTabId();this._lifecycle.accept("foreground",Date.now(),{tabId:e})}))}}class zi{constructor(t){this._db=t}reconcile(t){return this._db.reconcileConstraints(t)}for(t){return this._db.limiterForConstraints(t)}}function Qi(t){switch(t.period){case"seconds":return 1e3*t.value;case"minutes":return 60*t.value*1e3;case"hours":return 60*t.value*60*1e3;case"days":return 24*t.value*60*60*1e3;case"weeks":return 7*t.value*24*60*60*1e3;case"months":return 30*t.value*24*60*60*1e3;case"years":return 365*t.value*24*60*60*1e3;default:const e=t.period;throw new TypeError(`invalid period: ${e}`)}}var Yi=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},Ji=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,r){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,r,(e=t[n](e)).done,e.value)}))}}};class Xi{constructor(t,{_getNow:e=(()=>Date.now())}={}){this._db=t,this._getNow=e}reconcileConstraints(t){return Yi(this,void 0,void 0,(function*(){var e,n,i,r,o,s,a,c;const u=this._db.transaction([p.yO,p.zW],"readwrite"),d=u.objectStore(p.yO),l=t.reduce(((t,e)=>(t[e.id]=e,t)),{}),h=[],f=[];try{for(var v,y=!0,_=Ji(d.iterate());!(e=(v=yield _.next()).done);y=!0){r=v.value,y=!1;const t=r,e=l[t.primaryKey];if(!e){t.delete(),f.push(t.primaryKey);continue}const{count:n,id:i,range:o,type:s}=e;h.push(i),t.update({count:n,id:i,range:Qi(o),type:s})}}catch(t){n={error:t}}finally{try{y||e||!(i=_.return)||(yield i.call(_))}finally{if(n)throw n.error}}for(const{count:e,id:n,range:i,type:r}of t.filter((({id:t})=>!h.includes(t))))d.put({count:e,id:n,range:Qi(i),type:r});const g=u.objectStore(p.zW);for(const t of f){const e=yield g.index("constraintId").openCursor(t,"next");if(e)try{for(var m,b=!0,w=(s=void 0,Ji(e));!(o=(m=yield w.next()).done);b=!0){c=m.value,b=!1;c.delete()}}catch(t){s={error:t}}finally{try{b||o||!(a=w.return)||(yield a.call(w))}finally{if(s)throw s.error}}}yield u.done}))}limiterForConstraints(t){return Yi(this,void 0,void 0,(function*(){var e,n,i,r;const o=[],s=this._db.transaction([p.yO],"readonly").objectStore(p.yO);try{for(var a,c=!0,u=Ji(s.iterate());!(e=(a=yield u.next()).done);c=!0){r=a.value,c=!1;const e=r;t.includes(e.primaryKey)&&o.push(e.value)}}catch(t){n={error:t}}finally{try{c||e||!(i=u.return)||(yield i.call(u))}finally{if(n)throw n.error}}if(!o.length)throw new TypeError("no matching constraints");return yield this._pruneOccurrences(o),{check:()=>Yi(this,void 0,void 0,(function*(){return this._check(o)})),checkAndIncrement:()=>Yi(this,void 0,void 0,(function*(){return this._checkAndIncrement(o)}))}}))}_pruneOccurrences(t){return Yi(this,void 0,void 0,(function*(){var e,n,i,r;const o=this._getNow(),s=this._db.transaction([p.zW],"readwrite"),a=s.objectStore(p.zW);for(const{id:s,range:l}of t){const t=a.index("constraintId-occurred").iterate(IDBKeyRange.upperBound([s,o-l],!0));if(t)try{for(var c,u=!0,d=(n=void 0,Ji(t));!(e=(c=yield d.next()).done);u=!0){r=c.value,u=!1;r.delete()}}catch(t){n={error:t}}finally{try{u||e||!(i=d.return)||(yield i.call(d))}finally{if(n)throw n.error}}}yield s.done}))}_check(t){return Yi(this,void 0,void 0,(function*(){const e=this._getNow(),n=this._db.transaction([p.zW],"readonly").objectStore(p.zW);for(const{id:i,count:r,range:o}of t){if((yield n.index("constraintId-occurred").count(IDBKeyRange.bound([i,e-o],[i,e])))>=r)return!0}return!1}))}_checkAndIncrement(t){return Yi(this,void 0,void 0,(function*(){const e=this._getNow(),n=this._db.transaction([p.zW],"readwrite"),i=n.objectStore(p.zW);for(const{id:n,count:r,range:o}of t){if((yield i.index("constraintId-occurred").count(IDBKeyRange.bound([n,e-o],[n,e])))>=r)return!0}for(const{id:n}of t)i.put({constraintId:n,occurredAtMs:e});return yield n.done,!1}))}}const tr=["activated"];var er=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function nr(){return er(this,arguments,void 0,(function*(t=!1){if(!navigator.serviceWorker)throw new e.UnsupportedContextError("Worker registration not available in this context");if(z.default._disableServiceWorker)throw new e.FeatureDisabledError("Service worker is disabled by configuration");return function(t){return new Promise(((e,n)=>{t.active&&e(t);const i=t.installing||t.waiting;i?i.addEventListener("statechange",(()=>{tr.includes(i.state)&&e(t)})):n(new Error("Service worker in an unknown state"))}))}(yield navigator.serviceWorker.register(z.default.workerUrl,{updateViaCache:t?"none":"imports"}))}))}var ir=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class rr{constructor(t,{_getNow:e=(()=>Date.now())}={}){this._db=t,this._getNow=e}setInstallDate(){return ir(this,void 0,void 0,(function*(){yield this._db.mutate(rr.INSTALL_DATE_DB_KEY,(t=>{if(t)throw new u.A("install date already set");return this._getNow()}))}))}getInstallDate(){return ir(this,void 0,void 0,(function*(){const t=yield this._db.get(rr.INSTALL_DATE_DB_KEY);return null!=t?t:0}))}}rr.INSTALL_DATE_DB_KEY="install_date";const or="install_date";function sr(t,e,i){return ir(this,arguments,void 0,(function*({storagePrefix:t},e,i){const r=`${t}:${or}`,o=e.getItem(r);if(!o)return;let s;e.removeItem(r);try{s=JSON.parse(o)}catch(t){return}(0,n.hj)(s)&&(yield i.mutate(rr.INSTALL_DATE_DB_KEY,(t=>{if(t)throw new u.A("install date already set");return s})))}))}var ar=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class cr{constructor(t,{_getNow:e=(()=>Date.now())}={}){this._db=t,this._getNow=e}getTicketForOperation(t,e){return ar(this,void 0,void 0,(function*(){const[n]=yield this._db.mutate(`last_${t}`,(t=>{if(!this._isTicketExpired(t,e))throw new u.A("value not modified");return this._getNow()}));return n}))}_isTicketExpired(t,e){const n=this._getNow();return!t||n-t>(({hours:t=0,minutes:e=0,seconds:n=0})=>1e3*(n+60*(e+60*t)))(e)}isOperationTicketAvailable(t,e){return ar(this,void 0,void 0,(function*(){const n=`last_${t}`,i=yield this._db.get(n);return this._isTicketExpired(i,e)}))}recordOperation(t){return ar(this,void 0,void 0,(function*(){yield this._db.set(`last_${t}`,this._getNow())}))}}var ur=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function dr(t,{storeName:e,keyPath:n,version:i}){let r;function o(){return r||(r=Oe(t(),i,{upgrade:(t,i)=>{0===i&&t.createObjectStore(e,{keyPath:n})}}),r)}return{getDb:o,get:function(t){return ur(this,void 0,void 0,(function*(){var n;const i=(yield o()).transaction(e,"readonly").objectStore(e);return null===(n=yield i.get(t))||void 0===n?void 0:n.value}))},getOrLoad:function(t,i){return ur(this,void 0,void 0,(function*(){const r=(yield o()).transaction(e,"readwrite").objectStore(e),s=yield r.get(t);if(s)return s.value;const a=i();return yield r.put({[n]:t,value:a}),a}))},set:function(t,i){return ur(this,void 0,void 0,(function*(){const r=(yield o()).transaction(e,"readwrite").objectStore(e);yield r.put({[n]:t,value:i})}))},mutate:function(t,i){return ur(this,void 0,void 0,(function*(){var r;const s=(yield o()).transaction(e,"readwrite").objectStore(e),a=null===(r=yield s.get(t))||void 0===r?void 0:r.value;try{const e=i(a);return yield s.put({[n]:t,value:e}),[!0,e]}catch(t){if(t instanceof u.A)return[!1];throw t}}))},count:function(){return ur(this,void 0,void 0,(function*(){return(yield o()).transaction(e,"readonly").objectStore(e).count()}))},remove:function(t,n){return ur(this,void 0,void 0,(function*(){var i;const r=(yield o()).transaction(e,"readwrite").objectStore(e);if(n){const e=null===(i=yield r.get(t))||void 0===i?void 0:i.value;if(!n(e))return}return r.delete(t)}))},copy:function(t){return ur(this,void 0,void 0,(function*(){if(yield t.count())return!1;const n=yield function(){return ur(this,void 0,void 0,(function*(){return(yield o()).transaction(e,"readonly").objectStore(e).getAll()}))}();if(null==n?void 0:n.length){const e=n.map((e=>t.set(e.type,e.value)));return yield Promise.all(e),!0}return!1}))}}}var lr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class hr extends b.y{accept(t,e,n){const i=new CustomEvent(t,{detail:{timestamp:e,payload:n}});this.dispatchEvent(i)}}var fr=s(1656);class pr{constructor(t,e){this._key=`${t}:mutex:${e}`}runExclusive(t){return navigator.locks.request(this._key,t)}}class vr{constructor(t){this._prefix=t}getHandle(t){return new pr(this._prefix,t)}}class yr{constructor(){this._lock=new fr.Z}runExclusive(t){return this._lock.acquireAsync().then((()=>t())).finally((()=>this._lock.release()))}}class _r{constructor(){this._handles={}}getHandle(t){let e=this._handles[t];return e||(e=new yr,this._handles[t]=e),e}}class gr{constructor(t){navigator&&"locks"in navigator&&"request"in navigator.locks?((0,vt.ZP)("using global web locks API for mutex"),this._manager=new vr(t)):((0,vt.ZP)("using non-global await lock for mutex"),this._manager=new _r)}getHandle(t){return this._manager.getHandle(t)}}function mr(t){return"prompt"===t?"not_determined":t}var br=s(4323);class wr extends Error{constructor(t="timeout reached"){super(t),Object.setPrototypeOf(this,wr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wr),this.name=this.constructor.name}}var Er=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Sr(t){return"object"==typeof t&&(!!t&&("__uaVersion"in t&&"number"==typeof t.__uaVersion))}class Ar{constructor(t){this._handlers=[],this._debug=(0,vt.g$)("service-worker-transport"),this._global=t,t.addEventListener("message",(t=>this._receive(t)))}_receive(t){return Er(this,void 0,void 0,(function*(){const{data:e}=t;if(!Sr(e))return;let n;try{n=t.source&&"id"in t.source?t.source.id:void 0}catch(t){this._debug("caught error fetching message source",t)}const i=Object.assign(Object.assign({},e),{source:n}),r=Promise.all(this._handlers.map((t=>t(i))));t.waitUntil(r),yield r}))}send(t){return Er(this,void 0,void 0,(function*(){const e=t.destination;if(e){const n=yield this._global.clients.get(e);return void(null==n||n.postMessage(t))}(yield this._global.clients.matchAll()).forEach((e=>e.postMessage(t)))}))}addMessageHandler(t){this._handlers.push(t)}}class Ir{constructor(t,e){this._handlers=[],this._worker=t,e.addEventListener("message",(t=>this._receive(t)))}send(t){return Er(this,void 0,void 0,(function*(){this._worker.postMessage(t)}))}_receive(t){return Er(this,void 0,void 0,(function*(){const{data:e}=t;if(!Sr(e))return;const n=Promise.all(this._handlers.map((t=>t(e))));yield n}))}addMessageHandler(t){this._handlers.push(t)}}class xr{constructor(t){this._outstanding={},this._debug=(0,vt.g$)("rpc-client"),this._transport=t,this._transport.addMessageHandler((t=>this._handle(t)))}_handle(t){return Er(this,void 0,void 0,(function*(){if("reply"!==t.type)return;const{messageId:e,data:n}=t,i=this._popOutstanding(e);i?i.resolve(n):this._debug("no outstanding response for message id",e)}))}_popOutstanding(t){const e=this._outstanding[t];return delete this._outstanding[t],e}_rejectOutstanding(t,e){const n=this._popOutstanding(t);n&&n.reject(e)}_pushOutstanding(t,e){if(this._outstanding[t])throw new Error(`message with id ${t} already exists`);this._outstanding[t]=e}exchange(t,e,n){return Er(this,arguments,void 0,(function*(t,e,n,{timeoutMs:i}={}){const r={__uaVersion:1,type:"exchange",id:(0,Ft.Z)(),route:t,data:n},o=new br.Z;let s;return this._pushOutstanding(r.id,o),yield this._transport.send(r),i&&(s=setTimeout((()=>{this._rejectOutstanding(r.id,new wr("timeout"))}),i)),o.promise.then((n=>{if(s&&clearTimeout(s),!e(n))throw new Error(`invalid response for route ${t}: ${n}`);return n}))}))}send(t,e){return Er(this,void 0,void 0,(function*(){const n={__uaVersion:1,type:"send",id:(0,Ft.Z)(),route:t,data:e};return this._transport.send(n)}))}}class Mr{constructor(t){this._handlers={},this._debug=(0,vt.g$)("rpc-server"),this._transport=t,this._transport.addMessageHandler((t=>this._handle(t)))}_handle(t){return Er(this,void 0,void 0,(function*(){if("reply"===t.type)return void this._debug("not handling reply message in server",t);const{id:e,type:n,route:i,data:r,source:o}=t,s=this._handlers[i];if(!s)throw new Error(`no route ${i} for message: ${t}`);if("exchange"!==n){if("send"!==n){throw new Error(`unhandled message type ${n}`)}yield s(r)}else{const t=yield s(r),n={__uaVersion:1,type:"reply",id:(0,Ft.Z)(),messageId:e,destination:o,data:t};yield this._transport.send(n)}}))}addRoute(t,e){if(this._handlers[t])throw new Error(`cannot add multiple handlers for route: ${t}`);this._handlers[t]=e}}var Pr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const Or="safari:migrated_to_vapid";function Cr(t,e,n){return Pr(this,arguments,void 0,(function*({canRegister:t,getNotificationPermission:e,getOptedIn:n,register:i},r,o,s=self){if(!function(t=self){return!(!("safari"in t)||!z.default.websitePushId)&&"granted"===t.safari.pushNotification.permission(z.default.websitePushId).permission}(s))return;if(yield r.get(Or))return;return(yield t())?o.runExclusive((()=>Pr(this,void 0,void 0,(function*(){if(yield r.get(Or))return;if(!(yield n()))return;"granted"===(yield e())&&s.navigator.onLine&&(yield r.set(Or,!0),yield i())})))):void 0}))}var kr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};var Dr=class{constructor(t,e){this._remoteData=t,this._iaxEngine=e}setSessionDebug(t){(0,vt.Cf)(t)}refreshRemoteData(){this._remoteData.refresh()}iaxPutScheduleForPayload(t){return kr(this,void 0,void 0,(function*(){return(yield this._iaxEngine()).putScheduleForPayload(t)}))}iaxFinishScheduleForId(t){return kr(this,void 0,void 0,(function*(){return(yield this._iaxEngine()).finishScheduleForId(t)}))}},Tr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Fr{constructor({storagePrefix:t,_storage:e}){if(!Fr.isSupported)throw new Error("not supported in the current context");this._sessionStorage=null!=e?e:window.sessionStorage,this._storagePrefix=t}static get isSupported(){try{return Boolean(window.sessionStorage)}catch(t){return!1}}getTabId(){return Tr(this,void 0,void 0,(function*(){const t=this._sessionStorage.getItem(this._key());if(t)return t;const e=(0,Ft.Z)();return this._sessionStorage.setItem(this._key(),e),e}))}_key(){return`${this._storagePrefix}:${Fr.STORAGE_KEY}`}}Fr.STORAGE_KEY="tab-id";var jr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Rr{constructor(t){this._db=t}mutate(t){return jr(this,void 0,void 0,(function*(){const e=this._db.transaction(p.U4,"readwrite").objectStore(p.U4),n=yield e.getAll(),i=this._createTagMap(n),{add:r,remove:o,set:s}=k(t);r&&Object.entries(r).forEach((([t,e])=>{var n;const r=new Set(null!==(n=i[t])&&void 0!==n?n:[]);e.forEach((t=>r.add(t))),i[t]=[...r.values()]})),o&&Object.entries(o).forEach((([t,e])=>{i[t]&&(i[t]=i[t].filter((t=>!e.includes(t))))})),s&&Object.entries(s).forEach((([t,e])=>{i[t]=e})),yield Promise.all(Object.entries(i).map((([t,n])=>e.put({group:t,tags:n}))))}))}list(t){return jr(this,void 0,void 0,(function*(){const e=yield this._db.transaction(p.U4,"readonly").objectStore(p.U4).get(t);return e?e.tags:[]}))}all(){return jr(this,void 0,void 0,(function*(){const t=yield this._db.transaction(p.U4,"readonly").objectStore(p.U4).getAll();return this._createTagMap(t)}))}purgeGroup(t){return jr(this,void 0,void 0,(function*(){const e=this._db.transaction(p.U4,"readwrite").objectStore(p.U4),n=yield e.get(t);return!!(null==n?void 0:n.tags.length)&&(e.delete(t),!0)}))}_createTagMap(t){return t.reduce(((t,{group:e,tags:n})=>(t[e]=n,t)),{})}}const Br="tags";function Nr(t,e,i){return jr(this,arguments,void 0,(function*({storagePrefix:t},e,i){const r=`${t}:${Br}`,o=e.getItem(r);if(!o)return;let s;e.removeItem(r);try{s=JSON.parse(o)}catch(t){return}if(a=s,!(0,n.Uy)(a)||!Object.entries(a).every((([t,e])=>!!(0,n.HD)(t)&&!!Array.isArray(e)&&e.every(n.HD))))return;var a;if(!Object.entries(s).length)return;const c=i.transaction(p.U4,"readwrite").objectStore(p.U4);(yield c.count())||(yield Promise.all([Object.entries(s).map((([t,e])=>c.add({group:t,tags:e})))]))}))}var Vr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const Ur="workerVersion";class Lr{constructor(t){this._db=t}getVersion(){return this._db.get(Ur)}setVersion(t){return Vr(this,void 0,void 0,(function*(){yield this._db.set(Ur,t)}))}}var $r=s(2467);function qr(t){return!!(0,n.HD)(t)&&$r.H.includes(t)}var Kr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Wr extends b.y{constructor(t,e,{configurationEnabledFeatures:n,disableAnalytics:i}){super(),this._debug=(0,vt.g$)("sdk-controller"),i&&(n=n.filter((t=>"analytics"!==t))),this._db=t,this._notifier=e,this._configurationEnabledFeatures=n,this._disableAnalytics=i,this._notifier.addEventListener("feature:enablement",(({detail:t})=>{this._debug("bubbling broadcast feature enablement message"),this.dispatchTypedEvent("features_updated",new CustomEvent("features_updated",{detail:t.result}))}))}enableFeatures(...t){return Kr(this,void 0,void 0,(function*(){if(this._disableAnalytics&&t.includes("analytics"))throw new e.AnalyticsDisabledError("analytics permanently disabled by configuration");let n;const[i,r]=yield this._db.mutate(Wr.ENABLED_FEATURES_DB_KEY,((e=[...this._configurationEnabledFeatures])=>{n=Zr(e);const i=[];for(const e of t)n.includes(e)||i.push(e);if(!i.length)throw new u.A("no changes");return[...n,...i]}));if(!n)throw new Error("previous privacy manager features were not loaded");i&&this._emitFeatureEnablementChange({previous:n,current:r})}))}disableFeatures(...t){return Kr(this,void 0,void 0,(function*(){let e;const[n,i]=yield this._db.mutate(Wr.ENABLED_FEATURES_DB_KEY,((n=[...this._configurationEnabledFeatures])=>{e=Zr(n);const i=[];for(const e of t)n.includes(e)&&i.push(e);if(!i.length)throw new u.A("no changes");return e.filter((t=>!i.includes(t)))}));if(!e)throw new Error("previous privacy manager features were not loaded");n&&this._emitFeatureEnablementChange({previous:e,current:i})}))}listConfiguredFeatures(){return Kr(this,void 0,void 0,(function*(){const t=yield this._db.get(Wr.ENABLED_FEATURES_DB_KEY);if(!t)return this._configurationEnabledFeatures;const e=Zr(t);return this._disableAnalytics?e.filter((t=>"analytics"!==t)):e}))}isFeatureEnabled(...t){return Kr(this,void 0,void 0,(function*(){const e=yield this.isSdkEnabled(),n=yield this.listConfiguredFeatures();return t.reduce(((t,i)=>(t[i]=!!e&&n.includes(i),t)),{})}))}areFeaturesEnabled(...t){return Kr(this,void 0,void 0,(function*(){if(!(yield this._db.get(Wr.SDK_ENABLED_DB_KEY)))return!1;const e=yield this.listConfiguredFeatures();return t.every((t=>e.includes(t)))}))}anyFeaturesEnabled(){return this.isSdkEnabled()}isSdkEnabled(){return Kr(this,void 0,void 0,(function*(){if(!(yield this._db.get(Wr.SDK_ENABLED_DB_KEY)))return!1;const t=yield this.listConfiguredFeatures();return Boolean(t.length)}))}setSdkMainBreakerEnabled(t){return Kr(this,void 0,void 0,(function*(){if(!(yield this.canSdkMainBreakerEnable()))throw new e.FeatureCannotEnableError("feature is disabled by configuration");const n=yield this.listConfiguredFeatures(),[i,r]=yield this._db.mutate(Wr.SDK_ENABLED_DB_KEY,(e=>{if(Boolean(e)===t)throw new u.A("no update required");return t}));if(i&&r){const t=yield this.listConfiguredFeatures();this._emitFeatureEnablementChange({previous:[],current:t})}else i&&this._emitFeatureEnablementChange({previous:n,current:[]})}))}canSdkMainBreakerEnable(){return Kr(this,void 0,void 0,(function*(){const t=yield this.listConfiguredFeatures();return Boolean(t.length)}))}_emitFeatureEnablementChange(t){this.dispatchTypedEvent("features_updated",new CustomEvent("features_updated",{detail:t})),this._debug("broadcasting feature enablement",t),this._notifier.broadcast({result:t})}}Wr.SDK_ENABLED_DB_KEY="sdk_enabled",Wr.ENABLED_FEATURES_DB_KEY="enabled_features";var Hr=Wr;function Zr(t){return Array.isArray(t)?t.filter(qr):[]}const Gr=["push","in_app_automation","tags_and_attributes","contacts","feature_flags","analytics"],zr="dataCollectionEnabled";function Qr(t,e,n){return Kr(this,arguments,void 0,(function*(t,e,{dataCollectionOptInEnabled:n}){if(void 0!==(yield t.get(zr)))return e.runExclusive((()=>function(t,e){return Kr(this,arguments,void 0,(function*(t,{dataCollectionOptInEnabled:e}){const n=yield t.get(zr);if(void 0===n)return;const i=function({browserEnabledDataCollection:t,dataCollectionOptInEnabled:e}){if(t&&e)return Yr.BrowserEnabled_DataCollectionOptInEnabled;if(t&&!e)return Yr.BrowserEnabled_DataCollectionOptInDisabled;if(!t&&e)return Yr.BrowserDisabled_DataCollectionOptInEnabled;if(!t&&!e)return Yr.BrowserDisabled_DataCollectionOptInDisabled;throw new Error("unreachable condition")}({browserEnabledDataCollection:n,dataCollectionOptInEnabled:e});switch(i){case Yr.BrowserEnabled_DataCollectionOptInDisabled:break;case Yr.BrowserDisabled_DataCollectionOptInDisabled:case Yr.BrowserDisabled_DataCollectionOptInEnabled:yield t.mutate(Wr.ENABLED_FEATURES_DB_KEY,(t=>{if(t)throw new u.A("already set");return[]}));break;case Yr.BrowserEnabled_DataCollectionOptInEnabled:yield t.mutate(Wr.ENABLED_FEATURES_DB_KEY,(t=>{if(t)throw new u.A("already set");return[...Gr]}));break;default:throw new Error(`unexpected data collection mode: ${i}`)}yield t.remove(zr)}))}(t,{dataCollectionOptInEnabled:n})));const i=yield t.get(Wr.ENABLED_FEATURES_DB_KEY);n&&!i&&(yield t.mutate(Wr.ENABLED_FEATURES_DB_KEY,(t=>{if(t)throw new u.A("features are already set");return[]})))}))}var Yr;!function(t){t[t.BrowserDisabled_DataCollectionOptInDisabled=0]="BrowserDisabled_DataCollectionOptInDisabled",t[t.BrowserDisabled_DataCollectionOptInEnabled=1]="BrowserDisabled_DataCollectionOptInEnabled",t[t.BrowserEnabled_DataCollectionOptInDisabled=2]="BrowserEnabled_DataCollectionOptInDisabled",t[t.BrowserEnabled_DataCollectionOptInEnabled=3]="BrowserEnabled_DataCollectionOptInEnabled"}(Yr||(Yr={}));const Jr="disable_analytics";var Xr=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class to{constructor(t){this._controller=t}enable(t,...e){return Xr(this,void 0,void 0,(function*(){const n=to._expandAndValidateFeatures(t,...e);return this._controller.enableFeatures(...n)}))}disable(t,...e){return Xr(this,void 0,void 0,(function*(){const n=to._expandAndValidateFeatures(t,...e);return this._controller.disableFeatures(...n)}))}listEnabled(){return this._controller.listConfiguredFeatures()}static _expandAndValidateFeatures(t,...n){if(!t)throw new e.InvalidValueError("no feature specified");if("all"===t){if(n.length)throw new e.InvalidValueError("cannot specify additional features when passing `all`");return[...$r.H]}if(n.includes("all"))throw new e.InvalidValueError("cannot specify additional features when passing `all`");const i=[t,...n],r=i.filter((t=>!qr(t)));if(r.length)throw new e.InvalidValueError(`invalid features requested: ${r.join(", ")}`);return i}}var eo=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const no=["attributes","tags","subscription_lists","scoped_subscription_lists"],io=["click","session"];class ro{constructor(t){this._db=t}purgeChannelAudienceEvents(){return this._db.purge("channel_mutation",(t=>no.includes(t.type)))}purgeContactAudienceEvents(){return this._db.purge("contact_mutation",(t=>no.includes(t.type)))}purgeAnalyticsEvents(){return eo(this,void 0,void 0,(function*(){yield Promise.all([this._db.purge("warp9",(()=>!0)),this._db.purge("venus",(t=>io.includes(t.event_type)))])}))}}var oo=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class so{constructor(t,e,n,i,r,o){this._debug=(0,vt.g$)("feature-disabler"),this._channelManager=t,this._contact=e,this._tagStateStore=n,this._eventPurger=i,this._analyticsStore=r,this._sessionManager=o}onFeaturesUpdates(t){return oo(this,arguments,void 0,(function*({previous:t,current:e}){if(!(yield this._channelManager.getChannelId()))return void this._debug("not taking any actions; no channel present");const n=[],i=yield this._channelManager.getOptedIn(),r=Boolean(t.length),o=t.includes("push")&&!e.includes("push"),s=t.includes("tags_and_attributes")&&!e.includes("tags_and_attributes"),a=t.includes("contacts")&&!e.includes("contacts"),c=t.includes("analytics")&&!e.includes("analytics"),u=i&&o,d=r&&s,l=r&&(s||a),h=r&&a;if(u&&(this._debug("opting out channel"),n.push(this._channelManager.optOut({clearDeviceTags:d}))),d){const t=()=>oo(this,void 0,void 0,(function*(){(yield this._tagStateStore.purgeGroup("device"))&&(u||(this._debug("purging device tags"),yield this._channelManager.update({set_tags:!0,tags:[]})))}));this._debug("clearing audience mutation events"),n.push(t(),this._eventPurger.purgeChannelAudienceEvents())}l&&(this._debug("clearing contact tags"),n.push(this._eventPurger.purgeContactAudienceEvents())),h&&(this._debug("purging contact"),n.push(this._contact.purge())),c&&(this._debug("purging analytics events"),n.push(this._eventPurger.purgeAnalyticsEvents(),this._analyticsStore.clearScreenView(),this._sessionManager.clear())),yield Promise.all(n)}))}}var ao=s(6451),co=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class uo{constructor(t){this._lifecycleEvents=t}static get isSupported(){try{return Boolean(window&&window.location)}catch(t){return!1}}_handle(t){this._lifecycleEvents.accept("url_match",Date.now(),{url:t})}start(){return co(this,void 0,void 0,(function*(){this._handle(window.location.href)}))}}var lo=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const ho=(0,vt.g$)("main");let fo;class po extends b.y{constructor(t,n,i,r,o,s,a,u,d,l,h,p,v,y,g,m){super(),this.errors=e,this._defaultDb=t,this._keyValueDb=n,this._sdkController=i,this._privacyManager=r,this._channelStorage=o,this._intervalRestricter=s,this._rpcClient=a,this._eventHistory=u,this._channelListHistory=d,this._contactListHistory=l,this._workerRegistration=m,this._mutexManager=h,this._broadcastManager=p,this._apiBaseRequester=St(z.default,{apiBase:z.default.apiUrl}),this._lifecycleEvents=v;const b=new _(this._defaultDb);this._stickyCache=b,b.prune().catch((t=>ho("failed to prune sticky cache",t))),this._installDateManager=new rr(this._keyValueDb),this._eventPurger=y;const w=new Rn(this._keyValueDb),E=new jn(this._defaultDb,{obsoleteAfterMs:z.default.remoteData.obsoleteAfterMs});this._appConfigManager=new dt.Hb(new Bn(this._keyValueDb),this._mutexManager.getHandle("remote_data:config"),{initialBaseUrl:z.default.apiUrl});const S=new Nn.ts(z.default.appKey,{paths:yt.remote_data},this._apiBaseRequester,E,this._mutexManager.getHandle("remote_data:app")),A=new Nn.dJ(this._appConfigManager,this._sdkController,{identity:()=>this.contact.identity()},{paths:yt.remote_data},this._apiBaseRequester,E,this._mutexManager.getHandle("remote_data:contact")),I=this._broadcastManager.forType("remote_data:refresh");this._remoteDataProvider=new dt.ZP((()=>this._sdkController.isSdkEnabled()),[S,A],(()=>lo(this,void 0,void 0,(function*(){return this.locale.get()}))),I,w,this._lifecycleEvents,this._intervalRestricter,this._appConfigManager,{sdkVersion:z.default.VERSION,foregroundRefreshInterval:z.default.remoteData.foregroundRefreshInterval});const x=new En(this._keyValueDb);this.locale=new gn(x,new mn),this._channelManager=new tt(this._channelStorage,(()=>this.locale.get()),this._apiBaseRequester,this._mutexManager.getHandle("channel"),this._broadcastManager.forType("channel:registration"),this._sdkController,{registrationPathBase:yt.cra});const M=new rt({paths:yt.subscription_lists},this._apiBaseRequester,new Pi({defaultTtlMs:z.default.subscriptionLists.cacheTtlMs,prefix:"cache"},this._keyValueDb,this._mutexManager.getHandle("cache:channel_subscriptions"))),P=new Xt({paths:yt.contact},this._apiBaseRequester,new Pi({defaultTtlMs:z.default.subscriptionLists.cacheTtlMs,prefix:"cache"},this._keyValueDb,this._mutexManager.getHandle("cache:contact_subscriptions"))),O=new te({paths:yt.contact},this._apiBaseRequester,P);this._analyticsConfigManager=new Ln(this._appConfigManager,this._sdkController),this._appVersionStorage=new Ai(this._keyValueDb),this.locale.addEventListener("locale",(t=>{this._channelManager.update().catch((t=>ho("failed to update channel on locale change",t))),this._lifecycleEvents.accept("locale",Date.now(),{locale:t.detail})})),this.isSupported=Fi(),this.isWebPushSupported=ji(),this.isAllowedPushRegistrationContext=ki(),this._tagStateStore=new Rr(this._defaultDb),this._eventReporter=new $n(this._rpcClient,this._analyticsConfigManager,(()=>lo(this,void 0,void 0,(function*(){return this._channelPromise}))),(()=>lo(this,void 0,void 0,(function*(){return this.contact.contactId()}))),(()=>lo(this,void 0,void 0,(function*(){return this._sessionManager.get()}))),(()=>lo(this,void 0,void 0,(function*(){return Q(yield this.locale.get())}))),(()=>lo(this,void 0,void 0,(function*(){return this.channel.optedIn()})))),this._analyticsStorage=new f(this._keyValueDb),this.analytics=new c(this._eventReporter,this._lifecycleEvents,this._analyticsStorage,this._sdkController,this._sdkController);const C=new Ki(this._eventHistory);this._deferredResolver=new $i(this.audienceEvaluationDataProvider,C,St(z.default,{timeoutMs:z.default.remoteData.deferredTimeoutMs}),{appVersion:z.default.appVersion!==z.aw?z.default.appVersion:void 0,sdkVersion:z.default.VERSION},new Pi({defaultTtlMs:z.default.deferred.featureFlagCacheTtlMs,prefix:"cache"},this._keyValueDb,this._mutexManager.getHandle("cache:deferred")));const k={isSecure:Di(),allowedDomains:z.default.allowedDomains};ho("Web SDK environment:",k),this.channel=new Z(this._channelManager,i,this._tagStateStore,{applyAttributeMutations:t=>a.acceptChannelMutation({type:"attributes",mutations:t}),applySubscriptionListMutations:t=>a.acceptChannelMutation({type:"subscription_lists",mutations:t}),applyTagMutations:t=>a.acceptChannelMutation({type:"tags",mutations:t})},this._channelListHistory,M),this._channelPromise=new Promise((t=>{this.channel.addEventListener("channel",(e=>t(e.detail.id)),{once:!0})})),this._channelPromise.then((()=>this._startSession())),this._channelPromise.then((()=>this.heartbeat())),this._channelPromise.then((()=>this.checkPermission()));const D=Zt(z.default,n);var T,F;this.contact=function(t,e,n,i,r,o,s,a,c,u,d,l,h){const f=new Pt({paths:yt.contact.registration},St(t,{apiBase:t.apiUrl}));return new Qt(e,n,l,d,f,i,r,o,s,a,c,u.getHandle("contact"),h)}(z.default,(()=>lo(this,void 0,void 0,(function*(){return this.channel.id()}))),(()=>this.locale.get()),this._sdkController,this._sdkController,this._lifecycleEvents,this._tagStateStore,{applyAttributeMutations:t=>a.acceptContactMutation({type:"attributes",mutations:t}),applySubscriptionListMutations:t=>a.acceptContactMutation({type:"scoped_subscription_lists",mutations:t}),applyTagMutations:t=>a.acceptContactMutation({type:"tags",mutations:t})},this._contactListHistory,this._mutexManager,O,D,this.channel),this.CustomEvent=(T=t=>this.sendCustomEvent(t),(F=class extends re{sendEvent(){return T(this)}}).templates={retail:{AddedToCartEvent:class extends fe{sendEvent(){return T(this)}},BrowsedEvent:class extends he{sendEvent(){return T(this)}},PurchasedEvent:class extends pe{sendEvent(){return T(this)}},SharedProductEvent:class extends ye{sendEvent(){return T(this)}},StarredProductEvent:class extends ve{sendEvent(){return T(this)}}},media:{BrowsedContentEvent:class extends ae{sendEvent(){return T(this)}},ConsumedContentEvent:class extends ce{sendEvent(){return T(this)}},SharedContentEvent:class extends de{sendEvent(){return T(this)}},StarredContentEvent:class extends ue{sendEvent(){return T(this)}}},account:{RegisterEvent:class extends oe{sendEvent(){return T(this)}}}},F),this.plugins=new An,this._sessionManager=new Gn(this._keyValueDb,new zn(this._keyValueDb),this._intervalRestricter,{reportSession:t=>lo(this,void 0,void 0,(function*(){const n=Date.now();try{yield this._eventReporter.session(t,n)}catch(t){t instanceof e.AnalyticsDisabledError||ho("failed to report session",t)}this._lifecycleEvents.accept("session",n,void 0)}))},this._mutexManager.getHandle("session")),this._iaxEngine=this._enableInAppAutomation(),this._iaxEngine.then((()=>this._onInAppAutomationEnabled())).catch((t=>ho("error starting in app automation",t))),this._componentManager=new ft(this._remoteDataProvider,this.audienceEvaluationDataProvider,this._eventReporter,this._lifecycleEvents,this._deferredResolver,(()=>this._iaxEngine),((t,e)=>new ut.oN(t,e)),this._stickyCache,this._sdkController),this._featureDisabler=new so(this._channelManager,{purge:()=>this.contact._purge()},this._tagStateStore,this._eventPurger,this._analyticsStorage,this._sessionManager);const j=new fr.Z;this._sdkController.addEventListener("features_updated",(({detail:t})=>{this._featureDisabler.onFeaturesUpdates(t),j.acquireAsync().then((()=>this._handleInAppAutomationFeatures(t))).finally((()=>j.release()))})),navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",(t=>{if("push"===t.data.type){ho("Push event from worker",t);const e=new CustomEvent("push",{detail:t.data.push});this.dispatchTypedEvent("push",e)}})),g.forEach((t=>t.start()))}_handleInAppAutomationFeatures(t){return lo(this,arguments,void 0,(function*({previous:t,current:n}){try{if(!t.includes("in_app_automation")&&n.includes("in_app_automation"))try{yield this._iaxEngine}catch(t){if(t instanceof e.FeatureDisabledError)return ho("enabling iax engine on privacy manager change"),this._iaxEngine=this._enableInAppAutomation(),void this._iaxEngine.then((()=>this._onInAppAutomationEnabled()));throw t}else t.includes("in_app_automation")&&!n.includes("in_app_automation")&&(ho("disabling iax engine on privacy manager change"),this._iaxEngine.then((t=>t.destroy())),this._iaxEngine=Promise.reject(new e.FeatureDisabledError("in app automation disabled")))}catch(e){ho("unable to handle iax engine state change",{previous:t,current:n},e)}}))}get _debugDoNotUse(){return console.warn("debugging is for internal use only; do not rely on this API as it may change at any time"),fo||(fo=new Dr(this._remoteDataProvider,(()=>this._iaxEngine))),fo}setDataCollectionEnabled(t){return t?this._privacyManager.enable("all"):this._privacyManager.disable("all")}isDataCollectionEnabled(){return lo(this,void 0,void 0,(function*(){const t=yield this._sdkController.listConfiguredFeatures();return Boolean(t.length)}))}_onInAppAutomationEnabled(){return lo(this,void 0,void 0,(function*(){yield Promise.all([this._handleAppVersionUpdate()])}))}_handleAppVersionUpdate(){return lo(this,void 0,void 0,(function*(){(yield this._appVersionStorage.update(z.default.appVersion))&&z.default.appVersion!==z.aw&&this._lifecycleEvents.accept("version",(new Date).getTime(),{version:z.default.appVersion})}))}sendCustomEvent(t){return lo(this,void 0,void 0,(function*(){const e=Date.now();yield this._eventReporter.customEvent(t,e),this._lifecycleEvents.accept("custom_event",e,{name:t.name,properties:t.properties,value:t.value})}))}_enableInAppAutomation(){return lo(this,void 0,void 0,(function*(){var t;if(yield this._channelPromise,!z.default.components.inAppAutomation.enabled)throw new e.FeatureDisabledError("in app automation is disabled by configuration");if(!(yield this._sdkController.areFeaturesEnabled("in_app_automation")))throw new e.FeatureDisabledError("in app automation is disabled by privacy manager");const{default:n}=yield Promise.all([s.e(125),s.e(666)]).then(s.bind(s,3666)),i=new ot(this.channel,this._sdkController),r=new Gt(this.contact,this._sdkController),o={notifications:t=>lo(this,void 0,void 0,(function*(){if(!t)throw new Error("cannot handle notification opt-in outside of user interaction");const e=yield this.audienceEvaluationDataProvider.notificationDisplay();try{yield this.register()}catch(t){ho("encountered error registering channel",t)}return{startingPermission:e,endingPermission:yield this.audienceEvaluationDataProvider.notificationDisplay()}})),location:(t,e)=>lo(this,[t,e],void 0,(function*(t,{background:e}){if(!t)throw new Error("cannot handle location opt-in outside of user interaction");if(e)throw new Error("background location opt-in is not supported in default handler");const n=yield this.audienceEvaluationDataProvider.location();return navigator.geolocation?new Promise(((t,e)=>{navigator.geolocation.getCurrentPosition((()=>lo(this,void 0,void 0,(function*(){const e=yield this.audienceEvaluationDataProvider.location();t({startingPermission:n,endingPermission:e})}))),e)})):(ho("geolocation is not supported"),{startingPermission:n,endingPermission:"not_supported"})}))},a={open:(t,e)=>lo(this,void 0,void 0,(function*(){return!!self.open(t,"_blank")}))},c={share:(t,e)=>lo(this,void 0,void 0,(function*(){if(!e)throw new Error("cannot handle share for passive interaction");if(!navigator.share)return ho("sharing is not supported"),!1;try{return yield navigator.share(t),!0}catch(t){return ho("unable to share content",t),!1}}))},u=new Xi(this._defaultDb),d=new zi(u),l=new dt.xA(this._remoteDataProvider),h=new Ei(St(z.default,{timeoutMs:z.default.remoteData.additionalAudienceCheckTimeoutMs}),new Pi({defaultTtlMs:z.default.remoteData.audienceCheckCacheTtlMs,prefix:"cache"},this._keyValueDb,this._mutexManager.getHandle("cache:additional_audience_check"))),f=new gi(this._appConfigManager,this.audienceEvaluationDataProvider,h),p=new ao.dI(this._apiBaseRequester,{path:yt.channel.smsFormat});return n(this._defaultDb,l,this.audienceEvaluationDataProvider,this._eventReporter,i,r,o,a,((...t)=>new this.CustomEvent(...t)),c,d,this._deferredResolver,f,this._stickyCache,this._sdkController,p,{paused:z.default.components.inAppAutomation.startInPausedState,currentScreen:null===(t=yield this._analyticsStorage.getScreenView())||void 0===t?void 0:t.screen,displayInterval:z.default.components.inAppAutomation.displayIntervalMs})}))}checkPermission(){return lo(this,void 0,void 0,(function*(){"granted"!==(yield this.getNotificationPermission())&&(yield this.channel.optedIn())&&(yield this.channel.optOut())}))}heartbeat(){return lo(this,void 0,void 0,(function*(){if(!(yield this.isDataCollectionEnabled()))return;if(!(yield this._channelManager.getChannelId()))return;if(yield this._intervalRestricter.getTicketForOperation("heartbeat",{hours:24})){if(ho("SENDING heartbeat"),yield this._channelManager.getOptedIn())return void(yield this.register().catch((()=>this._channelManager.update())));yield this._channelManager.update()}}))}_startSession(){return lo(this,void 0,void 0,(function*(){try{yield this._sessionManager.start()}catch(t){ho("failed starting session",t)}}))}getNotificationPermission(){return lo(this,void 0,void 0,(function*(){return Ci()}))}canRegister(){return lo(this,void 0,void 0,(function*(){const{allowed:t}=yield Bi(this._sdkController);return t}))}register(){return lo(this,void 0,void 0,(function*(){const t=yield Bi(this._sdkController);if(!t.allowed){if("feature_disabled"===t.reason)throw new e.FeatureDisabledError("`push` feature is disabled");if("push_unsupported"===t.reason)throw new e.UnsupportedContextError("Web push not supported in browser");if("permission_denied"===t.reason)throw new e.UserDeniedPermissionError("User has denied web push permission");if("context_insecure"===t.reason)throw new e.UnsupportedContextError("Registration not possible on a non-secure context.");throw new e.UnsupportedContextError("Registration cannot happen in this context.")}return this._mutexManager.getHandle("registration").runExclusive((()=>this._register(!0)))}))}create(){return lo(this,void 0,void 0,(function*(){return this._mutexManager.getHandle("registration").runExclusive((()=>lo(this,void 0,void 0,(function*(){return this._register(yield this._channelManager.getOptedIn())}))))}))}_register(t){return lo(this,void 0,void 0,(function*(){if(!Di())throw new e.UnsupportedContextError("Registration not possible on a non-secure context.");if(!(yield this.isDataCollectionEnabled()))throw new e.DataCollectionDisabledError("Data collection is disabled. Cannot register user.");const n=yield this.locale.get(),i=(yield this._sdkController.listConfiguredFeatures()).includes("analytics");let r,o;if(t){if(!this._workerRegistration)throw new e.UnsupportedContextError("cannot register for push without a valid worker registration");r=yield function(t,n,i){return Cn(this,arguments,void 0,(function*(t,n,{analyticsEnabled:i}){const r=yield(t=>Cn(this,void 0,void 0,(function*(){if("granted"===(yield Notification.requestPermission()))return t;throw new e.UserDeniedPermissionError("Notification permission is denied.")})))(t);return In(yield Mn(r),J({optedIn:!0,localeOverride:n,analyticsEnabled:i}))}))}(this._workerRegistration,n,{analyticsEnabled:i})}else r=yield function(t,n,i){return Cn(this,arguments,void 0,(function*(t,n,{analyticsEnabled:i}){const r=J({optedIn:!1,localeOverride:n,analyticsEnabled:i});try{const e=t&&(yield Pn(t));if(e)return In(e,r)}catch(t){if(!(t instanceof e.UnsupportedContextError))throw t}return{channel:r}}))}(this._workerRegistration,n,{analyticsEnabled:i});yield this._sdkController.setSdkMainBreakerEnabled(!0);try{o=yield this._channelManager.updateOrCreate(r.channel)}catch(t){throw yield this._sdkController.setSdkMainBreakerEnabled(!1),t}return yield this._installDateManager.setInstallDate(),yield this._intervalRestricter.recordOperation("heartbeat"),{channelId:o}}))}get audienceEvaluationDataProvider(){return this._audienceEvaluationDataProvider||(this._audienceEvaluationDataProvider={contactId:()=>lo(this,void 0,void 0,(function*(){return this.contact.contactId()})),channelId:()=>lo(this,void 0,void 0,(function*(){return this._channelPromise})),channelIdDigest:()=>lo(this,void 0,void 0,(function*(){const{sha256Digest:t}=yield s.e(385).then(s.bind(s,2385));return t(yield this._channelPromise)})),installTimestamp:()=>lo(this,void 0,void 0,(function*(){return this._installDateManager.getInstallDate()})),deviceTags:()=>lo(this,void 0,void 0,(function*(){const t=this._tagStateStore;return yield t.list("device")})),analyticsEnabled:()=>this._sdkController.areFeaturesEnabled("analytics"),locale:()=>lo(this,void 0,void 0,(function*(){return this.locale.get()})),location:()=>lo(this,void 0,void 0,(function*(){var t;const e=yield null===(t=null===navigator||void 0===navigator?void 0:navigator.permissions)||void 0===t?void 0:t.query({name:"geolocation"});return e?mr(e.state):"not_supported"})),notificationDisplay:()=>lo(this,void 0,void 0,(function*(){const t=yield this.getNotificationPermission();return t?mr(t):"not_supported"})),notificationOptIn:()=>lo(this,void 0,void 0,(function*(){return this.channel.optedIn()})),appVersion:()=>lo(this,void 0,void 0,(function*(){return z.default.appVersion}))}),this._audienceEvaluationDataProvider}get components(){return this._componentManager}get privacyManager(){return this._privacyManager}}function vo(){return lo(this,void 0,void 0,(function*(){const e=Date.now(),n=new gr(z.default.storagePrefix);yield function(){return lr(this,void 0,void 0,(function*(){if(!z.default.deprecatedStoragePrefix)return!1;const t=dr((()=>`${z.default.storagePrefix}:db`),{storeName:"blob",keyPath:"type",version:1});if(yield t.count())return!1;const e=dr((()=>`${z.default.deprecatedStoragePrefix}:db`),{storeName:"blob",keyPath:"type",version:1});return yield e.copy(t),!0}))}();const i=dr((()=>`${z.default.storagePrefix}:db`),{storeName:"blob",keyPath:"type",version:1}),r=yield Ge();yield Qr(i,n.getHandle("migrate:data_collection"),z.default),yield function(t,e){return Kr(this,arguments,void 0,(function*(t,{configurationEnabledFeatures:e}){let n;yield t.remove(Jr,(t=>void 0!==t&&(n=t,!0))),n&&(yield t.mutate(Wr.ENABLED_FEATURES_DB_KEY,((t=[...e])=>Zr(t).filter((t=>"analytics"!==t)))))}))}(i,{configurationEnabledFeatures:z.default.enabledFeatures}),"localStorage"in self&&(yield Promise.all([Nr(z.default,self.localStorage,r),Yn(z.default,self.localStorage,i),sr(z.default,self.localStorage,i)]));const o=new xi((t=>new BroadcastChannel(`${z.default.storagePrefix}:${t}`))),s=new ct(i);yield function(t,e,n){return Kr(this,arguments,void 0,(function*(t,e,{configurationEnabledFeatures:n}){var i;if(void 0!==(yield t.get(Wr.SDK_ENABLED_DB_KEY)))return;if(!Zr(null!==(i=yield t.get(Wr.ENABLED_FEATURES_DB_KEY))&&void 0!==i?i:n).length)return;const r=yield e.getChannel();(null==r?void 0:r.channel_id)&&(yield t.mutate(Wr.SDK_ENABLED_DB_KEY,(t=>{if(void 0!==t)throw new u.A("nothing to update");return!0})))}))}(i,s,{configurationEnabledFeatures:z.default.enabledFeatures});const a=new Hr(i,o.forType("feature:enablement"),{configurationEnabledFeatures:z.default.enabledFeatures,disableAnalytics:z.default.disableAnalytics}),c=new to(a),d=new cr(i),l=new sn(r,{minTimeBetweenAttemptsMs:z.default.reports.requestTimeoutMs+1e3,retainSentRecordsForMs:z.default.reports.reportingPotentialLagMs}),h=new pn(l),f=new ro(l),p=new hr,v=[];let y,_;Fr.isSupported&&(y=new Fr(z.default)),Gi.isSupported&&v.push(new Gi(p,y)),uo.isSupported&&v.push(new uo(p));try{let u=yield nr();const[l,y]=yield function(e,n){return lo(this,void 0,void 0,(function*(){return"serviceWorker"in navigator&&n.active?(ho("initializing service worker rpc"),function(e,n){return lo(this,void 0,void 0,(function*(){const i=t.IvyVersionMatcher.newMatcher(`${z.default.VERSION}+`),r=new Lr(e),o=yield r.getVersion();if(ho(`worker version: ${o}. sdk version: ${z.default.VERSION}`),void 0!==o){const t=new xr(new Ir(n,navigator.serviceWorker)),e=new ai(t);if(function(t){lo(this,void 0,void 0,(function*(){try{const e=yield t.withTimeout(5e3).getConfiguration();e.appKey!==z.default.appKey?console.warn("[Airship] misconfiguration detected: service worker application key does not match SDK application key",{worker:e.appKey,sdk:z.default.appKey}):ho("service worker configuration matches sdk configuration")}catch(t){if(t instanceof wr)return void ho("timed out attempting to fetch worker configuration");ho("error fetching worker configuration",t)}}))}(e),i.apply(o))return ho("worker and sdk versions match"),[e,!1];""===o?console.warn("[Airship] possible misconfiguration detected: service worker version is invalid.",{worker:o,sdk:z.default.VERSION}):ho("worker and sdk versions do not match")}else console.warn("[Airship] possible misconfiguration detected: could not establish connection with service worker");ho("initWorkerBackedRpc fallback: initializing in-client rpc");return[yield g(),!0]}))}(e,n.active)):(ho("initRpcClient fallback: initializing in-client rpc"),[yield g(),!1])}))}(i,u);if(y){ho("worker: out of date");(yield d.getTicketForOperation("worker_update",z.default.workerUpdateTicketDuration))&&!u.waiting&&(ho("worker: forcing update, update ticket available & no registration is waiting"),u=yield nr(!0))}ho("sdk init startup ms:",Date.now()-e),_=new po(r,i,a,c,s,d,new yi(l),h,h,h,n,o,p,f,v,u)}catch(t){_=new po(r,i,a,c,s,d,new yi(yield g()),h,h,h,n,o,p,f,v,null)}if(z.default.migrateAPNsSafari)try{yield Cr({canRegister:()=>_.canRegister(),getNotificationPermission:()=>_.getNotificationPermission(),getOptedIn:()=>_.channel.optedIn(),register:()=>_.register()},i,n.getHandle("safari:apns_to_vapid_migration"))}catch(t){console.warn("unable to migrate APNs registration to VAPID",t)}return z.default.components.embeddedViews.selectors&&_.components.embeddedViews.selectors.setAll(z.default.components.embeddedViews.selectors),_;function g(){return lo(this,void 0,void 0,(function*(){const t=St(z.default,{apiBase:z.default.apiUrl,timeoutMs:z.default.reports.requestTimeoutMs}),e=new Kn(t,{appKey:z.default.appKey,featureFlagEventPath:yt.reports.featureFlagInteraction,warp9EventPath:yt.reports.warp9,meteredUsageEventPath:yt.meteredUsage,venusEventPath:yt.reports.venus},a),n=new Hn(t,{channelBatchPath:yt.channel.batch,contactBatchPath:yt.contact.batch}),i=new Wn(n,n,a),r=new Xe(l,e,e,e,i,{channel:()=>_.channel.id(),contact:()=>_.contact.contactId()});return new vi(r,{version:z.default.VERSION,configuration:{appKey:z.default.appKey}})}))}}))}const yo=36e5;function _o(t,e=!1){var n,i;if(z.default.configured)return z.default;if(t.dataCollectionOptInEnabled&&t.enabledFeatures)throw new Error("cannot enable legacy `dataCollectionOptInEnabled` and specify `enabledFeatures` together");const r=z.default.components;Object.assign(z.default,t),z.default.components={inAppAutomation:Object.assign(Object.assign({},r.inAppAutomation),null===(n=t.components)||void 0===n?void 0:n.inAppAutomation),embeddedViews:Object.assign(Object.assign({},r.embeddedViews),null===(i=t.components)||void 0===i?void 0:i.embeddedViews)};const o=new URL(z.default.workerUrl,z.default.workerUrl.startsWith("/")?self.location.href:void 0);if(!z.default.appKey)throw new Error("app key must be present in configuration");if(!z.default.apiUrl)throw new Error("api url must be present in configuration");const s=z.default.enabledFeatures.filter(qr),a=z.default.enabledFeatures.filter((t=>!qr(t)));a.length&&console.error("[Airship] invalid features found in `enabledFeatures` configuration key; these will be ignored!",a);const c=new Set(s);z.default.disableAnalytics&&c.delete("analytics"),z.default.enabledFeatures=Array.from(c),z.default.dataCollectionOptInEnabled&&(z.default.enabledFeatures=[]),z.default.deprecatedStoragePrefix=self.btoa(`${z.default.storagePrefix}:${z.default.appKey}:${z.default.workerUrl}`);const u=o.pathname.replace(/[^/]+$/,"");if(z.default.storagePrefix=self.btoa(`${z.default.storagePrefix}:${z.default.appKey}:${u}`),z.default.debug){const t=e?"secure-bridge":"main";console.log("UA[%s] configured with:",t,z.default)}return z.default.contacts.namedUserTtlMs=Math.max(yo,z.default.contacts.namedUserTtlMs),"string"!=typeof z.default.appVersion&&(console.error(`[Airship] invalid app version ${z.default.appVersion} specified; resetting to default`),z.default.appVersion=z.aw),z.default.configured=!0,z.default}var go=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function mo(t,e){t=`${z.default.apiUrl}${t}`;const n={Accept:"application/vnd.urbanairship+json; version=3;"};if(z.default.appKey&&z.default.token)n["X-UA-Appkey"]=z.default.appKey,n.Authorization=`Bearer ${z.default.token}`;else if(z.default.appKey&&z.default.secret){const t=self.btoa(`${z.default.appKey}:${z.default.secret}`);n.Authorization=`Basic ${t}`}return e.credentials="include",e.body&&(n["Content-type"]="application/json","string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.headers=e.headers||{},Object.assign(e.headers,n),(0,vt.ZP)("REQUEST",t,e),self.fetch(t,e)}var bo=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function wo(t,e,n){return bo(this,void 0,void 0,(function*(){const{analytics:i}=yield n.isFeatureEnabled("analytics");try{return function(t,e,n){return bo(this,void 0,void 0,(function*(){const i=yield Mn(t),r=yield function(t,e){const n=function(t,{analyticsEnabled:e}){return In(t,J({optedIn:!0,analyticsEnabled:e}))}(t,e);return mo(yt.cra,{method:"post",body:n})}(i,n);return function(t,e){return e.setChannel({channel_id:t.channel_id,opt_in:it(t.opt_in)})}(yield r.json(),e)}))}(t,e,{analyticsEnabled:i})}catch(t){(0,vt.ZP)("Unable to migrate registration on service worker startup.","Proceeding with installation.",t)}}))}var Eo,So=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Ao(t,e){const n=new gr(z.default.storagePrefix),i=new En(t),r=new gn(i,new mn),o=new ct(t),s=new xi((t=>new BroadcastChannel(`${z.default.storagePrefix}:${t}`)));return new tt(o,(()=>r.get()),St(z.default,{apiBase:z.default.apiUrl}),n.getHandle("channel"),s.forType("channel:registration"),e,{registrationPathBase:yt.cra})}function Io(t,e,n){t.clients.matchAll().then((t=>{for(let i=0;i<t.length;i++){t[i].postMessage({command:e,payload:n})}}))}function xo(t){return!!(0,n.Uy)(t)&&("channel_id"in t&&"string"==typeof t.channel_id&&"send_id"in t&&"string"==typeof t.send_id)}function Mo(t){return"contact"===t.type}function Po(t){return"channel"===t.type}!function(t){t.AMP_SUBSCRIPTION_STATE="amp-web-push-subscription-state",t.AMP_SUBSCRIBE="amp-web-push-subscribe",t.AMP_UNSUBSCRIBE="amp-web-push-unsubscribe"}(Eo||(Eo={}));var Oo=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};class Co{constructor(t,e){this._channelEditor=t,this._contactEditor=e}handleActions(t){return Oo(this,void 0,void 0,(function*(){var e,n;const i=null===(e=t.subscription_list)||void 0===e?void 0:e.filter(Mo),r=null===(n=t.subscription_list)||void 0===n?void 0:n.filter(Po),o=[];return(null==i?void 0:i.length)&&o.push(this._handleContactSubscriptions(i)),(null==r?void 0:r.length)&&o.push(this._handleChannelSubscriptions(r)),Promise.all(o).then((t=>t.every(Boolean)))}))}_handleContactSubscriptions(t){return Oo(this,void 0,void 0,(function*(){const e=this._contactEditor();t.forEach((t=>{"subscribe"===t.action?e.subscribe(t.list,t.scope):e.unsubscribe(t.list,t.scope)}));try{return yield e.apply(),!0}catch(t){return console.error(t),!1}}))}_handleChannelSubscriptions(t){return Oo(this,void 0,void 0,(function*(){const e=this._channelEditor();t.forEach((t=>{"subscribe"===t.action?e.subscribe(t.list):e.unsubscribe(t.list)}));try{return yield e.apply(),!0}catch(t){return console.error(t),!1}}))}}var ko=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Do(t,e,n,i,r,o,s,a){return ko(this,void 0,void 0,(function*(){var c,u;a.notification.close();const d=Date.now(),l=a.notification.data;if(!xo(l))return;const h=a.action;let f,p;h?(f=null===(c=l.buttons)||void 0===c?void 0:c.find((t=>t.id===h)),p=null!==(u=null==f?void 0:f.actions)&&void 0!==u?u:{}):p=function(t){const e=t["^u"]||t["^d_a"]||t["^p_a"],n={};return n.open=e?{type:"url",content:e}:{type:"home"},t["^+t"]&&(n.add_tag=t["^+t"]),t["^-t"]&&(n.remove_tag=t["^-t"]),t["^sl"]&&(n.subscription_list=t["^sl"]),n}(l.action||{});const v=l.send_id,y=function(t){var e,n;return"home"===(null===(e=t.open)||void 0===e?void 0:e.type)?z.default.defaultActionURL:"url"===(null===(n=t.open)||void 0===n?void 0:n.type)?t.open.content:null}(p),_=yield e.isFeatureEnabled("analytics","tags_and_attributes");if(_.tags_and_attributes&&(yield function(t){return ko(this,arguments,void 0,(function*(t,e={}){const n=_t(e.add_tag),i=_t(e.remove_tag);if(!n&&!i)return!0;const r=t();n&&r.add("device",n),i&&r.remove("device",i);try{yield r.apply()}catch(t){return console.error(t),!1}return!0}))}(n,p),yield function(t,e){return ko(this,arguments,void 0,(function*(t,e,n={}){if(!n.subscription_list||!n.subscription_list.length)return!0;return new Co(t,e).handleActions(n)}))}(i,r,p)),_.analytics&&v){const t=yield s();h?yield t.notificationButtonClick({sendId:v,buttonId:h},d):yield t.notificationClick({sendId:v},d),yield o.storeSendId(v)}y&&t.clients.openWindow&&(yield t.clients.openWindow(y))}))}var To=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Fo(t,e){return To(this,void 0,void 0,(function*(){var n,i,r,o;const s=(null===(n=e.data)||void 0===n?void 0:n.json())||{};if(!xo(s))return;const a=null!==(i=s.title)&&void 0!==i?i:z.default.defaultTitle,c=null!==(r=s.require_interaction)&&void 0!==r&&r,u=s.send_id;yield function(t,e){const n={type:"push",push:e};return t.clients.matchAll().then((t=>{t.forEach((t=>t.postMessage(n)))}))}(t,s);try{yield function(t,e){return To(this,void 0,void 0,(function*(){const n=yield t.registration.getNotifications();if(!(null==n?void 0:n.length))return;const i=Date.now()/1e3;for(const t of n){const{data:n}=t;if(!xo(n))return;e&&n.send_id===e||n.expiry&&n.expiry<i&&t.close()}}))}(t,u)}catch(t){console.error("error clearing notifications",t)}s.body&&(yield t.registration.showNotification(a,{body:s.body,icon:s.icon||z.default.defaultIcon,image:s.image,data:s,actions:null===(o=s.buttons)||void 0===o?void 0:o.map((t=>({title:t.label,action:t.id,icon:t.icon}))),requireInteraction:c}))}))}var jo=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function Ro(t,e,n,i){return jo(this,void 0,void 0,(function*(){try{const i=yield Mn(t.registration),r=yield e.getChannelId();if(!r)return;const{analytics:o}=yield n.isFeatureEnabled("analytics");return function(t,e,{analyticsEnabled:n}){const i=In(t,J({optedIn:!0,analyticsEnabled:n})),r=`${yt.cra}/${e}`;return mo(r,{method:"put",body:i})}(i,r,{analyticsEnabled:o})}catch(t){(0,vt.ZP)("Error in changeEventHandler: %s",t)}}))}var Bo=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};function No(t,e){const n=dr((()=>`${e.storagePrefix}:db`),{storeName:"blob",keyPath:"type",version:1}),i=new gr(e.storagePrefix),r=new En(n),o=new gn(r,new mn),s=new xi((t=>new BroadcastChannel(`${e.storagePrefix}:${t}`))),a=new Hr(n,s.forType("feature:enablement"),{configurationEnabledFeatures:e.enabledFeatures,disableAnalytics:e.disableAnalytics}),c=new ct(n),u=new tt(c,(()=>o.get()),St(e,{apiBase:e.apiUrl}),i.getHandle("channel"),s.forType("channel:registration"),a,{registrationPathBase:yt.cra}),d=Zt(e,n),l=new dt.Hb(new Bn(n),i.getHandle("remote_data:config"),{initialBaseUrl:e.apiUrl}),h=new Ln(l,a),f=new Promise(((t,n)=>function(t,e,n){return Bo(this,arguments,void 0,(function*(t,e,{channel:n,contact:i}){const r=St(t,{apiBase:t.apiUrl,timeoutMs:t.reports.requestTimeoutMs}),o=new sn(yield Ge(),{minTimeBetweenAttemptsMs:t.reports.requestTimeoutMs+1e3,retainSentRecordsForMs:t.reports.reportingPotentialLagMs}),s=new Kn(r,{appKey:t.appKey,featureFlagEventPath:yt.reports.featureFlagInteraction,warp9EventPath:yt.reports.warp9,meteredUsageEventPath:yt.meteredUsage,venusEventPath:yt.reports.venus},e),a=new Hn(r,{channelBatchPath:yt.channel.batch,contactBatchPath:yt.contact.batch}),c=new Wn(a,a,e);return new Xe(o,s,s,s,c,{channel:n,contact:i})}))}(e,a,{channel:()=>Bo(this,void 0,void 0,(function*(){const t=yield u.getChannelId();return null!=t?t:null})),contact:()=>d.getOrCreateContactId()}).then(t).catch(n))),p=new Promise(((t,e)=>{(function(){return Bo(this,void 0,void 0,(function*(){return new $n(yield f,h,(()=>Bo(this,void 0,void 0,(function*(){const t=yield c.getChannel();if(!t)throw new It;return t.channel_id}))),(()=>d.getOrCreateContactId()),(()=>n.get(Gn.SESSION_DB_KEY)),(()=>Bo(this,void 0,void 0,(function*(){return Q(yield o.get())}))),(()=>Bo(this,void 0,void 0,(function*(){const t=yield c.getChannel();if(!t)throw new It;return t.opt_in}))))}))})().then(t).catch(e)}));new class extends ci{acceptWarp9Event(t,e){return Bo(this,void 0,void 0,(function*(){const n=yield f;yield n.acceptWarp9Event(t,e)}))}acceptVenusEvent(t){return Bo(this,void 0,void 0,(function*(){const e=yield f;yield e.acceptVenusEvent(t)}))}acceptMeteredUsageEvent(t,e){return Bo(this,void 0,void 0,(function*(){const n=yield f;yield n.acceptMeteredUsageEvent(t,e)}))}acceptChannelMutation(t){return Bo(this,void 0,void 0,(function*(){const e=yield f;yield e.acceptChannelMutation(t)}))}acceptContactMutation(t){return Bo(this,void 0,void 0,(function*(){const e=yield f;yield e.acceptContactMutation(t)}))}flush(){return Bo(this,void 0,void 0,(function*(){const t=yield f;yield t.flush()}))}getVersion(){return Bo(this,void 0,void 0,(function*(){return e.VERSION}))}getConfiguration(){return Bo(this,void 0,void 0,(function*(){return{appKey:e.appKey}}))}}(new Mr(new Ar(t))),t.addEventListener("message",(e=>{(function(t){const e=Object.values(Eo);return t.data&&e.includes(t.data.command)})(e)&&function(t,e,n,i){const{command:r}=i.data;switch(r){case Eo.AMP_SUBSCRIPTION_STATE:!function(){So(this,void 0,void 0,(function*(){var i,r,o;const s=yield t.registration.pushManager.getSubscription(),a=null===(r=yield null===(i=null===navigator||void 0===navigator?void 0:navigator.permissions)||void 0===i?void 0:i.query({name:"notifications"}))||void 0===r?void 0:r.state,c=Ao(e,n),u=null!==s&&(null===(o=yield c.getOptedIn())||void 0===o||o)&&"granted"===a;(0,vt.ZP)("AMP[onMessageReceivedSubscriptionState]",{channelId:yield c.getChannelId(),isSubscribed:u,permission:a}),Io(t,Eo.AMP_SUBSCRIPTION_STATE,u)}))}();break;case Eo.AMP_SUBSCRIBE:(0,vt.ZP)("AMP[onMessageReceivedSubscribe]"),wo(t.registration,new ct(e),n).then((()=>Io(t,Eo.AMP_SUBSCRIBE,null)));break;case Eo.AMP_UNSUBSCRIBE:!function(){So(this,void 0,void 0,(function*(){const i=Ao(e,n);yield i.optOut(),Io(t,Eo.AMP_SUBSCRIBE,null)}))}()}}(t,n,a,e)})),t.addEventListener("push",(e=>{e.waitUntil(Fo(t,e))})),t.addEventListener("notificationclick",(e=>{const i=()=>O((t=>Bo(this,void 0,void 0,(function*(){return(yield f).acceptChannelMutation({type:"tags",mutations:t})}))),(()=>Bo(this,void 0,void 0,(function*(){return new Rr(yield Ge())}))),{validateGroup:T()}),r=()=>K((t=>Bo(this,void 0,void 0,(function*(){return(yield f).acceptChannelMutation({type:"subscription_lists",mutations:t})})))),o=()=>Tt((t=>Bo(this,void 0,void 0,(function*(){const e=yield f;yield e.acceptContactMutation({type:"scoped_subscription_lists",mutations:t}),yield d.appendSubscriptionListMutations(yield d.getOrCreateContactId(),t)}))));e.waitUntil((()=>Bo(this,void 0,void 0,(function*(){yield Do(t,a,i,r,o,new zn(n),(()=>p),e);const s=yield f;yield s.flush()})))())})),t.addEventListener("activate",(i=>{const r=new Lr(n);i.waitUntil(function(t,e,n){return go(this,arguments,void 0,(function*(t,e,{version:n}){(0,vt.ZP)(`[activate] saving service worker version (${n}) to the DB`),yield e.setVersion(n),yield t.clients.claim()}))}(t,r,{version:e.VERSION}))})),t.addEventListener("pushsubscriptionchange",(e=>Ro(t,u,a)))}const Vo="https://aswpapieu.com",Uo="2.14.8";try{const t=document.getElementById("_uasdk"),e=t.rel,n=window;t&&e&&n[e]&&"function"==typeof n[e]._async_setup&&n[e]._async_setup((function(t={}){if(_o(Object.assign({VERSION:Uo,apiUrl:Vo},t)),!Fi()){const t=new Error("Browser is not supported");if("Promise"in window)return Promise.reject(t);throw t}return vo()}))}catch(t){t instanceof ReferenceError&&self&&(self.uaSetup={worker:function(t,e={}){const n=_o(Object.assign({VERSION:Uo,apiUrl:Vo},e));No(t,n)}})}}()}();